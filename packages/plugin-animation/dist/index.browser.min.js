var jsPsychAnimation=function(i){"use strict";var y="2.1.0";const d={name:"animation",version:y,parameters:{stimuli:{type:i.ParameterType.IMAGE,default:void 0,array:!0},frame_time:{type:i.ParameterType.INT,default:250},frame_isi:{type:i.ParameterType.INT,default:0},sequence_reps:{type:i.ParameterType.INT,default:1},choices:{type:i.ParameterType.KEYS,default:"ALL_KEYS"},prompt:{type:i.ParameterType.HTML_STRING,default:null},render_on_canvas:{type:i.ParameterType.BOOL,default:!0}},data:{animation_sequence:{type:i.ParameterType.COMPLEX,array:!0,nested:{stimulus:{type:i.ParameterType.STRING},time:{type:i.ParameterType.INT}}},response:{type:i.ParameterType.COMPLEX,array:!0,nested:{stimulus:{type:i.ParameterType.STRING},rt:{type:i.ParameterType.INT},key_press:{type:i.ParameterType.STRING}}}},citations:{apa:"de Leeuw, J. R., Gilbert, R. A., & Luchterhandt, B. (2023). jsPsych: Enabling an Open-Source Collaborative Ecosystem of Behavioral Experiments. Journal of Open Source Software, 8(85), 5351. https://doi.org/10.21105/joss.05351 ",bibtex:'@article{Leeuw2023jsPsych, 	author = {de Leeuw, Joshua R. and Gilbert, Rebecca A. and Luchterhandt, Bj{\\" o}rn}, 	journal = {Journal of Open Source Software}, 	doi = {10.21105/joss.05351}, 	issn = {2475-9066}, 	number = {85}, 	year = {2023}, 	month = {may 11}, 	pages = {5351}, 	publisher = {Open Journals}, 	title = {jsPsych: Enabling an {Open}-{Source} {Collaborative} {Ecosystem} of {Behavioral} {Experiments}}, 	url = {https://joss.theoj.org/papers/10.21105/joss.05351}, 	volume = {8}, }  '}};class c{constructor(e){this.jsPsych=e}trial(e,t){var s=t.frame_time+t.frame_isi,a=0,r=0,l=performance.now(),u=[],p=[],m="";if(t.render_on_canvas){if(e.hasChildNodes())for(;e.firstChild;)e.removeChild(e.firstChild);var o=document.createElement("canvas");o.id="jspsych-animation-image",o.style.margin="0",o.style.padding="0",e.insertBefore(o,null);var _=o.getContext("2d")}const f=()=>{this.jsPsych.pluginAPI.cancelKeyboardResponse(v);var n={animation_sequence:u,response:p};this.jsPsych.finishTrial(n)};var P=setInterval(()=>{var n=!0;t.render_on_canvas||(e.innerHTML=""),a++,a==t.stimuli.length&&(a=0,r++,r>=t.sequence_reps&&(f(),clearInterval(P),n=!1)),n&&h()},s);const h=()=>{if(t.render_on_canvas){e.querySelector("#jspsych-animation-image").style.visibility="visible";var n=new Image;n.src=t.stimuli[a],o.height=n.naturalHeight,o.width=n.naturalWidth,_.drawImage(n,0,0),t.prompt!==null&&a==0&&r==0&&e.insertAdjacentHTML("beforeend",t.prompt)}else e.innerHTML='<img src="'+t.stimuli[a]+'" id="jspsych-animation-image"></img>',t.prompt!==null&&(e.innerHTML+=t.prompt);m=t.stimuli[a],u.push({stimulus:t.stimuli[a],time:Math.round(performance.now()-l)}),t.frame_isi>0&&this.jsPsych.pluginAPI.setTimeout(()=>{e.querySelector("#jspsych-animation-image").style.visibility="hidden",m="blank",u.push({stimulus:"blank",time:Math.round(performance.now()-l)})},t.frame_time)};var g=n=>{p.push({key_press:n.key,rt:n.rt,stimulus:m}),e.querySelector("#jspsych-animation-image").className+=" responded"},v=this.jsPsych.pluginAPI.getKeyboardResponse({callback_function:g,valid_responses:t.choices,rt_method:"performance",persist:!0,allow_held_key:!1});h()}simulate(e,t,s,a){t=="data-only"&&(a(),this.simulate_data_only(e,s)),t=="visual"&&this.simulate_visual(e,s,a)}create_simulation_data(e,t){const s=[],a=[];let r=0;const l=()=>this.jsPsych.randomization.sampleWithReplacement([!0,!1],1,[1,10])[0];for(let m=0;m<e.sequence_reps;m++)for(const o of e.stimuli)s.push({stimulus:o,time:r}),l()&&a.push({key_press:this.jsPsych.pluginAPI.getValidKey(e.choices),rt:r+this.jsPsych.randomization.randomInt(0,e.frame_time-1),current_stim:o}),r+=e.frame_time,e.frame_isi>0&&(s.push({stimulus:"blank",time:r}),l()&&a.push({key_press:this.jsPsych.pluginAPI.getValidKey(e.choices),rt:r+this.jsPsych.randomization.randomInt(0,e.frame_isi-1),current_stim:"blank"}),r+=e.frame_isi);const u={animation_sequence:s,response:a},p=this.jsPsych.pluginAPI.mergeSimulationData(u,t);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(e,p),p}simulate_data_only(e,t){const s=this.create_simulation_data(e,t);this.jsPsych.finishTrial(s)}simulate_visual(e,t,s){const a=this.create_simulation_data(e,t),r=this.jsPsych.getDisplayElement();this.trial(r,e),s();for(const l of a.response)this.jsPsych.pluginAPI.pressKey(l.key_press,l.rt)}}return c.info=d,c}(jsPsychModule);
//# sourceMappingURL=index.browser.min.js.map
