{"version":3,"file":"index.js","sources":["../package.json","../src/index.ts"],"sourcesContent":["{\r\n  \"name\": \"@jspsych/plugin-call-function\",\r\n  \"version\": \"2.1.0\",\r\n  \"description\": \"jsPsych plugin for calling an arbitrary function during a jspsych experiment\",\r\n  \"type\": \"module\",\r\n  \"main\": \"dist/index.cjs\",\r\n  \"exports\": {\r\n    \"import\": \"./dist/index.js\",\r\n    \"require\": \"./dist/index.cjs\"\r\n  },\r\n  \"typings\": \"dist/index.d.ts\",\r\n  \"unpkg\": \"dist/index.browser.min.js\",\r\n  \"files\": [\r\n    \"src\",\r\n    \"dist\"\r\n  ],\r\n  \"source\": \"src/index.ts\",\r\n  \"scripts\": {\r\n    \"test\": \"jest\",\r\n    \"test:watch\": \"npm test -- --watch\",\r\n    \"tsc\": \"tsc\",\r\n    \"build\": \"rollup --config\",\r\n    \"build:watch\": \"npm run build -- --watch\"\r\n  },\r\n  \"repository\": {\r\n    \"type\": \"git\",\r\n    \"url\": \"git+https://github.com/jspsych/jsPsych.git\",\r\n    \"directory\": \"packages/plugin-call-function\"\r\n  },\r\n  \"author\": \"Josh de Leeuw\",\r\n  \"license\": \"MIT\",\r\n  \"bugs\": {\r\n    \"url\": \"https://github.com/jspsych/jsPsych/issues\"\r\n  },\r\n  \"homepage\": \"https://www.jspsych.org/latest/plugins/call-function\",\r\n  \"peerDependencies\": {\r\n    \"jspsych\": \">=7.1.0\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"@jspsych/config\": \"^3.2.0\",\r\n    \"@jspsych/test-utils\": \"^1.2.0\"\r\n  }\r\n}\r\n","import { JsPsych, JsPsychPlugin, ParameterType, TrialType } from \"jspsych\";\r\n\r\nimport { version } from \"../package.json\";\r\n\r\nconst info = <const>{\r\n  name: \"call-function\",\r\n  version: version,\r\n  parameters: {\r\n    /** The function to call. */\r\n    func: {\r\n      type: ParameterType.FUNCTION,\r\n      default: undefined,\r\n    },\r\n    /** Set to true if `func` is an asynchoronous function. If this is true, then the first argument passed to `func`\r\n     * will be a callback that you should call when the async operation is complete. You can pass data to the callback.\r\n     * See example below.\r\n     */\r\n    async: {\r\n      type: ParameterType.BOOL,\r\n      default: false,\r\n    },\r\n  },\r\n  data: {\r\n    /** The return value of the called function. */\r\n    value: {\r\n      type: ParameterType.COMPLEX,\r\n      default: undefined,\r\n    },\r\n  },\r\n  // prettier-ignore\r\n  citations: '__CITATIONS__',\r\n};\r\n\r\ntype Info = typeof info;\r\n\r\n/**\r\n * This plugin executes a specified function. This allows the experimenter to run arbitrary code at any point during the experiment.\r\n *\r\n * The function cannot take any arguments. If arguments are needed, then an anonymous function should be used to wrap the function call (see examples below).\r\n *\r\n * @author Josh de Leeuw\r\n * @see {@link https://www.jspsych.org/latest/plugins/call-function/ call-function plugin documentation on jspsych.org}\r\n */\r\nclass CallFunctionPlugin implements JsPsychPlugin<Info> {\r\n  static info = info;\r\n\r\n  constructor(private jsPsych: JsPsych) {}\r\n\r\n  trial(display_element: HTMLElement, trial: TrialType<Info>) {\r\n    //trial.post_trial_gap = 0;  // TO DO: TS error: number not assignable to type any[]. I don't think this param should be an array..?\r\n    let return_val;\r\n\r\n    const end_trial = () => {\r\n      const trial_data = {\r\n        value: return_val,\r\n      };\r\n\r\n      this.jsPsych.finishTrial(trial_data);\r\n    };\r\n\r\n    if (trial.async) {\r\n      const done = (data) => {\r\n        return_val = data;\r\n        end_trial();\r\n      };\r\n      trial.func(done);\r\n    } else {\r\n      return_val = trial.func();\r\n      end_trial();\r\n    }\r\n  }\r\n\r\n  // no explicit simulate() mode for this plugin because it would just do\r\n  // the same thing as the regular plugin\r\n}\r\n\r\nexport default CallFunctionPlugin;\r\n"],"names":[],"mappings":";;AAEE,IAAW,OAAA,GAAA,OAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;EC4BA,SAAA,EAAA;AAAA;;GAAe;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}