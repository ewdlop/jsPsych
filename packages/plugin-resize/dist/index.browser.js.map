{"version":3,"file":"index.browser.js","sources":["../package.json","../src/index.ts"],"sourcesContent":["{\r\n  \"name\": \"@jspsych/plugin-resize\",\r\n  \"version\": \"2.1.0\",\r\n  \"description\": \"jsPsych plugin for controlling the real world size of the display\",\r\n  \"type\": \"module\",\r\n  \"main\": \"dist/index.cjs\",\r\n  \"exports\": {\r\n    \"import\": \"./dist/index.js\",\r\n    \"require\": \"./dist/index.cjs\"\r\n  },\r\n  \"typings\": \"dist/index.d.ts\",\r\n  \"unpkg\": \"dist/index.browser.min.js\",\r\n  \"files\": [\r\n    \"src\",\r\n    \"dist\"\r\n  ],\r\n  \"source\": \"src/index.ts\",\r\n  \"scripts\": {\r\n    \"test\": \"jest  --passWithNoTests\",\r\n    \"test:watch\": \"npm test -- --watch\",\r\n    \"tsc\": \"tsc\",\r\n    \"build\": \"rollup --config\",\r\n    \"build:watch\": \"npm run build -- --watch\"\r\n  },\r\n  \"repository\": {\r\n    \"type\": \"git\",\r\n    \"url\": \"git+https://github.com/jspsych/jsPsych.git\",\r\n    \"directory\": \"packages/plugin-resize\"\r\n  },\r\n  \"author\": \"Steve Chao\",\r\n  \"license\": \"MIT\",\r\n  \"bugs\": {\r\n    \"url\": \"https://github.com/jspsych/jsPsych/issues\"\r\n  },\r\n  \"homepage\": \"https://www.jspsych.org/latest/plugins/resize\",\r\n  \"peerDependencies\": {\r\n    \"jspsych\": \">=7.0.0\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"@jspsych/config\": \"^3.2.0\",\r\n    \"@jspsych/test-utils\": \"^1.2.0\"\r\n  }\r\n}\r\n","import { JsPsych, JsPsychPlugin, ParameterType, TrialType } from \"jspsych\";\r\n\r\nimport { version } from \"../package.json\";\r\n\r\nconst info = <const>{\r\n  name: \"resize\",\r\n  version: version,\r\n  parameters: {\r\n    /** The height of the item to be measured. Any units can be used\r\n     * as long as you are consistent with using the same units for\r\n     * all parameters. */\r\n    item_height: {\r\n      type: ParameterType.INT,\r\n      default: 1,\r\n    },\r\n    /** The width of the item to be measured. */\r\n    item_width: {\r\n      type: ParameterType.INT,\r\n      default: 1,\r\n    },\r\n    /** The content displayed below the resizable box and above the button. */\r\n    prompt: {\r\n      type: ParameterType.HTML_STRING,\r\n      default: null,\r\n    },\r\n    /** After the scaling factor is applied, this many pixels will equal one unit of measurement. */\r\n    pixels_per_unit: {\r\n      type: ParameterType.INT,\r\n      default: 100,\r\n    },\r\n    /** The initial size of the box, in pixels, along the largest dimension.\r\n     * The aspect ratio will be set automatically to match the item width and height. */\r\n    starting_size: {\r\n      type: ParameterType.INT,\r\n      default: 100,\r\n    },\r\n    /** Label to display on the button to complete calibration. */\r\n    button_label: {\r\n      type: ParameterType.STRING,\r\n      default: \"Continue\",\r\n    },\r\n  },\r\n  data: {\r\n    /** Final width of the resizable div container, in pixels. */\r\n    final_width_px: {\r\n      type: ParameterType.INT,\r\n    },\r\n    /** Scaling factor that will be applied to the div containing jsPsych content. */\r\n    scale_factor: {\r\n      type: ParameterType.FLOAT,\r\n    },\r\n  },\r\n  // prettier-ignore\r\n  citations: '__CITATIONS__',\r\n};\r\n\r\ntype Info = typeof info;\r\n\r\n/**\r\n *\r\n * This plugin displays a resizable div container that allows the user to drag until the container is the same size as the\r\n * item being measured. Once the user measures the item as close as possible, clicking the button sets a scaling factor\r\n * for the div containing jsPsych content. This causes the stimuli that follow to have a known size, independent of monitor resolution.\r\n *\r\n * @author Steve Chao\r\n * @see {@link https://www.jspsych.org/latest/plugins/resize/ resize plugin documentation on jspsych.org}\r\n */\r\nclass ResizePlugin implements JsPsychPlugin<Info> {\r\n  static info = info;\r\n\r\n  constructor(private jsPsych: JsPsych) {}\r\n\r\n  trial(display_element: HTMLElement, trial: TrialType<Info>) {\r\n    var aspect_ratio = trial.item_width / trial.item_height;\r\n\r\n    // variables to determine div size\r\n    if (trial.item_width >= trial.item_height) {\r\n      var start_div_width = trial.starting_size as number;\r\n      var start_div_height = Math.round(trial.starting_size / aspect_ratio);\r\n    } else {\r\n      var start_div_height = trial.starting_size as number;\r\n      var start_div_width = Math.round(trial.starting_size * aspect_ratio);\r\n    }\r\n\r\n    // create html for display\r\n    var html =\r\n      '<div id=\"jspsych-resize-div\" style=\"border: 2px solid steelblue; height: ' +\r\n      start_div_height +\r\n      \"px; width:\" +\r\n      start_div_width +\r\n      'px; margin: 7px auto; background-color: lightsteelblue; position: relative;\">';\r\n    html +=\r\n      '<div id=\"jspsych-resize-handle\" style=\"cursor: nwse-resize; background-color: steelblue; width: 10px; height: 10px; border: 2px solid lightsteelblue; position: absolute; bottom: 0; right: 0;\"></div>';\r\n    html += \"</div>\";\r\n    if (trial.prompt !== null) {\r\n      html += trial.prompt;\r\n    }\r\n    html += '<a class=\"jspsych-btn\" id=\"jspsych-resize-btn\">' + trial.button_label + \"</a>\";\r\n\r\n    // render\r\n    display_element.innerHTML = html;\r\n\r\n    // function to end trial\r\n    const end_trial = () => {\r\n      // clear document event listeners\r\n      document.removeEventListener(\"mousemove\", resizeevent);\r\n      document.removeEventListener(\"mouseup\", mouseupevent);\r\n\r\n      // finishes trial\r\n\r\n      var trial_data = {\r\n        final_height_px: final_height_px,\r\n        final_width_px: final_width_px,\r\n        scale_factor: scale_factor,\r\n      };\r\n\r\n      this.jsPsych.finishTrial(trial_data);\r\n    };\r\n\r\n    // listens for the click\r\n    document.getElementById(\"jspsych-resize-btn\").addEventListener(\"click\", () => {\r\n      scale();\r\n      end_trial();\r\n    });\r\n\r\n    var dragging = false;\r\n    var origin_x, origin_y;\r\n    var cx, cy;\r\n\r\n    var mousedownevent = (e) => {\r\n      e.preventDefault();\r\n      dragging = true;\r\n      origin_x = e.pageX;\r\n      origin_y = e.pageY;\r\n      cx = parseInt(scale_div.style.width);\r\n      cy = parseInt(scale_div.style.height);\r\n    };\r\n\r\n    display_element\r\n      .querySelector(\"#jspsych-resize-handle\")\r\n      .addEventListener(\"mousedown\", mousedownevent);\r\n\r\n    var mouseupevent = (e) => {\r\n      dragging = false;\r\n    };\r\n\r\n    document.addEventListener(\"mouseup\", mouseupevent);\r\n\r\n    var scale_div: HTMLDivElement = display_element.querySelector(\"#jspsych-resize-div\");\r\n\r\n    var resizeevent = (e) => {\r\n      if (dragging) {\r\n        var dx = e.pageX - origin_x;\r\n        var dy = e.pageY - origin_y;\r\n\r\n        if (Math.abs(dx) >= Math.abs(dy)) {\r\n          scale_div.style.width = Math.round(Math.max(20, cx + dx * 2)) + \"px\";\r\n          scale_div.style.height = Math.round(Math.max(20, cx + dx * 2) / aspect_ratio) + \"px\";\r\n        } else {\r\n          scale_div.style.height = Math.round(Math.max(20, cy + dy * 2)) + \"px\";\r\n          scale_div.style.width = Math.round(aspect_ratio * Math.max(20, cy + dy * 2)) + \"px\";\r\n        }\r\n      }\r\n    };\r\n\r\n    document.addEventListener(\"mousemove\", resizeevent);\r\n\r\n    // scales the stimulus\r\n    var scale_factor;\r\n    var final_height_px, final_width_px;\r\n    function scale() {\r\n      final_width_px = scale_div.offsetWidth;\r\n      //final_height_px = scale_div.offsetHeight;\r\n\r\n      var pixels_unit_screen = final_width_px / trial.item_width;\r\n\r\n      scale_factor = pixels_unit_screen / trial.pixels_per_unit;\r\n      document.getElementById(\"jspsych-content\").style.transform = \"scale(\" + scale_factor + \")\";\r\n    }\r\n  }\r\n}\r\n\r\nexport default ResizePlugin;\r\n"],"names":[],"mappings":";;;EAEE,IAAW,OAAA,GAAA,OAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ICmDA,SAAA,EAAA;EAAA;;KAAe;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}