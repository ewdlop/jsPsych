var jsPsychWebgazerValidate=function(n){"use strict";var b="2.1.0";const w={name:"webgazer-validate",version:b,parameters:{validation_points:{type:n.ParameterType.INT,default:[[10,10],[10,50],[10,90],[50,10],[50,50],[50,90],[90,10],[90,50],[90,90]],array:!0},validation_point_coordinates:{type:n.ParameterType.SELECT,default:"percent",options:["percent","center-offset-pixels"]},roi_radius:{type:n.ParameterType.INT,default:200},randomize_validation_order:{type:n.ParameterType.BOOL,default:!1},time_to_saccade:{type:n.ParameterType.INT,default:1e3},validation_duration:{type:n.ParameterType.INT,default:2e3},point_size:{type:n.ParameterType.INT,default:20},show_validation_data:{type:n.ParameterType.BOOL,default:!1}},data:{raw_gaze:{type:n.ParameterType.COMPLEX,array:!0,nested:{x:{type:n.ParameterType.INT},y:{type:n.ParameterType.INT},dx:{type:n.ParameterType.INT},dy:{type:n.ParameterType.INT}}},percent_in_roi:{type:n.ParameterType.FLOAT,array:!0},average_offset:{type:n.ParameterType.FLOAT,array:!0},samples_per_sec:{type:n.ParameterType.FLOAT},validation_points:{type:n.ParameterType.INT,array:!0}},citations:{apa:"de Leeuw, J. R., Gilbert, R. A., & Luchterhandt, B. (2023). jsPsych: Enabling an Open-Source Collaborative Ecosystem of Behavioral Experiments. Journal of Open Source Software, 8(85), 5351. https://doi.org/10.21105/joss.05351 ",bibtex:'@article{Leeuw2023jsPsych, 	author = {de Leeuw, Joshua R. and Gilbert, Rebecca A. and Luchterhandt, Bj{\\" o}rn}, 	journal = {Journal of Open Source Software}, 	doi = {10.21105/joss.05351}, 	issn = {2475-9066}, 	number = {85}, 	year = {2023}, 	month = {may 11}, 	pages = {5351}, 	publisher = {Open Journals}, 	title = {jsPsych: Enabling an {Open}-{Source} {Collaborative} {Ecosystem} of {Behavioral} {Experiments}}, 	url = {https://joss.theoj.org/papers/10.21105/joss.05351}, 	volume = {8}, }  '}};class h{constructor(v){this.jsPsych=v}trial(v,i){const s=this.jsPsych.extensions.webgazer;var p={};p.raw_gaze=[],p.percent_in_roi=[],p.average_offset=[],p.validation_points=null;var $=`
        <div id='webgazer-validate-container' style='position: relative; width:100vw; height:100vh; overflow: hidden;'>
        </div>`;v.innerHTML=$;var f=v.querySelector("#webgazer-validate-container"),_=-1,u=null,T=performance.now();const y=()=>{s.stopSampleInterval(),this.jsPsych.finishTrial(p)},P=t=>{var e=g(t[0],t[1]);f.innerHTML=e;var r=f.querySelector(".validation-point"),o=r.getBoundingClientRect(),a=o.left+o.width/2,l=o.top+o.height/2,d=performance.now()+i.time_to_saccade,R=d+i.validation_duration,m=[],G=s.onGazeUpdate(c=>{performance.now()>d&&m.push({x:c.x,y:c.y,dx:c.x-a,dy:c.y-l,t:Math.round(c.t-T)})});requestAnimationFrame(function c(){performance.now()<R?requestAnimationFrame(c):(p.raw_gaze.push(m),G(),x())})},x=()=>{if(_++,_==u.length)M();else{var t=u[_];P(t)}},z=()=>{i.randomize_validation_order?u=this.jsPsych.randomization.shuffle(i.validation_points):u=i.validation_points,p.validation_points=u,_=-1,s.startSampleInterval(),x()},L=()=>{for(var t="",e=0;e<i.validation_points.length;e++){t+=g(i.validation_points[e][0],i.validation_points[e][1]),t+=S(i.validation_points[e][0],i.validation_points[e][1],0,0,i.roi_radius);for(var r=0;r<p.raw_gaze[e].length;r++)t+=q(i.validation_points[e][0],i.validation_points[e][1],p.raw_gaze[e][r].dx,p.raw_gaze[e][r].dy)}t+='<button id="cont" style="position:absolute; top: 50%; left:calc(50% - 50px); width: 100px;" class="jspsych-btn">Continue</btn>',f.innerHTML=t,f.querySelector("#cont").addEventListener("click",()=>{s.pause(),y()}),s.showPredictions(),s.stopSampleInterval(),s.resume()},M=()=>{p.samples_per_sec=J(p.raw_gaze).toFixed(2);for(var t=0;t<i.validation_points.length;t++)p.percent_in_roi[t]=F(p.raw_gaze[t]),p.average_offset[t]=C(p.raw_gaze[t]);i.show_validation_data?L():y()};z();function g(t,e){if(i.validation_point_coordinates=="percent")return I(t,e);if(i.validation_point_coordinates=="center-offset-pixels")return O(t,e)}function I(t,e){return`<div class="validation-point" style="width:${i.point_size}px; height:${i.point_size}px; border-radius:${i.point_size}px; border: 1px solid #000; background-color: #333; position: absolute; left:${t}%; top:${e}%;"></div>`}function O(t,e){return`<div class="validation-point" style="width:${i.point_size}px; height:${i.point_size}px; border-radius:${i.point_size}px; border: 1px solid #000; background-color: #333; position: absolute; left:calc(50% - ${i.point_size/2}px + ${t}px); top:calc(50% - ${i.point_size/2}px + ${e}px);"></div>`}function S(t,e,r,o,a){if(i.validation_point_coordinates=="percent")return E(t,e,r,o,a);if(i.validation_point_coordinates=="center-offset-pixels")return N(t,e,r,o,a)}function E(t,e,r,o,a){var l=`
          <div class="validation-centroid" style="width:${a*2}px; height:${a*2}px; border: 2px dotted #ccc; border-radius: ${a}px; background-color: transparent; position: absolute; left:calc(${t}% + ${r-a}px); top:calc(${e}% + ${o-a}px);"></div>
        `;return l}function N(t,e,r,o,a){var l=`
          <div class="validation-centroid" style="width:${a*2}px; height:${a*2}px; border: 2px dotted #ccc; border-radius: ${a}px; background-color: transparent; position: absolute; left:calc(50% + ${t}px + ${r-a}px); top:calc(50% + ${e}px + ${o-a}px);"></div>
        `;return l}function q(t,e,r,o){if(i.validation_point_coordinates=="percent")return k(t,e,r,o);if(i.validation_point_coordinates=="center-offset-pixels")return A(t,e,r,o)}function k(t,e,r,o){var a=Math.sqrt(r*r+o*o)<=i.roi_radius?"#afa":"#faa";return`<div class="raw-data-point" style="width:5px; height:5px; border-radius:5px; background-color: ${a}; opacity:0.8; position: absolute; left:calc(${t}% + ${r-2}px); top:calc(${e}% + ${o-2}px);"></div>`}function A(t,e,r,o){var a=Math.sqrt(r*r+o*o)<=i.roi_radius?"#afa":"#faa";return`<div class="raw-data-point" style="width:5px; height:5px; border-radius:5px; background-color: ${a}; opacity:0.8; position: absolute; left:calc(50% + ${t}px + ${r-2}px); top:calc(50% + ${e}px + ${o-2}px);"></div>`}function B(t){var e=Math.floor(t.length/2),r=t.sort((o,a)=>o-a);return t.length%2==0?r[e-1]+r[e]/2:r[e]}function C(t){var e=t.reduce((a,l,d)=>(a+=l.dx,d==t.length-1?a/t.length:a),0),r=t.reduce((a,l,d)=>(a+=l.dy,d==t.length-1?a/t.length:a),0),o=B(t.map(a=>Math.sqrt(Math.pow(a.dx-e,2)+Math.pow(a.dy-r,2))));return{x:e,y:r,r:o}}function F(t){var e=t.map(a=>Math.sqrt(Math.pow(a.dx,2)+Math.pow(a.dy,2))),r=e.reduce((a,l)=>(l<=i.roi_radius&&a++,a),0),o=r/t.length*100;return o}function J(t){var e=[];if(t.length==0)return 0;for(var r=0;r<t.length;r++)if(t[r].length>1){for(var o=[],a=1;a<t[r].length;a++)o.push(t[r][a].t-t[r][a-1].t);e.push(o.reduce((l,d)=>l+d,0)/o.length)}return e.length>0?1e3/(e.reduce((l,d)=>l+d,0)/e.length):null}}}return h.info=w,h}(jsPsychModule);
//# sourceMappingURL=index.browser.min.js.map
