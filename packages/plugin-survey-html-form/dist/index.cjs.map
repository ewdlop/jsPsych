{"version":3,"file":"index.cjs","sources":["../package.json","../src/index.ts"],"sourcesContent":["{\r\n  \"name\": \"@jspsych/plugin-survey-html-form\",\r\n  \"version\": \"2.1.0\",\r\n  \"description\": \"a jspsych plugin for free html forms\",\r\n  \"type\": \"module\",\r\n  \"main\": \"dist/index.cjs\",\r\n  \"exports\": {\r\n    \"import\": \"./dist/index.js\",\r\n    \"require\": \"./dist/index.cjs\"\r\n  },\r\n  \"typings\": \"dist/index.d.ts\",\r\n  \"unpkg\": \"dist/index.browser.min.js\",\r\n  \"files\": [\r\n    \"src\",\r\n    \"dist\"\r\n  ],\r\n  \"source\": \"src/index.ts\",\r\n  \"scripts\": {\r\n    \"test\": \"jest\",\r\n    \"test:watch\": \"npm test -- --watch\",\r\n    \"tsc\": \"tsc\",\r\n    \"build\": \"rollup --config\",\r\n    \"build:watch\": \"npm run build -- --watch\"\r\n  },\r\n  \"repository\": {\r\n    \"type\": \"git\",\r\n    \"url\": \"git+https://github.com/jspsych/jsPsych.git\",\r\n    \"directory\": \"packages/plugin-survey-html-form\"\r\n  },\r\n  \"author\": \"Jan Simson\",\r\n  \"license\": \"MIT\",\r\n  \"bugs\": {\r\n    \"url\": \"https://github.com/jspsych/jsPsych/issues\"\r\n  },\r\n  \"homepage\": \"https://www.jspsych.org/latest/plugins/survey-html-form\",\r\n  \"peerDependencies\": {\r\n    \"jspsych\": \">=7.1.0\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"@jspsych/config\": \"^3.2.0\",\r\n    \"@jspsych/test-utils\": \"^1.2.0\"\r\n  }\r\n}\r\n","import { JsPsych, JsPsychPlugin, ParameterType, TrialType } from \"jspsych\";\r\n\r\nimport { version } from \"../package.json\";\r\n\r\nconst info = <const>{\r\n  name: \"survey-html-form\",\r\n  version: version,\r\n  parameters: {\r\n    /** HTML formatted string containing all the input elements to display. Every element has to have its own distinctive name attribute. The <form> tag must not be included and is generated by the plugin. */\r\n    html: {\r\n      type: ParameterType.HTML_STRING,\r\n      default: null,\r\n    },\r\n    /** HTML formatted string to display at the top of the page above all the questions. */\r\n    preamble: {\r\n      type: ParameterType.HTML_STRING,\r\n      default: null,\r\n    },\r\n    /** The text that appears on the button to finish the trial. */\r\n    button_label: {\r\n      type: ParameterType.STRING,\r\n      default: \"Continue\",\r\n    },\r\n    /** The HTML element ID of a form field to autofocus on. */\r\n    autofocus: {\r\n      type: ParameterType.STRING,\r\n      default: \"\",\r\n    },\r\n    /** Retrieve the data as an array e.g. [{name: \"INPUT_NAME\", value: \"INPUT_VALUE\"}, ...] instead of an object e.g. {INPUT_NAME: INPUT_VALUE, ...}. */\r\n    dataAsArray: {\r\n      type: ParameterType.BOOL,\r\n      default: false,\r\n    },\r\n    /** Setting this to true will enable browser auto-complete or auto-fill for the form. */\r\n    autocomplete: {\r\n      type: ParameterType.BOOL,\r\n      default: false,\r\n    },\r\n  },\r\n  data: {\r\n    /**  An object containing the response for each input. The object will have a separate key (variable) for the response to each input, with each variable being named after its corresponding input element. Each response is a string containing whatever the participant answered for this particular input. This will be encoded as a JSON string when data is saved using the `.json()` or `.csv()` functions. */\r\n    response: {\r\n      type: ParameterType.OBJECT,\r\n    },\r\n    /** The response time in milliseconds for the participant to make a response. */\r\n    rt: {\r\n      type: ParameterType.INT,\r\n    },\r\n  },\r\n  // prettier-ignore\r\n  citations: '__CITATIONS__',\r\n};\r\n\r\ntype Info = typeof info;\r\n\r\n/**\r\n *\r\n * The survey-html-form plugin displays a set of `<inputs>` from a HTML string. The type of input can be freely\r\n * chosen, for a list of possible input types see the [MDN page on inputs](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input).\r\n * The participant provides answers to the input fields.\r\n * @author Jan Simson\r\n * @see {@link https://www.jspsych.org/latest/plugins/survey-html-form/ survey-html-form plugin documentation on jspsych.org}\r\n */\r\nclass SurveyHtmlFormPlugin implements JsPsychPlugin<Info> {\r\n  static info = info;\r\n\r\n  constructor(private jsPsych: JsPsych) {}\r\n\r\n  trial(display_element: HTMLElement, trial: TrialType<Info>) {\r\n    var html = \"\";\r\n    // show preamble text\r\n    if (trial.preamble !== null) {\r\n      html +=\r\n        '<div id=\"jspsych-survey-html-form-preamble\" class=\"jspsych-survey-html-form-preamble\">' +\r\n        trial.preamble +\r\n        \"</div>\";\r\n    }\r\n    // start form\r\n    if (trial.autocomplete) {\r\n      html += '<form id=\"jspsych-survey-html-form\">';\r\n    } else {\r\n      html += '<form id=\"jspsych-survey-html-form\" autocomplete=\"off\">';\r\n    }\r\n\r\n    // add form HTML / input elements\r\n    html += trial.html;\r\n\r\n    // add submit button\r\n    html +=\r\n      '<input type=\"submit\" id=\"jspsych-survey-html-form-next\" class=\"jspsych-btn jspsych-survey-html-form\" value=\"' +\r\n      trial.button_label +\r\n      '\"></input>';\r\n\r\n    html += \"</form>\";\r\n    display_element.innerHTML = html;\r\n\r\n    if (trial.autofocus !== \"\") {\r\n      var focus_elements = display_element.querySelectorAll<HTMLInputElement>(\r\n        \"#\" + trial.autofocus\r\n      );\r\n      if (focus_elements.length === 0) {\r\n        console.warn(\"No element found with id: \" + trial.autofocus);\r\n      } else if (focus_elements.length > 1) {\r\n        console.warn('The id \"' + trial.autofocus + '\" is not unique so autofocus will not work.');\r\n      } else {\r\n        focus_elements[0].focus();\r\n      }\r\n    }\r\n\r\n    display_element\r\n      .querySelector(\"#jspsych-survey-html-form\")\r\n      .addEventListener(\"submit\", (event) => {\r\n        // don't submit form\r\n        event.preventDefault();\r\n\r\n        // measure response time\r\n        var endTime = performance.now();\r\n        var response_time = Math.round(endTime - startTime);\r\n\r\n        var this_form = display_element.querySelector(\"#jspsych-survey-html-form\");\r\n        var question_data = serializeArray(this_form);\r\n\r\n        if (!trial.dataAsArray) {\r\n          question_data = objectifyForm(question_data);\r\n        }\r\n\r\n        // save data\r\n        var trialdata = {\r\n          rt: response_time,\r\n          response: question_data,\r\n        };\r\n\r\n        // next trial\r\n        this.jsPsych.finishTrial(trialdata);\r\n      });\r\n\r\n    var startTime = performance.now();\r\n\r\n    /**\r\n     * Serialize all form data into an array\r\n     * @copyright (c) 2018 Chris Ferdinandi, MIT License, https://gomakethings.com\r\n     * @param  {Node}   form The form to serialize\r\n     * @return {String}      The serialized form data\r\n     */\r\n    function serializeArray(form) {\r\n      // Setup our serialized data\r\n      var serialized = [];\r\n\r\n      // Loop through each field in the form\r\n      for (var i = 0; i < form.elements.length; i++) {\r\n        var field = form.elements[i];\r\n\r\n        // Don't serialize fields without a name, submits, buttons, file and reset inputs, and disabled fields\r\n        if (\r\n          !field.name ||\r\n          field.disabled ||\r\n          field.type === \"file\" ||\r\n          field.type === \"reset\" ||\r\n          field.type === \"submit\" ||\r\n          field.type === \"button\"\r\n        )\r\n          continue;\r\n\r\n        // If a multi-select, get all selections\r\n        if (field.type === \"select-multiple\") {\r\n          for (var n = 0; n < field.options.length; n++) {\r\n            if (!field.options[n].selected) continue;\r\n            serialized.push({\r\n              name: field.name,\r\n              value: field.options[n].value,\r\n            });\r\n          }\r\n        }\r\n\r\n        // Convert field data to a query string\r\n        else if ((field.type !== \"checkbox\" && field.type !== \"radio\") || field.checked) {\r\n          serialized.push({\r\n            name: field.name,\r\n            value: field.value,\r\n          });\r\n        }\r\n      }\r\n\r\n      return serialized;\r\n    }\r\n\r\n    // from https://stackoverflow.com/questions/1184624/convert-form-data-to-javascript-object-with-jquery\r\n    function objectifyForm(formArray) {\r\n      //serialize data function\r\n      var returnArray = <any>{};\r\n      for (var i = 0; i < formArray.length; i++) {\r\n        returnArray[formArray[i][\"name\"]] = formArray[i][\"value\"];\r\n      }\r\n      return returnArray;\r\n    }\r\n  }\r\n}\r\n\r\nexport default SurveyHtmlFormPlugin;\r\n"],"names":[],"mappings":";;;;AAEE,IAAW,OAAA,GAAA,OAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ECgDA,SAAA,EAAA;AAAA;;GAAe;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}