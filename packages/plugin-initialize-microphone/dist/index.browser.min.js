var jsPsychInitializeMicrophone=function(s){"use strict";var p="2.1.0",u=(h,e,t)=>new Promise((n,i)=>{var r=a=>{try{o(t.next(a))}catch(l){i(l)}},c=a=>{try{o(t.throw(a))}catch(l){i(l)}},o=a=>a.done?n(a.value):Promise.resolve(a.value).then(r,c);o((t=t.apply(h,e)).next())});const m={name:"initialize-microphone",version:p,parameters:{device_select_message:{type:s.ParameterType.HTML_STRING,default:"<p>Please select the microphone you would like to use.</p>"},button_label:{type:s.ParameterType.STRING,default:"Use this microphone"}},data:{device_id:{type:s.ParameterType.STRING}},citations:{apa:"de Leeuw, J. R., Gilbert, R. A., & Luchterhandt, B. (2023). jsPsych: Enabling an Open-Source Collaborative Ecosystem of Behavioral Experiments. Journal of Open Source Software, 8(85), 5351. https://doi.org/10.21105/joss.05351 ",bibtex:'@article{Leeuw2023jsPsych, 	author = {de Leeuw, Joshua R. and Gilbert, Rebecca A. and Luchterhandt, Bj{\\" o}rn}, 	journal = {Journal of Open Source Software}, 	doi = {10.21105/joss.05351}, 	issn = {2475-9066}, 	number = {85}, 	year = {2023}, 	month = {may 11}, 	pages = {5351}, 	publisher = {Open Journals}, 	title = {jsPsych: Enabling an {Open}-{Source} {Collaborative} {Ecosystem} of {Behavioral} {Experiments}}, 	url = {https://joss.theoj.org/papers/10.21105/joss.05351}, 	volume = {8}, }  '}};class d{constructor(e){this.jsPsych=e}trial(e,t){this.run_trial(e,t).then(n=>{this.jsPsych.finishTrial({device_id:n})})}run_trial(e,t){return u(this,null,function*(){yield this.askForPermission(),this.showMicrophoneSelection(e,t),this.updateDeviceList(e),navigator.mediaDevices.ondevicechange=r=>{this.updateDeviceList(e)};const n=yield this.waitForSelection(e),i=yield navigator.mediaDevices.getUserMedia({audio:{deviceId:n}});return this.jsPsych.pluginAPI.initializeMicrophoneRecorder(i),n})}askForPermission(){return u(this,null,function*(){return yield navigator.mediaDevices.getUserMedia({audio:!0,video:!1})})}showMicrophoneSelection(e,t){let n=`
      ${t.device_select_message}
      <select name="mic" id="which-mic" style="font-size:14px; font-family: 'Open Sans', 'Arial', sans-serif; padding: 4px;">
      </select>
      <p><button class="jspsych-btn" id="btn-select-mic">${t.button_label}</button></p>`;e.innerHTML=n}waitForSelection(e){return new Promise(t=>{e.querySelector("#btn-select-mic").addEventListener("click",()=>{const n=e.querySelector("#which-mic").value;t(n)})})}updateDeviceList(e){navigator.mediaDevices.enumerateDevices().then(t=>{const n=t.filter(i=>i.kind==="audioinput"&&i.deviceId!=="default"&&i.deviceId!=="communications").filter((i,r,c)=>c.findIndex(o=>o.groupId==i.groupId)==r);e.querySelector("#which-mic").innerHTML="",n.forEach(i=>{let r=document.createElement("option");r.value=i.deviceId,r.innerHTML=i.label,e.querySelector("#which-mic").appendChild(r)})})}}return d.info=m,d}(jsPsychModule);
//# sourceMappingURL=index.browser.min.js.map
