var jsPsychFreeSort=function(t){"use strict";var E="2.1.0";function R(a){let r=a.length,e,i;for(;r!==0;)i=Math.floor(Math.random()*r),r-=1,e=a[r],a[r]=a[i],a[i]=e;return a}function P(a,r,e){const i=(r-a)/(e-1);let n=[];for(let l=0;l<e;l++)n.push(a+i*l);return n}function O(a,r,e,i,n,l,d=!1){return d?Math.abs(a-e)<=n&&Math.abs(r-i)<=l:(a-e)*(a-e)*(l*l)+(r-i)*(r-i)*(n*n)<=n*n*(l*l)}function q(a,r){const e=Math.floor(Math.random()*(a-1)),i=Math.floor(Math.random()*(r-1));return{x:e,y:i}}const B={name:"free-sort",version:E,parameters:{stimuli:{type:t.ParameterType.IMAGE,default:void 0,array:!0},stim_height:{type:t.ParameterType.INT,default:100},stim_width:{type:t.ParameterType.INT,default:100},scale_factor:{type:t.ParameterType.FLOAT,default:1.5},sort_area_height:{type:t.ParameterType.INT,default:700},sort_area_width:{type:t.ParameterType.INT,default:700},sort_area_shape:{type:t.ParameterType.SELECT,options:["square","ellipse"],default:"ellipse"},prompt:{type:t.ParameterType.HTML_STRING,default:""},prompt_location:{type:t.ParameterType.SELECT,options:["above","below"],default:"above"},button_label:{type:t.ParameterType.STRING,default:"Continue"},change_border_background_color:{type:t.ParameterType.BOOL,default:!0},border_color_in:{type:t.ParameterType.STRING,default:"#a1d99b"},border_color_out:{type:t.ParameterType.STRING,default:"#fc9272"},border_width:{type:t.ParameterType.INT,default:null},counter_text_unfinished:{type:t.ParameterType.HTML_STRING,default:"You still need to place %n% item%s% inside the sort area."},counter_text_finished:{type:t.ParameterType.HTML_STRING,default:"All items placed. Feel free to reposition items if necessary."},stim_starts_inside:{type:t.ParameterType.BOOL,default:!1},column_spread_factor:{type:t.ParameterType.FLOAT,default:1}},data:{init_locations:{type:t.ParameterType.STRING,array:!0},moves:{type:t.ParameterType.COMPLEX,array:!0,nested:{src:{type:t.ParameterType.STRING},x:{type:t.ParameterType.INT},y:{type:t.ParameterType.INT}}},final_locations:{type:t.ParameterType.COMPLEX,array:!0,nested:{src:{type:t.ParameterType.STRING},x:{type:t.ParameterType.INT},y:{type:t.ParameterType.INT}}},rt:{type:t.ParameterType.INT}},citations:{apa:"de Leeuw, J. R., Gilbert, R. A., & Luchterhandt, B. (2023). jsPsych: Enabling an Open-Source Collaborative Ecosystem of Behavioral Experiments. Journal of Open Source Software, 8(85), 5351. https://doi.org/10.21105/joss.05351 ",bibtex:'@article{Leeuw2023jsPsych, 	author = {de Leeuw, Joshua R. and Gilbert, Rebecca A. and Luchterhandt, Bj{\\" o}rn}, 	journal = {Journal of Open Source Software}, 	doi = {10.21105/joss.05351}, 	issn = {2475-9066}, 	number = {85}, 	year = {2023}, 	month = {may 11}, 	pages = {5351}, 	publisher = {Open Journals}, 	title = {jsPsych: Enabling an {Open}-{Source} {Collaborative} {Ecosystem} of {Behavioral} {Experiments}}, 	url = {https://joss.theoj.org/papers/10.21105/joss.05351}, 	volume = {8}, }  '}};class x{constructor(r){this.jsPsych=r}trial(r,e){var i=performance.now(),n=e.border_color_out,l=e.border_width,d=e.stimuli;e.change_border_background_color==!1&&(n="#000000"),e.border_width==null&&(l=e.sort_area_height*.03);let p='<div id="jspsych-free-sort-arena" class="jspsych-free-sort-arena" style="position: relative; width:'+e.sort_area_width+"px; height:"+e.sort_area_height+'px; margin: auto;"</div>';p+='<div id="jspsych-free-sort-border" class="jspsych-free-sort-border" style="position: relative; width:'+e.sort_area_width*.94+"px; height:"+e.sort_area_height*.94+"px; border:"+l+"px solid "+n+"; margin: auto; line-height: 0em; ",e.sort_area_shape=="ellipse"?p+='webkit-border-radius: 50%; moz-border-radius: 50%; border-radius: 50%"></div>':p+='webkit-border-radius: 0%; moz-border-radius: 0%; border-radius: 0%"></div>';const L='<div style="line-height: 1.0em;">'+e.prompt+'<p id="jspsych-free-sort-counter" style="display: inline-block;">'+I(d.length)+"</p></div>";e.prompt_location=="below"?p+=L:p=L+p,p+='<div><button id="jspsych-free-sort-done-btn" class="jspsych-btn" style="margin-top: 5px; margin-bottom: 15px; visibility: hidden;">'+e.button_label+"</button></div>",r.innerHTML=p;let M=[];if(!e.stim_starts_inside){let o=Math.ceil(Math.sqrt(d.length));o%2!=0&&(o=o+1);var b=[],u=[];for(const _ of P(0,e.sort_area_width-e.stim_width,o))for(const s of P(0,e.sort_area_height-e.stim_height,o))_>(e.sort_area_width-e.stim_width)*.5?b.push({x:_+e.sort_area_width*(.5*e.column_spread_factor),y:s}):u.push({x:_-e.sort_area_width*(.5*e.column_spread_factor),y:s});for(;b.length+u.length<d.length;)b=b.concat(b),u=u.concat(u);u=u.reverse(),d=R(d)}for(let o=0;o<d.length;o++){var m;e.stim_starts_inside?m=q(e.sort_area_width-e.stim_width,e.sort_area_height-e.stim_height):o%2==0?m=b[Math.floor(o*.5)]:m=u[Math.floor(o*.5)],r.querySelector("#jspsych-free-sort-arena").innerHTML+='<img src="'+d[o]+'" data-src="'+d[o]+'" class="jspsych-free-sort-draggable" draggable="false" id="jspsych-free-sort-draggable-'+o+'" style="position: absolute; cursor: move; width:'+e.stim_width+"px; height:"+e.stim_height+"px; top:"+m.y+"px; left:"+m.x+'px;"></img>',M.push({src:d[o],x:m.x,y:m.y})}const y=d.map(()=>e.stim_starts_inside),S=[];let T=!1;const C=Array.prototype.slice.call(r.querySelectorAll(".jspsych-free-sort-draggable")),c=r.querySelector("#jspsych-free-sort-border"),v=r.querySelector("#jspsych-free-sort-done-btn");y.some(Boolean)&&e.change_border_background_color&&(c.style.borderColor=e.border_color_in),y.every(Boolean)&&(e.change_border_background_color&&(c.style.background=e.border_color_in),v.style.visibility="visible",r.querySelector("#jspsych-free-sort-counter").innerHTML=e.counter_text_finished);for(const o of C)o.addEventListener("pointerdown",function({clientX:_,clientY:s}){let h=_-this.offsetLeft,g=s-this.offsetTop-window.scrollY;this.style.transform="scale("+e.scale_factor+","+e.scale_factor+")";const f=({clientX:w,clientY:k})=>{T=O(w-h,k-g,e.sort_area_width*.5-e.stim_width*.5,e.sort_area_height*.5-e.stim_height*.5,e.sort_area_width*.5,e.sort_area_height*.5,e.sort_area_shape=="square"),this.style.top=Math.min(e.sort_area_height-e.stim_height*.5,Math.max(-e.stim_height*.5,k-g))+"px",this.style.left=Math.min(e.sort_area_width*1.5-e.stim_width,Math.max(-e.sort_area_width*.5,w-h))+"px",e.change_border_background_color&&(T?(c.style.borderColor=e.border_color_in,c.style.background="None"):(c.style.borderColor=n,c.style.background="None"));var G=parseInt(this.id.split("jspsych-free-sort-draggable-")[1],10);y.splice(G,1,T),y.every(Boolean)?(e.change_border_background_color&&(c.style.background=e.border_color_in),v.style.visibility="visible",r.querySelector("#jspsych-free-sort-counter").innerHTML=e.counter_text_finished):(c.style.background="none",v.style.visibility="hidden",r.querySelector("#jspsych-free-sort-counter").innerHTML=I(y.length-y.filter(Boolean).length))};document.addEventListener("pointermove",f);const N=w=>{document.removeEventListener("pointermove",f),this.style.transform="scale(1, 1)",e.change_border_background_color&&(y.every(Boolean)?(c.style.background=e.border_color_in,c.style.borderColor=e.border_color_in):(c.style.background="none",c.style.borderColor=n)),S.push({src:this.dataset.src,x:this.offsetLeft,y:this.offsetTop}),document.removeEventListener("pointerup",N)};document.addEventListener("pointerup",N)});r.querySelector("#jspsych-free-sort-done-btn").addEventListener("click",()=>{if(y.every(Boolean)){const o=performance.now(),_=Math.round(o-i),s=r.querySelectorAll(".jspsych-free-sort-draggable");let h=[];for(let f=0;f<s.length;f++)h.push({src:s[f].dataset.src,x:parseInt(s[f].style.left),y:parseInt(s[f].style.top)});const g={init_locations:M,moves:S,final_locations:h,rt:_};this.jsPsych.finishTrial(g)}});function I(o){for(var _="",s=e.counter_text_unfinished.split("%"),h=0;h<s.length;h++)h%2===0?_+=s[h]:s[h]=="n"?_+=o.toString():s[h]=="s"&&o>1&&(_+="s");return _}}}return x.info=B,x}(jsPsychModule);
//# sourceMappingURL=index.browser.min.js.map
