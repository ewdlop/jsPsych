var jsPsychExtensionRecordVideo=function(d){"use strict";function u(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}const p=e=>{const r=new Set;do for(const t of Reflect.ownKeys(e))r.add([e,t]);while((e=Reflect.getPrototypeOf(e))&&e!==Object.prototype);return r};var y=(e,{include:r,exclude:t}={})=>{const n=s=>{const a=o=>typeof o=="string"?s===o:o.test(s);return r?r.some(a):t?!t.some(a):!0};for(const[s,a]of p(e.constructor.prototype)){if(a==="constructor"||!n(a))continue;const o=Reflect.getOwnPropertyDescriptor(s,a);o&&typeof o.value=="function"&&(e[a]=e[a].bind(e))}return e},f=u(y),m="1.2.0",v=(e,r,t)=>new Promise((n,s)=>{var a=i=>{try{l(t.next(i))}catch(c){s(c)}},o=i=>{try{l(t.throw(i))}catch(c){s(c)}},l=i=>i.done?n(i.value):Promise.resolve(i.value).then(a,o);l((t=t.apply(e,r)).next())});class h{constructor(r){this.jsPsych=r,this.recordedChunks=[],this.recorder=null,this.currentTrialData=null,this.trialComplete=!1,this.onUpdateCallback=null,this.initialize=()=>v(this,null,function*(){}),this.on_start=()=>{if(this.recorder=this.jsPsych.pluginAPI.getCameraRecorder(),this.recordedChunks=[],this.trialComplete=!1,this.currentTrialData={},!this.recorder){console.warn("The record-video extension is trying to start but the camera is not initialized. Do you need to run the initialize-camera plugin?");return}this.recorder.addEventListener("dataavailable",this.handleOnDataAvailable)},this.on_load=()=>{this.recorder.start()},this.on_finish=()=>new Promise(t=>{this.trialComplete=!0,this.recorder.stop(),this.currentTrialData.record_video_data?t(this.currentTrialData):this.onUpdateCallback=()=>{t(this.currentTrialData)}}),f(this)}handleOnDataAvailable(r){r.data.size>0&&(console.log("chunks added"),this.recordedChunks.push(r.data),this.trialComplete&&this.updateData())}updateData(){const r=new Blob(this.recordedChunks,{type:this.recorder.mimeType}),t=new FileReader;t.addEventListener("load",()=>{const n=t.result.split(",")[1];this.currentTrialData.record_video_data=n,this.onUpdateCallback&&this.onUpdateCallback()}),t.readAsDataURL(r)}}return h.info={name:"record-video",version:m,data:{record_video_data:{type:d.ParameterType.STRING}},citations:{apa:"de Leeuw, J. R., Gilbert, R. A., & Luchterhandt, B. (2023). jsPsych: Enabling an Open-Source Collaborative Ecosystem of Behavioral Experiments. Journal of Open Source Software, 8(85), 5351. https://doi.org/10.21105/joss.05351 ",bibtex:'@article{Leeuw2023jsPsych, 	author = {de Leeuw, Joshua R. and Gilbert, Rebecca A. and Luchterhandt, Bj{\\" o}rn}, 	journal = {Journal of Open Source Software}, 	doi = {10.21105/joss.05351}, 	issn = {2475-9066}, 	number = {85}, 	year = {2023}, 	month = {may 11}, 	pages = {5351}, 	publisher = {Open Journals}, 	title = {jsPsych: Enabling an {Open}-{Source} {Collaborative} {Ecosystem} of {Behavioral} {Experiments}}, 	url = {https://joss.theoj.org/papers/10.21105/joss.05351}, 	volume = {8}, }  '}},h}(jsPsychModule);
//# sourceMappingURL=index.browser.min.js.map
