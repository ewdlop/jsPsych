{"version":3,"file":"index.cjs","sources":["../package.json","../src/ExtensionManager.ts","../src/modules/utils.ts","../src/modules/data/DataColumn.ts","../src/modules/data/utils.ts","../src/modules/data/DataCollection.ts","../src/modules/data/index.ts","../src/modules/plugin-api/KeyboardListenerAPI.ts","../src/modules/plugins.ts","../src/modules/plugin-api/AudioPlayer.ts","../src/modules/plugin-api/MediaAPI.ts","../src/modules/plugin-api/SimulationAPI.ts","../src/modules/plugin-api/TimeoutAPI.ts","../src/modules/plugin-api/index.ts","../src/modules/randomization.ts","../src/modules/turk.ts","../src/ProgressBar.ts","../src/timeline/index.ts","../src/timeline/util.ts","../src/timeline/TimelineNode.ts","../src/timeline/Trial.ts","../src/timeline/Timeline.ts","../src/JsPsych.ts","../src/migration.ts","../src/index.ts"],"sourcesContent":["{\r\n  \"name\": \"jspsych\",\r\n  \"version\": \"8.2.2\",\r\n  \"description\": \"Behavioral experiments in a browser\",\r\n  \"type\": \"module\",\r\n  \"main\": \"dist/index.cjs\",\r\n  \"exports\": {\r\n    \".\": {\r\n      \"import\": \"./dist/index.js\",\r\n      \"require\": \"./dist/index.cjs\"\r\n    },\r\n    \"./css/*\": \"./css/*\"\r\n  },\r\n  \"typings\": \"dist/index.d.ts\",\r\n  \"unpkg\": \"dist/index.browser.min.js\",\r\n  \"files\": [\r\n    \"src\",\r\n    \"dist\",\r\n    \"css\"\r\n  ],\r\n  \"source\": \"src/index.ts\",\r\n  \"scripts\": {\r\n    \"test\": \"jest\",\r\n    \"test:watch\": \"npm test -- --watch\",\r\n    \"tsc\": \"tsc\",\r\n    \"build:js\": \"rollup --config\",\r\n    \"build:styles\": \"webpack-cli\",\r\n    \"build\": \"run-p build:js build:styles\",\r\n    \"build:watch\": \"run-p \\\"build:js -- --watch\\\" \\\"build:styles watch\\\"\",\r\n    \"prepack\": \"cp ../../README.md .\"\r\n  },\r\n  \"repository\": {\r\n    \"type\": \"git\",\r\n    \"url\": \"git+https://github.com/jspsych/jsPsych.git\",\r\n    \"directory\": \"packages/jspsych\"\r\n  },\r\n  \"author\": \"Josh de Leeuw\",\r\n  \"license\": \"MIT\",\r\n  \"bugs\": {\r\n    \"url\": \"https://github.com/jspsych/jsPsych/issues\"\r\n  },\r\n  \"homepage\": \"https://www.jspsych.org\",\r\n  \"dependencies\": {\r\n    \"auto-bind\": \"^4.0.0\",\r\n    \"random-words\": \"^1.1.1\",\r\n    \"seedrandom\": \"^3.0.5\",\r\n    \"type-fest\": \"^2.9.0\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"@fontsource/open-sans\": \"4.5.3\",\r\n    \"@jspsych/config\": \"^3.3.0\",\r\n    \"@types/dom-mediacapture-record\": \"^1.0.11\",\r\n    \"base64-inline-loader\": \"^2.0.1\",\r\n    \"css-loader\": \"^6.6.0\",\r\n    \"mini-css-extract-plugin\": \"^2.5.3\",\r\n    \"npm-run-all\": \"^4.1.5\",\r\n    \"replace-in-file-webpack-plugin\": \"^1.0.6\",\r\n    \"sass\": \"^1.43.5\",\r\n    \"sass-loader\": \"^12.4.0\",\r\n    \"webpack\": \"^5.76.0\",\r\n    \"webpack-cli\": \"^4.9.2\",\r\n    \"webpack-remove-empty-scripts\": \"^0.7.2\"\r\n  }\r\n}\r\n","import { Class } from \"type-fest\";\r\n\r\nimport { JsPsychExtension, JsPsychExtensionInfo } from \"./modules/extensions\";\r\nimport { TrialExtensionsConfiguration } from \"./timeline\";\r\n\r\nexport type GlobalExtensionsConfiguration = Array<{\r\n  type: Class<JsPsychExtension>;\r\n  params?: Record<string, any>;\r\n}>;\r\n\r\nexport interface ExtensionManagerDependencies {\r\n  /**\r\n   * Given an extension class, create a new instance of it and return it.\r\n   */\r\n  instantiateExtension(extensionClass: Class<JsPsychExtension>): JsPsychExtension;\r\n}\r\n\r\nexport class ExtensionManager {\r\n  private static getExtensionNameByClass(extensionClass: Class<JsPsychExtension>) {\r\n    return (extensionClass[\"info\"] as JsPsychExtensionInfo).name;\r\n  }\r\n\r\n  public readonly extensions: Record<string, JsPsychExtension>;\r\n\r\n  constructor(\r\n    private dependencies: ExtensionManagerDependencies,\r\n    private extensionsConfiguration: GlobalExtensionsConfiguration\r\n  ) {\r\n    this.extensions = Object.fromEntries(\r\n      extensionsConfiguration.map((extension) => [\r\n        ExtensionManager.getExtensionNameByClass(extension.type),\r\n        this.dependencies.instantiateExtension(extension.type),\r\n      ])\r\n    );\r\n  }\r\n\r\n  private getExtensionInstanceByClass(extensionClass: Class<JsPsychExtension>) {\r\n    return this.extensions[ExtensionManager.getExtensionNameByClass(extensionClass)];\r\n  }\r\n\r\n  public async initializeExtensions() {\r\n    await Promise.all(\r\n      this.extensionsConfiguration.map(({ type, params = {} }) => {\r\n        this.getExtensionInstanceByClass(type).initialize(params);\r\n\r\n        const extensionInfo = type[\"info\"] as JsPsychExtensionInfo;\r\n\r\n        if (!(\"version\" in extensionInfo) && !(\"data\" in extensionInfo)) {\r\n          console.warn(\r\n            extensionInfo[\"name\"],\r\n            \"is missing the 'version' and 'data' fields. Please update extension as 'version' and 'data' will be required in v9. See https://www.jspsych.org/latest/developers/extension-development/ for more details.\"\r\n          );\r\n        } else if (!(\"version\" in extensionInfo)) {\r\n          console.warn(\r\n            extensionInfo[\"name\"],\r\n            \"is missing the 'version' field. Please update extension as 'version' will be required in v9. See https://www.jspsych.org/latest/developers/extension-development/ for more details.\"\r\n          );\r\n        } else if (!(\"data\" in extensionInfo)) {\r\n          console.warn(\r\n            extensionInfo[\"name\"],\r\n            \"is missing the 'data' field. Please update extension as 'data' will be required in v9. See https://www.jspsych.org/latest/developers/extension-development/ for more details.\"\r\n          );\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  public onStart(trialExtensionsConfiguration: TrialExtensionsConfiguration = []) {\r\n    for (const { type, params } of trialExtensionsConfiguration) {\r\n      this.getExtensionInstanceByClass(type)?.on_start(params);\r\n    }\r\n  }\r\n\r\n  public onLoad(trialExtensionsConfiguration: TrialExtensionsConfiguration = []) {\r\n    for (const { type, params } of trialExtensionsConfiguration) {\r\n      this.getExtensionInstanceByClass(type)?.on_load(params);\r\n    }\r\n  }\r\n\r\n  public async onFinish(\r\n    trialExtensionsConfiguration: TrialExtensionsConfiguration = []\r\n  ): Promise<Record<string, any>> {\r\n    const results = await Promise.all(\r\n      trialExtensionsConfiguration.map(({ type, params }) =>\r\n        Promise.resolve(this.getExtensionInstanceByClass(type)?.on_finish(params))\r\n      )\r\n    );\r\n\r\n    const extensionInfos = trialExtensionsConfiguration.length\r\n      ? {\r\n          extension_type: trialExtensionsConfiguration.map(({ type }) => type[\"info\"].name),\r\n          extension_version: trialExtensionsConfiguration.map(({ type }) => type[\"info\"].version),\r\n        }\r\n      : {};\r\n\r\n    results.unshift(extensionInfos);\r\n\r\n    return Object.assign({}, ...results);\r\n  }\r\n}\r\n","/**\r\n * Finds all of the unique items in an array.\r\n * @param arr The array to extract unique values from\r\n * @returns An array with one copy of each unique item in `arr`\r\n */\r\nexport function unique(arr: Array<any>) {\r\n  return [...new Set(arr)];\r\n}\r\n\r\nexport function deepCopy(obj) {\r\n  if (!obj) return obj;\r\n  let out;\r\n  if (Array.isArray(obj)) {\r\n    out = [];\r\n    for (const x of obj) {\r\n      out.push(deepCopy(x));\r\n    }\r\n    return out;\r\n  } else if (typeof obj === \"object\" && obj !== null) {\r\n    out = {};\r\n    for (const key in obj) {\r\n      if (obj.hasOwnProperty(key)) {\r\n        out[key] = deepCopy(obj[key]);\r\n      }\r\n    }\r\n    return out;\r\n  } else {\r\n    return obj;\r\n  }\r\n}\r\n\r\n/**\r\n * Merges two objects, recursively.\r\n * @param obj1 Object to merge\r\n * @param obj2 Object to merge\r\n */\r\nexport function deepMerge(obj1: any, obj2: any): any {\r\n  let merged = {};\r\n  for (const key in obj1) {\r\n    if (obj1.hasOwnProperty(key)) {\r\n      if (typeof obj1[key] === \"object\" && obj2.hasOwnProperty(key)) {\r\n        merged[key] = deepMerge(obj1[key], obj2[key]);\r\n      } else {\r\n        merged[key] = obj1[key];\r\n      }\r\n    }\r\n  }\r\n  for (const key in obj2) {\r\n    if (obj2.hasOwnProperty(key)) {\r\n      if (!merged.hasOwnProperty(key)) {\r\n        merged[key] = obj2[key];\r\n      } else if (typeof obj2[key] === \"object\") {\r\n        merged[key] = deepMerge(merged[key], obj2[key]);\r\n      } else {\r\n        merged[key] = obj2[key];\r\n      }\r\n    }\r\n  }\r\n\r\n  return merged;\r\n}\r\n","export class DataColumn {\r\n  constructor(public values = []) {}\r\n\r\n  sum() {\r\n    let s = 0;\r\n    for (const v of this.values) {\r\n      s += v;\r\n    }\r\n    return s;\r\n  }\r\n\r\n  mean() {\r\n    let sum = 0;\r\n    let count = 0;\r\n    for (const value of this.values) {\r\n      if (typeof value !== \"undefined\" && value !== null) {\r\n        sum += value;\r\n        count++;\r\n      }\r\n    }\r\n    if (count === 0) {\r\n      return undefined;\r\n    }\r\n    return sum / count;\r\n  }\r\n\r\n  median() {\r\n    if (this.values.length === 0) {\r\n      return undefined;\r\n    }\r\n    const numbers = this.values.slice(0).sort(function (a, b) {\r\n      return a - b;\r\n    });\r\n    const middle = Math.floor(numbers.length / 2);\r\n    const isEven = numbers.length % 2 === 0;\r\n    return isEven ? (numbers[middle] + numbers[middle - 1]) / 2 : numbers[middle];\r\n  }\r\n\r\n  min() {\r\n    return Math.min.apply(null, this.values);\r\n  }\r\n\r\n  max() {\r\n    return Math.max.apply(null, this.values);\r\n  }\r\n\r\n  count() {\r\n    return this.values.length;\r\n  }\r\n\r\n  variance() {\r\n    const mean = this.mean();\r\n    let sum_square_error = 0;\r\n    for (const x of this.values) {\r\n      sum_square_error += Math.pow(x - mean, 2);\r\n    }\r\n    const mse = sum_square_error / (this.values.length - 1);\r\n    return mse;\r\n  }\r\n\r\n  sd() {\r\n    const mse = this.variance();\r\n    const rmse = Math.sqrt(mse);\r\n    return rmse;\r\n  }\r\n\r\n  frequencies() {\r\n    const unique = {};\r\n    for (const x of this.values) {\r\n      if (typeof unique[x] === \"undefined\") {\r\n        unique[x] = 1;\r\n      } else {\r\n        unique[x]++;\r\n      }\r\n    }\r\n    return unique;\r\n  }\r\n\r\n  all(eval_fn) {\r\n    for (const x of this.values) {\r\n      if (!eval_fn(x)) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  subset(eval_fn) {\r\n    const out = [];\r\n    for (const x of this.values) {\r\n      if (eval_fn(x)) {\r\n        out.push(x);\r\n      }\r\n    }\r\n    return new DataColumn(out);\r\n  }\r\n}\r\n","// private function to save text file on local drive\r\nexport function saveTextToFile(textstr: string, filename: string) {\r\n  const blobToSave = new Blob([textstr], {\r\n    type: \"text/plain\",\r\n  });\r\n  let blobURL = \"\";\r\n  if (typeof window.webkitURL !== \"undefined\") {\r\n    blobURL = window.webkitURL.createObjectURL(blobToSave);\r\n  } else {\r\n    blobURL = window.URL.createObjectURL(blobToSave);\r\n  }\r\n\r\n  const link = document.createElement(\"a\");\r\n  link.id = \"jspsych-download-as-text-link\";\r\n  link.style.display = \"none\";\r\n  link.download = filename;\r\n  link.href = blobURL;\r\n  link.click();\r\n}\r\n\r\n// this function based on code suggested by StackOverflow users:\r\n// http://stackoverflow.com/users/64741/zachary\r\n// http://stackoverflow.com/users/317/joseph-sturtevant\r\n\r\nexport function JSON2CSV(objArray) {\r\n  const array = typeof objArray != \"object\" ? JSON.parse(objArray) : objArray;\r\n  let line = \"\";\r\n  let result = \"\";\r\n  const columns = [];\r\n\r\n  for (const row of array) {\r\n    for (const key in row) {\r\n      let keyString = key + \"\";\r\n      keyString = '\"' + keyString.replace(/\"/g, '\"\"') + '\",';\r\n      if (!columns.includes(key)) {\r\n        columns.push(key);\r\n        line += keyString;\r\n      }\r\n    }\r\n  }\r\n\r\n  line = line.slice(0, -1); // removes last comma\r\n  result += line + \"\\r\\n\";\r\n\r\n  for (const row of array) {\r\n    line = \"\";\r\n    for (const col of columns) {\r\n      let value = typeof row[col] === \"undefined\" ? \"\" : row[col];\r\n      if (typeof value == \"object\") {\r\n        value = JSON.stringify(value);\r\n      }\r\n      const valueString = value + \"\";\r\n      line += '\"' + valueString.replace(/\"/g, '\"\"') + '\",';\r\n    }\r\n\r\n    line = line.slice(0, -1);\r\n    result += line + \"\\r\\n\";\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\n// this function is modified from StackOverflow:\r\n// http://stackoverflow.com/posts/3855394\r\n\r\nexport function getQueryString() {\r\n  const a = window.location.search.substr(1).split(\"&\");\r\n  const b = {};\r\n  for (let i = 0; i < a.length; ++i) {\r\n    const p = a[i].split(\"=\", 2);\r\n    if (p.length == 1) b[p[0]] = \"\";\r\n    else b[p[0]] = decodeURIComponent(p[1].replace(/\\+/g, \" \"));\r\n  }\r\n  return b;\r\n}\r\n","import { deepCopy } from \"../utils\";\r\nimport { DataColumn } from \"./DataColumn\";\r\nimport { JSON2CSV, saveTextToFile } from \"./utils\";\r\n\r\nexport class DataCollection {\r\n  private trials: any[];\r\n\r\n  constructor(data = []) {\r\n    this.trials = data;\r\n  }\r\n\r\n  push(new_data) {\r\n    this.trials.push(new_data);\r\n    return this;\r\n  }\r\n\r\n  join(other_data_collection: DataCollection) {\r\n    this.trials = this.trials.concat(other_data_collection.values());\r\n    return this;\r\n  }\r\n\r\n  top() {\r\n    if (this.trials.length <= 1) {\r\n      return this;\r\n    } else {\r\n      return new DataCollection([this.trials[this.trials.length - 1]]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Queries the first n elements in a collection of trials.\r\n   *\r\n   * @param n A positive integer of elements to return. A value of\r\n   *          n that is less than 1 will throw an error.\r\n   *\r\n   * @return First n objects of a collection of trials. If fewer than\r\n   *         n trials are available, the trials.length elements will\r\n   *         be returned.\r\n   *\r\n   */\r\n  first(n = 1) {\r\n    if (n < 1) {\r\n      throw `You must query with a positive nonzero integer. Please use a\r\n               different value for n.`;\r\n    }\r\n    if (this.trials.length === 0) return new DataCollection();\r\n    if (n > this.trials.length) n = this.trials.length;\r\n    return new DataCollection(this.trials.slice(0, n));\r\n  }\r\n\r\n  /**\r\n   * Queries the last n elements in a collection of trials.\r\n   *\r\n   * @param n A positive integer of elements to return. A value of\r\n   *          n that is less than 1 will throw an error.\r\n   *\r\n   * @return Last n objects of a collection of trials. If fewer than\r\n   *         n trials are available, the trials.length elements will\r\n   *         be returned.\r\n   *\r\n   */\r\n  last(n = 1) {\r\n    if (n < 1) {\r\n      throw `You must query with a positive nonzero integer. Please use a\r\n               different value for n.`;\r\n    }\r\n    if (this.trials.length === 0) return new DataCollection();\r\n    if (n > this.trials.length) n = this.trials.length;\r\n    return new DataCollection(this.trials.slice(this.trials.length - n, this.trials.length));\r\n  }\r\n\r\n  values() {\r\n    return this.trials;\r\n  }\r\n\r\n  count() {\r\n    return this.trials.length;\r\n  }\r\n\r\n  readOnly() {\r\n    return new DataCollection(deepCopy(this.trials));\r\n  }\r\n\r\n  addToAll(properties) {\r\n    for (const trial of this.trials) {\r\n      Object.assign(trial, properties);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  addToLast(properties) {\r\n    if (this.trials.length > 0) {\r\n      Object.assign(this.trials[this.trials.length - 1], properties);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  filter(filters) {\r\n    // [{p1: v1, p2:v2}, {p1:v2}]\r\n    // {p1: v1}\r\n    let f;\r\n    if (!Array.isArray(filters)) {\r\n      f = deepCopy([filters]);\r\n    } else {\r\n      f = deepCopy(filters);\r\n    }\r\n\r\n    const filtered_data = [];\r\n    for (const trial of this.trials) {\r\n      let keep = false;\r\n      for (const filter of f) {\r\n        let match = true;\r\n        for (const key of Object.keys(filter)) {\r\n          if (typeof trial[key] !== \"undefined\" && trial[key] === filter[key]) {\r\n            // matches on this key!\r\n          } else {\r\n            match = false;\r\n          }\r\n        }\r\n        if (match) {\r\n          keep = true;\r\n          break;\r\n        } // can break because each filter is OR.\r\n      }\r\n      if (keep) {\r\n        filtered_data.push(trial);\r\n      }\r\n    }\r\n\r\n    return new DataCollection(filtered_data);\r\n  }\r\n\r\n  filterCustom(fn) {\r\n    return new DataCollection(this.trials.filter(fn));\r\n  }\r\n\r\n  filterColumns(columns: Array<string>) {\r\n    return new DataCollection(\r\n      this.trials.map((trial) =>\r\n        Object.fromEntries(columns.filter((key) => key in trial).map((key) => [key, trial[key]]))\r\n      )\r\n    );\r\n  }\r\n\r\n  select(column) {\r\n    const values = [];\r\n    for (const trial of this.trials) {\r\n      if (typeof trial[column] !== \"undefined\") {\r\n        values.push(trial[column]);\r\n      }\r\n    }\r\n    return new DataColumn(values);\r\n  }\r\n\r\n  ignore(columns) {\r\n    if (!Array.isArray(columns)) {\r\n      columns = [columns];\r\n    }\r\n    const o = deepCopy(this.trials);\r\n    for (const trial of o) {\r\n      for (const delete_key of columns) {\r\n        delete trial[delete_key];\r\n      }\r\n    }\r\n    return new DataCollection(o);\r\n  }\r\n\r\n  uniqueNames() {\r\n    const names = [];\r\n\r\n    for (const trial of this.trials) {\r\n      for (const key of Object.keys(trial)) {\r\n        if (!names.includes(key)) {\r\n          names.push(key);\r\n        }\r\n      }\r\n    }\r\n\r\n    return names;\r\n  }\r\n\r\n  csv() {\r\n    return JSON2CSV(this.trials);\r\n  }\r\n\r\n  json(pretty = false) {\r\n    if (pretty) {\r\n      return JSON.stringify(this.trials, null, \"\\t\");\r\n    }\r\n    return JSON.stringify(this.trials);\r\n  }\r\n\r\n  localSave(format, filename) {\r\n    format = format.toLowerCase();\r\n    let data_string;\r\n    if (format === \"json\") {\r\n      data_string = this.json();\r\n    } else if (format === \"csv\") {\r\n      data_string = this.csv();\r\n    } else {\r\n      throw new Error('Invalid format specified for localSave. Must be \"json\" or \"csv\".');\r\n    }\r\n\r\n    saveTextToFile(data_string, filename);\r\n  }\r\n}\r\n","import { TrialResult } from \"../../timeline\";\r\nimport { Trial } from \"../../timeline/Trial\";\r\nimport { DataCollection } from \"./DataCollection\";\r\nimport { getQueryString } from \"./utils\";\r\n\r\nexport type InteractionEvent = \"blur\" | \"focus\" | \"fullscreenenter\" | \"fullscreenexit\";\r\n\r\nexport interface InteractionRecord {\r\n  event: InteractionEvent;\r\n  trial: number;\r\n  time: number;\r\n}\r\n\r\n/**\r\n * Functions and options needed by the `JsPsychData` module\r\n */\r\nexport interface JsPsychDataDependencies {\r\n  /**\r\n   * Returns progress information for interaction records.\r\n   */\r\n  getProgress: () => { trial: number; time: number };\r\n\r\n  onInteractionRecordAdded: (record: InteractionRecord) => void;\r\n\r\n  getDisplayElement: () => HTMLElement;\r\n}\r\n\r\nexport class JsPsychData {\r\n  private results: DataCollection;\r\n  private resultToTrialMap: WeakMap<TrialResult, Trial>;\r\n\r\n  /** Browser interaction event data */\r\n  private interactionRecords: DataCollection;\r\n\r\n  /** Data properties for all trials */\r\n  private dataProperties = {};\r\n\r\n  // cache the query_string\r\n  private query_string;\r\n\r\n  constructor(private dependencies: JsPsychDataDependencies) {\r\n    this.reset();\r\n  }\r\n\r\n  reset() {\r\n    this.results = new DataCollection();\r\n    this.resultToTrialMap = new WeakMap<TrialResult, Trial>();\r\n    this.interactionRecords = new DataCollection();\r\n  }\r\n\r\n  get() {\r\n    return this.results;\r\n  }\r\n\r\n  getInteractionData() {\r\n    return this.interactionRecords;\r\n  }\r\n\r\n  write(trial: Trial) {\r\n    const result = trial.getResult();\r\n    Object.assign(result, this.dataProperties);\r\n    this.results.push(result);\r\n    this.resultToTrialMap.set(result, trial);\r\n  }\r\n\r\n  addProperties(properties) {\r\n    // first, add the properties to all data that's already stored\r\n    this.results.addToAll(properties);\r\n\r\n    // now add to list so that it gets appended to all future data\r\n    this.dataProperties = Object.assign({}, this.dataProperties, properties);\r\n  }\r\n\r\n  addDataToLastTrial(data) {\r\n    this.results.addToLast(data);\r\n  }\r\n\r\n  getLastTrialData() {\r\n    return this.results.top();\r\n  }\r\n\r\n  getLastTimelineData() {\r\n    const lastResult = this.getLastTrialData().values()[0];\r\n\r\n    return new DataCollection(\r\n      lastResult ? this.resultToTrialMap.get(lastResult).parent.getResults() : []\r\n    );\r\n  }\r\n\r\n  displayData(format = \"json\") {\r\n    format = format.toLowerCase();\r\n    if (format !== \"json\" && format !== \"csv\") {\r\n      console.log(\"Invalid format declared for displayData function. Using json as default.\");\r\n      format = \"json\";\r\n    }\r\n\r\n    const dataContainer = document.createElement(\"pre\");\r\n    dataContainer.id = \"jspsych-data-display\";\r\n    dataContainer.textContent = format === \"json\" ? this.results.json(true) : this.results.csv();\r\n\r\n    this.dependencies.getDisplayElement().replaceChildren(dataContainer);\r\n  }\r\n\r\n  urlVariables() {\r\n    if (typeof this.query_string == \"undefined\") {\r\n      this.query_string = getQueryString();\r\n    }\r\n    return this.query_string;\r\n  }\r\n\r\n  getURLVariable(whichvar) {\r\n    return this.urlVariables()[whichvar];\r\n  }\r\n\r\n  private addInteractionRecord(event: InteractionEvent) {\r\n    const record: InteractionRecord = { event, ...this.dependencies.getProgress() };\r\n    this.interactionRecords.push(record);\r\n    this.dependencies.onInteractionRecordAdded(record);\r\n  }\r\n\r\n  private interactionListeners = {\r\n    blur: () => {\r\n      this.addInteractionRecord(\"blur\");\r\n    },\r\n    focus: () => {\r\n      this.addInteractionRecord(\"focus\");\r\n    },\r\n    fullscreenchange: () => {\r\n      this.addInteractionRecord(\r\n        // @ts-expect-error\r\n        document.isFullScreen ||\r\n          // @ts-expect-error\r\n          document.webkitIsFullScreen ||\r\n          // @ts-expect-error\r\n          document.mozIsFullScreen ||\r\n          document.fullscreenElement\r\n          ? \"fullscreenenter\"\r\n          : \"fullscreenexit\"\r\n      );\r\n    },\r\n  };\r\n\r\n  createInteractionListeners() {\r\n    window.addEventListener(\"blur\", this.interactionListeners.blur);\r\n    window.addEventListener(\"focus\", this.interactionListeners.focus);\r\n\r\n    document.addEventListener(\"fullscreenchange\", this.interactionListeners.fullscreenchange);\r\n    document.addEventListener(\"mozfullscreenchange\", this.interactionListeners.fullscreenchange);\r\n    document.addEventListener(\"webkitfullscreenchange\", this.interactionListeners.fullscreenchange);\r\n  }\r\n\r\n  removeInteractionListeners() {\r\n    window.removeEventListener(\"blur\", this.interactionListeners.blur);\r\n    window.removeEventListener(\"focus\", this.interactionListeners.focus);\r\n\r\n    document.removeEventListener(\"fullscreenchange\", this.interactionListeners.fullscreenchange);\r\n    document.removeEventListener(\"mozfullscreenchange\", this.interactionListeners.fullscreenchange);\r\n    document.removeEventListener(\r\n      \"webkitfullscreenchange\",\r\n      this.interactionListeners.fullscreenchange\r\n    );\r\n  }\r\n}\r\n","import autoBind from \"auto-bind\";\r\n\r\nexport type KeyboardListener = (e: KeyboardEvent) => void;\r\n\r\nexport type ValidResponses = string[] | \"ALL_KEYS\" | \"NO_KEYS\";\r\n\r\nexport interface GetKeyboardResponseOptions {\r\n  callback_function: any;\r\n  valid_responses?: ValidResponses;\r\n  rt_method?: \"performance\" | \"audio\";\r\n  persist?: boolean;\r\n  audio_context?: AudioContext;\r\n  audio_context_start_time?: number;\r\n  allow_held_key?: boolean;\r\n  minimum_valid_rt?: number;\r\n}\r\n\r\nexport class KeyboardListenerAPI {\r\n  constructor(\r\n    private getRootElement: () => Element | undefined,\r\n    private areResponsesCaseSensitive: boolean = false,\r\n    private minimumValidRt = 0\r\n  ) {\r\n    autoBind(this);\r\n    this.registerRootListeners();\r\n  }\r\n\r\n  private listeners = new Set<KeyboardListener>();\r\n  private heldKeys = new Set<string>();\r\n\r\n  private areRootListenersRegistered = false;\r\n\r\n  /**\r\n   * If not previously done and `this.getRootElement()` returns an element, adds the root key\r\n   * listeners to that element.\r\n   */\r\n  private registerRootListeners() {\r\n    if (!this.areRootListenersRegistered) {\r\n      const rootElement = this.getRootElement();\r\n      if (rootElement) {\r\n        rootElement.addEventListener(\"keydown\", this.rootKeydownListener);\r\n        rootElement.addEventListener(\"keyup\", this.rootKeyupListener);\r\n        this.areRootListenersRegistered = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  private rootKeydownListener(e: KeyboardEvent) {\r\n    // Iterate over a static copy of the listeners set because listeners might add other listeners\r\n    // that we do not want to be included in the loop\r\n    for (const listener of [...this.listeners]) {\r\n      listener(e);\r\n    }\r\n    this.heldKeys.add(this.toLowerCaseIfInsensitive(e.key));\r\n  }\r\n\r\n  private toLowerCaseIfInsensitive(string: string) {\r\n    return this.areResponsesCaseSensitive ? string : string.toLowerCase();\r\n  }\r\n\r\n  private rootKeyupListener(e: KeyboardEvent) {\r\n    this.heldKeys.delete(this.toLowerCaseIfInsensitive(e.key));\r\n  }\r\n\r\n  private isResponseValid(validResponses: ValidResponses, allowHeldKey: boolean, key: string) {\r\n    // check if key was already held down\r\n    if (!allowHeldKey && this.heldKeys.has(key)) {\r\n      return false;\r\n    }\r\n\r\n    if (validResponses === \"ALL_KEYS\") {\r\n      return true;\r\n    }\r\n    if (validResponses === \"NO_KEYS\") {\r\n      return false;\r\n    }\r\n\r\n    return validResponses.includes(key);\r\n  }\r\n\r\n  getKeyboardResponse({\r\n    callback_function,\r\n    valid_responses = \"ALL_KEYS\",\r\n    rt_method = \"performance\",\r\n    persist,\r\n    audio_context,\r\n    audio_context_start_time,\r\n    allow_held_key = false,\r\n    minimum_valid_rt = this.minimumValidRt,\r\n  }: GetKeyboardResponseOptions) {\r\n    if (rt_method !== \"performance\" && rt_method !== \"audio\") {\r\n      console.log(\r\n        'Invalid RT method specified in getKeyboardResponse. Defaulting to \"performance\" method.'\r\n      );\r\n      rt_method = \"performance\";\r\n    }\r\n\r\n    const usePerformanceRt = rt_method === \"performance\";\r\n    const startTime = usePerformanceRt ? performance.now() : audio_context_start_time * 1000;\r\n\r\n    this.registerRootListeners();\r\n\r\n    if (!this.areResponsesCaseSensitive && typeof valid_responses !== \"string\") {\r\n      valid_responses = valid_responses.map((r) => r.toLowerCase());\r\n    }\r\n\r\n    const listener: KeyboardListener = (e) => {\r\n      const rt = Math.round(\r\n        (rt_method == \"performance\" ? performance.now() : audio_context.currentTime * 1000) -\r\n          startTime\r\n      );\r\n      if (rt < minimum_valid_rt) {\r\n        return;\r\n      }\r\n\r\n      const key = this.toLowerCaseIfInsensitive(e.key);\r\n\r\n      if (this.isResponseValid(valid_responses, allow_held_key, key)) {\r\n        // if this is a valid response, then we don't want the key event to trigger other actions\r\n        // like scrolling via the spacebar.\r\n        e.preventDefault();\r\n\r\n        if (!persist) {\r\n          // remove keyboard listener if it exists\r\n          this.cancelKeyboardResponse(listener);\r\n        }\r\n\r\n        callback_function({ key: e.key, rt });\r\n      }\r\n    };\r\n\r\n    this.listeners.add(listener);\r\n    return listener;\r\n  }\r\n\r\n  cancelKeyboardResponse(listener: KeyboardListener) {\r\n    // remove the listener from the set of listeners if it is contained\r\n    this.listeners.delete(listener);\r\n  }\r\n\r\n  cancelAllKeyboardResponses() {\r\n    this.listeners.clear();\r\n  }\r\n\r\n  compareKeys(key1: string | null, key2: string | null) {\r\n    if (\r\n      (typeof key1 !== \"string\" && key1 !== null) ||\r\n      (typeof key2 !== \"string\" && key2 !== null)\r\n    ) {\r\n      console.error(\r\n        \"Error in jsPsych.pluginAPI.compareKeys: arguments must be key strings or null.\"\r\n      );\r\n      return undefined;\r\n    }\r\n\r\n    if (typeof key1 === \"string\" && typeof key2 === \"string\") {\r\n      // if both values are strings, then check whether or not letter case should be converted before comparing (case_sensitive_responses in initJsPsych)\r\n      return this.areResponsesCaseSensitive\r\n        ? key1 === key2\r\n        : key1.toLowerCase() === key2.toLowerCase();\r\n    }\r\n\r\n    return key1 === null && key2 === null;\r\n  }\r\n}\r\n","import { SetRequired } from \"type-fest\";\r\n\r\nimport { SimulationMode, SimulationOptions, TrialDescription, TrialResult } from \"../timeline\";\r\n\r\n/**\r\n * Parameter types for plugins\r\n */\r\nexport enum ParameterType {\r\n  BOOL,\r\n  STRING,\r\n  INT,\r\n  FLOAT,\r\n  FUNCTION,\r\n  KEY,\r\n  KEYS,\r\n  SELECT,\r\n  HTML_STRING,\r\n  IMAGE,\r\n  AUDIO,\r\n  VIDEO,\r\n  OBJECT,\r\n  COMPLEX,\r\n  TIMELINE,\r\n}\r\n\r\ntype ParameterTypeMap = {\r\n  [ParameterType.BOOL]: boolean;\r\n  [ParameterType.STRING]: string;\r\n  [ParameterType.INT]: number;\r\n  [ParameterType.FLOAT]: number;\r\n  [ParameterType.FUNCTION]: (...args: any[]) => any;\r\n  [ParameterType.KEY]: string;\r\n  [ParameterType.KEYS]: string[] | \"ALL_KEYS\" | \"NO_KEYS\";\r\n  [ParameterType.SELECT]: any;\r\n  [ParameterType.HTML_STRING]: string;\r\n  [ParameterType.IMAGE]: string;\r\n  [ParameterType.AUDIO]: string;\r\n  [ParameterType.VIDEO]: string;\r\n  [ParameterType.OBJECT]: object;\r\n  [ParameterType.COMPLEX]: any;\r\n  [ParameterType.TIMELINE]: any;\r\n};\r\n\r\ntype PreloadParameterType = ParameterType.AUDIO | ParameterType.VIDEO | ParameterType.IMAGE;\r\n\r\nexport type ParameterInfo = (\r\n  | { type: Exclude<ParameterType, ParameterType.COMPLEX | PreloadParameterType> }\r\n  | { type: ParameterType.COMPLEX; nested?: ParameterInfos }\r\n  | { type: PreloadParameterType; preload?: boolean }\r\n) & {\r\n  array?: boolean;\r\n  pretty_name?: string;\r\n  default?: any;\r\n};\r\n\r\nexport type ParameterInfos = Record<string, ParameterInfo>;\r\n\r\ntype InferredParameter<I extends ParameterInfo> = I[\"array\"] extends true\r\n  ? Array<ParameterTypeMap[I[\"type\"]]>\r\n  : ParameterTypeMap[I[\"type\"]];\r\n\r\ntype RequiredParameterNames<I extends ParameterInfos> = {\r\n  [K in keyof I]: I[K][\"default\"] extends undefined ? K : never;\r\n}[keyof I];\r\n\r\ntype InferredParameters<I extends ParameterInfos> = SetRequired<\r\n  {\r\n    [Property in keyof I]?: InferredParameter<I[Property]>;\r\n  },\r\n  RequiredParameterNames<I>\r\n>;\r\n\r\nexport const universalPluginParameters = <const>{\r\n  /**\r\n   * Data to add to this trial (key-value pairs)\r\n   */\r\n  data: {\r\n    type: ParameterType.OBJECT,\r\n    pretty_name: \"Data\",\r\n    default: {},\r\n  },\r\n  /**\r\n   * Function to execute when trial begins\r\n   */\r\n  on_start: {\r\n    type: ParameterType.FUNCTION,\r\n    pretty_name: \"On start\",\r\n    default: function () {\r\n      return;\r\n    },\r\n  },\r\n  /**\r\n   * Function to execute when trial is finished\r\n   */\r\n  on_finish: {\r\n    type: ParameterType.FUNCTION,\r\n    pretty_name: \"On finish\",\r\n    default: function () {\r\n      return;\r\n    },\r\n  },\r\n  /**\r\n   * Function to execute after the trial has loaded\r\n   */\r\n  on_load: {\r\n    type: ParameterType.FUNCTION,\r\n    pretty_name: \"On load\",\r\n    default: function () {\r\n      return;\r\n    },\r\n  },\r\n  /**\r\n   * Length of gap between the end of this trial and the start of the next trial\r\n   */\r\n  post_trial_gap: {\r\n    type: ParameterType.INT,\r\n    pretty_name: \"Post trial gap\",\r\n    default: 0,\r\n  },\r\n  /**\r\n   * A list of CSS classes to add to the jsPsych display element for the duration of this trial\r\n   */\r\n  css_classes: {\r\n    type: ParameterType.STRING,\r\n    pretty_name: \"Custom CSS classes\",\r\n    default: \"\",\r\n  },\r\n  /**\r\n   * Options to control simulation mode for the trial.\r\n   */\r\n  simulation_options: {\r\n    type: ParameterType.COMPLEX,\r\n    default: {},\r\n  },\r\n};\r\n\r\nexport type UniversalPluginParameters = InferredParameters<typeof universalPluginParameters>;\r\n\r\nexport interface PluginInfo {\r\n  name: string;\r\n  version?: string;\r\n  parameters: ParameterInfos;\r\n  data?: ParameterInfos;\r\n  citations?: Record<string, string> | string;\r\n}\r\n\r\nexport interface JsPsychPlugin<I extends PluginInfo> {\r\n  trial(\r\n    display_element: HTMLElement,\r\n    trial: TrialType<I>,\r\n    on_load?: () => void\r\n  ): void | Promise<TrialResult | void>;\r\n\r\n  simulate?(\r\n    trial: TrialType<I>,\r\n    simulation_mode: SimulationMode,\r\n    simulation_options: SimulationOptions,\r\n    on_load?: () => void\r\n  ): void | Promise<TrialResult | void>;\r\n}\r\n\r\nexport type TrialType<I extends PluginInfo> = InferredParameters<I[\"parameters\"]> &\r\n  TrialDescription;\r\n\r\nexport type PluginParameters<I extends PluginInfo> = InferredParameters<I[\"parameters\"]>;\r\n","export interface AudioPlayerOptions {\r\n  useWebAudio: boolean;\r\n  audioContext?: AudioContext;\r\n}\r\n\r\nexport interface AudioPlayerInterface {\r\n  load(): Promise<void>;\r\n  play(): void;\r\n  stop(): void;\r\n  addEventListener(eventName: string, callback: EventListenerOrEventListenerObject): void;\r\n  removeEventListener(eventName: string, callback: EventListenerOrEventListenerObject): void;\r\n}\r\n\r\nexport class AudioPlayer implements AudioPlayerInterface {\r\n  private audio: HTMLAudioElement | AudioBufferSourceNode;\r\n  private webAudioBuffer: AudioBuffer;\r\n  private audioContext: AudioContext | null;\r\n  private useWebAudio: boolean;\r\n  private src: string;\r\n\r\n  constructor(src: string, options: AudioPlayerOptions = { useWebAudio: false }) {\r\n    this.src = src;\r\n    this.useWebAudio = options.useWebAudio;\r\n    this.audioContext = options.audioContext || null;\r\n  }\r\n\r\n  async load() {\r\n    if (this.useWebAudio) {\r\n      this.webAudioBuffer = await this.preloadWebAudio(this.src);\r\n    } else {\r\n      this.audio = await this.preloadHTMLAudio(this.src);\r\n    }\r\n  }\r\n\r\n  play() {\r\n    if (this.audio instanceof HTMLAudioElement) {\r\n      this.audio.play();\r\n    } else {\r\n      // If audio is not HTMLAudioElement, it must be a WebAudio API object, so create a source node.\r\n      if (!this.audio) this.audio = this.getAudioSourceNode(this.webAudioBuffer);\r\n      this.audio.start();\r\n    }\r\n  }\r\n\r\n  stop() {\r\n    if (this.audio instanceof HTMLAudioElement) {\r\n      this.audio.pause();\r\n      this.audio.currentTime = 0;\r\n    } else {\r\n      this.audio!.stop();\r\n      // Regenerate source node for audio since the previous one is stopped and unusable.\r\n      this.audio = this.getAudioSourceNode(this.webAudioBuffer);\r\n    }\r\n  }\r\n\r\n  addEventListener(eventName: string, callback: EventListenerOrEventListenerObject) {\r\n    // If WebAudio buffer exists but source node doesn't, create it.\r\n    if (!this.audio && this.webAudioBuffer)\r\n      this.audio = this.getAudioSourceNode(this.webAudioBuffer);\r\n    this.audio.addEventListener(eventName, callback);\r\n  }\r\n\r\n  removeEventListener(eventName: string, callback: EventListenerOrEventListenerObject) {\r\n    // If WebAudio buffer exists but source node doesn't, create it.\r\n    if (!this.audio && this.webAudioBuffer)\r\n      this.audio = this.getAudioSourceNode(this.webAudioBuffer);\r\n    this.audio.removeEventListener(eventName, callback);\r\n  }\r\n\r\n  private getAudioSourceNode(audioBuffer: AudioBuffer): AudioBufferSourceNode {\r\n    const source = this.audioContext!.createBufferSource();\r\n    source.buffer = audioBuffer;\r\n    source.connect(this.audioContext!.destination);\r\n    return source;\r\n  }\r\n\r\n  private async preloadWebAudio(src: string): Promise<AudioBuffer> {\r\n    const buffer = await fetch(src);\r\n    const arrayBuffer = await buffer.arrayBuffer();\r\n    const audioBuffer = await this.audioContext!.decodeAudioData(arrayBuffer);\r\n    const source = this.audioContext!.createBufferSource();\r\n    source.buffer = audioBuffer;\r\n    source.connect(this.audioContext!.destination);\r\n    return audioBuffer;\r\n  }\r\n\r\n  private async preloadHTMLAudio(src: string): Promise<HTMLAudioElement> {\r\n    return new Promise<HTMLAudioElement>((resolve, reject) => {\r\n      const audio = new Audio(src);\r\n      audio.addEventListener(\"canplaythrough\", () => {\r\n        resolve(audio);\r\n      });\r\n      audio.addEventListener(\"error\", (err) => {\r\n        reject(err);\r\n      });\r\n      audio.addEventListener(\"abort\", (err) => {\r\n        reject(err);\r\n      });\r\n    });\r\n  }\r\n}\r\n","import { ParameterType } from \"../../modules/plugins\";\r\nimport { unique } from \"../utils\";\r\nimport { AudioPlayer } from \"./AudioPlayer\";\r\n\r\nconst preloadParameterTypes = <const>[\r\n  ParameterType.AUDIO,\r\n  ParameterType.IMAGE,\r\n  ParameterType.VIDEO,\r\n];\r\ntype PreloadType = typeof preloadParameterTypes[number];\r\n\r\nexport class MediaAPI {\r\n  constructor(public useWebaudio: boolean) {\r\n    if (\r\n      this.useWebaudio &&\r\n      typeof window !== \"undefined\" &&\r\n      typeof window.AudioContext !== \"undefined\"\r\n    ) {\r\n      this.context = new AudioContext();\r\n    }\r\n  }\r\n\r\n  // video //\r\n  private video_buffers = {};\r\n  getVideoBuffer(videoID: string) {\r\n    if (videoID.startsWith(\"blob:\")) {\r\n      this.video_buffers[videoID] = videoID;\r\n    }\r\n    return this.video_buffers[videoID];\r\n  }\r\n\r\n  // audio //\r\n  private context: AudioContext = null;\r\n  private audio_buffers = [];\r\n\r\n  audioContext(): AudioContext {\r\n    if (this.context && this.context.state !== \"running\") {\r\n      this.context.resume();\r\n    }\r\n    return this.context;\r\n  }\r\n\r\n  async getAudioPlayer(audioID: string): Promise<AudioPlayer> {\r\n    if (this.audio_buffers[audioID] instanceof AudioPlayer) {\r\n      return this.audio_buffers[audioID];\r\n    } else {\r\n      this.audio_buffers[audioID] = new AudioPlayer(audioID, {\r\n        useWebAudio: this.useWebaudio,\r\n        audioContext: this.context,\r\n      });\r\n      await this.audio_buffers[audioID].load();\r\n      return this.audio_buffers[audioID];\r\n    }\r\n  }\r\n\r\n  // preloading stimuli //\r\n  private preload_requests = [];\r\n\r\n  private img_cache = {};\r\n\r\n  preloadAudio(\r\n    files,\r\n    callback_complete = () => {},\r\n    callback_load = (filepath: string) => {},\r\n    callback_error = (error) => {}\r\n  ) {\r\n    files = unique(files.flat());\r\n\r\n    let n_loaded = 0;\r\n\r\n    if (files.length == 0) {\r\n      callback_complete();\r\n      return;\r\n    }\r\n\r\n    for (const file of files) {\r\n      // check if file was already loaded\r\n      if (this.audio_buffers[file] instanceof AudioPlayer) {\r\n        n_loaded++;\r\n        callback_load(file);\r\n        if (n_loaded == files.length) {\r\n          callback_complete();\r\n        }\r\n      } else {\r\n        this.audio_buffers[file] = new AudioPlayer(file, {\r\n          useWebAudio: this.useWebaudio,\r\n          audioContext: this.context,\r\n        });\r\n        this.audio_buffers[file]\r\n          .load()\r\n          .then(() => {\r\n            n_loaded++;\r\n            callback_load(file);\r\n            if (n_loaded == files.length) {\r\n              callback_complete();\r\n            }\r\n          })\r\n          .catch((e) => {\r\n            callback_error(e);\r\n          });\r\n      }\r\n    }\r\n  }\r\n\r\n  preloadImages(\r\n    images,\r\n    callback_complete = () => {},\r\n    callback_load = (filepath) => {},\r\n    callback_error = (error_msg) => {}\r\n  ) {\r\n    // flatten the images array\r\n    images = unique(images.flat());\r\n\r\n    var n_loaded = 0;\r\n\r\n    if (images.length === 0) {\r\n      callback_complete();\r\n      return;\r\n    }\r\n\r\n    for (let i = 0; i < images.length; i++) {\r\n      const img = new Image();\r\n      const src = images[i];\r\n      img.onload = () => {\r\n        n_loaded++;\r\n        callback_load(src);\r\n        if (n_loaded === images.length) {\r\n          callback_complete();\r\n        }\r\n      };\r\n\r\n      img.onerror = (e) => {\r\n        callback_error({ source: src, error: e });\r\n      };\r\n\r\n      img.src = src;\r\n\r\n      this.img_cache[src] = img;\r\n      this.preload_requests.push(img);\r\n    }\r\n  }\r\n\r\n  preloadVideo(\r\n    videos,\r\n    callback_complete = () => {},\r\n    callback_load = (filepath) => {},\r\n    callback_error = (error_msg) => {}\r\n  ) {\r\n    // flatten the video array\r\n    videos = unique(videos.flat());\r\n\r\n    let n_loaded = 0;\r\n\r\n    if (videos.length === 0) {\r\n      callback_complete();\r\n      return;\r\n    }\r\n\r\n    for (const video of videos) {\r\n      const video_buffers = this.video_buffers;\r\n\r\n      //based on option 4 here: http://dinbror.dk/blog/how-to-preload-entire-html5-video-before-play-solved/\r\n      const request = new XMLHttpRequest();\r\n      request.open(\"GET\", video, true);\r\n      request.responseType = \"blob\";\r\n      request.onload = () => {\r\n        if (request.status === 200 || request.status === 0) {\r\n          const videoBlob = request.response;\r\n          video_buffers[video] = URL.createObjectURL(videoBlob); // IE10+\r\n          n_loaded++;\r\n          callback_load(video);\r\n          if (n_loaded === videos.length) {\r\n            callback_complete();\r\n          }\r\n        }\r\n      };\r\n      request.onerror = (e) => {\r\n        let err: ProgressEvent | string = e;\r\n        if (request.status == 404) {\r\n          err = \"404\";\r\n        }\r\n        callback_error({ source: video, error: err });\r\n      };\r\n      request.onloadend = (e) => {\r\n        if (request.status == 404) {\r\n          callback_error({ source: video, error: \"404\" });\r\n        }\r\n      };\r\n      request.send();\r\n      this.preload_requests.push(request);\r\n    }\r\n  }\r\n\r\n  private preloadMap = new Map<string, Record<string, PreloadType>>();\r\n\r\n  getAutoPreloadList(timeline_description: any[]) {\r\n    /** Map each preload parameter type to a set of paths to be preloaded */\r\n    const preloadPaths = Object.fromEntries(\r\n      preloadParameterTypes.map((type) => [type, new Set<string>()])\r\n    );\r\n\r\n    const traverseTimeline = (node, inheritedTrialType?) => {\r\n      const isTimeline = typeof node.timeline !== \"undefined\";\r\n\r\n      if (isTimeline) {\r\n        for (const childNode of node.timeline) {\r\n          traverseTimeline(childNode, node.type ?? inheritedTrialType);\r\n        }\r\n      } else if ((node.type ?? inheritedTrialType)?.info) {\r\n        // node is a trial with type.info set\r\n\r\n        // Get the plugin name and parameters object from the info object\r\n        const { name: pluginName, parameters } = (node.type ?? inheritedTrialType).info;\r\n\r\n        // Extract parameters to be preloaded and their types from parameter info if this has not\r\n        // yet been done for `pluginName`\r\n        if (!this.preloadMap.has(pluginName)) {\r\n          this.preloadMap.set(\r\n            pluginName,\r\n            Object.fromEntries(\r\n              Object.entries<any>(parameters)\r\n                // Filter out parameter entries with media types and a non-false `preload` option\r\n                .filter(\r\n                  ([_name, { type, preload }]) =>\r\n                    preloadParameterTypes.includes(type) && (preload ?? true)\r\n                )\r\n                // Map each entry's value to its parameter type\r\n                .map(([name, { type }]) => [name, type])\r\n            )\r\n          );\r\n        }\r\n\r\n        // Add preload paths from this trial\r\n        for (const [parameterName, parameterType] of Object.entries(\r\n          this.preloadMap.get(pluginName)\r\n        )) {\r\n          const parameterValue = node[parameterName];\r\n          const elements = preloadPaths[parameterType];\r\n\r\n          if (typeof parameterValue === \"string\") {\r\n            elements.add(parameterValue);\r\n          } else if (Array.isArray(parameterValue)) {\r\n            for (const element of parameterValue.flat()) {\r\n              if (typeof element === \"string\") {\r\n                elements.add(element);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    traverseTimeline({ timeline: timeline_description });\r\n\r\n    return {\r\n      images: [...preloadPaths[ParameterType.IMAGE]],\r\n      audio: [...preloadPaths[ParameterType.AUDIO]],\r\n      video: [...preloadPaths[ParameterType.VIDEO]],\r\n    };\r\n  }\r\n\r\n  cancelPreloads() {\r\n    for (const request of this.preload_requests) {\r\n      request.onload = () => {};\r\n      request.onerror = () => {};\r\n      request.oncanplaythrough = () => {};\r\n      request.onabort = () => {};\r\n    }\r\n    this.preload_requests = [];\r\n  }\r\n\r\n  private microphone_recorder: MediaRecorder = null;\r\n\r\n  initializeMicrophoneRecorder(stream: MediaStream) {\r\n    const recorder = new MediaRecorder(stream);\r\n    this.microphone_recorder = recorder;\r\n  }\r\n\r\n  getMicrophoneRecorder(): MediaRecorder {\r\n    return this.microphone_recorder;\r\n  }\r\n\r\n  private camera_stream: MediaStream = null;\r\n  private camera_recorder: MediaRecorder = null;\r\n\r\n  initializeCameraRecorder(stream: MediaStream, opts?: MediaRecorderOptions) {\r\n    let mimeType = this.getCompatibleMimeType() || \"video/webm\";\r\n    const recorderOptions: MediaRecorderOptions = {\r\n      ...opts,\r\n      mimeType\r\n    }\r\n\r\n    this.camera_stream = stream;\r\n    const recorder = new MediaRecorder(stream, recorderOptions);\r\n    this.camera_recorder = recorder;\r\n  }\r\n\r\n  // mimetype checking code adapted from https://github.com/lookit/lookit-jspsych/blob/develop/packages/record/src/videoConfig.ts#L673-L699\r\n  /** returns a compatible mimetype string, or null if none from the array are supported. */\r\n  private getCompatibleMimeType(): string {\r\n    const types = [\r\n      // chrome firefox edge\r\n      \"video/webm;codecs=vp9,opus\",\r\n      \"video/webm;codecs=vp8,opus\",\r\n      // general\r\n      \"video/mp4;codecs=avc1.42E01E,mp4a.40.2\",\r\n      // safari\r\n      \"video/mp4;codecs=h264,aac\",\r\n      \"video/mp4;codecs=hevc,aac\",\r\n    ]\r\n    for (const mimeType of types) {\r\n      if (MediaRecorder.isTypeSupported(mimeType)) {\r\n        return mimeType;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  getCameraStream(): MediaStream {\r\n    return this.camera_stream;\r\n  }\r\n\r\n  getCameraRecorder(): MediaRecorder {\r\n    return this.camera_recorder;\r\n  }\r\n}\r\n","export class SimulationAPI {\r\n  constructor(\r\n    private getDisplayContainerElement: () => HTMLElement,\r\n    private setJsPsychTimeout: (callback: () => void, delay: number) => number\r\n  ) {}\r\n\r\n  dispatchEvent(event: Event) {\r\n    this.getDisplayContainerElement().dispatchEvent(event);\r\n  }\r\n\r\n  /**\r\n   * Dispatches a `keydown` event for the specified key\r\n   * @param key Character code (`.key` property) for the key to press.\r\n   */\r\n  keyDown(key: string) {\r\n    this.dispatchEvent(new KeyboardEvent(\"keydown\", { key }));\r\n  }\r\n\r\n  /**\r\n   * Dispatches a `keyup` event for the specified key\r\n   * @param key Character code (`.key` property) for the key to press.\r\n   */\r\n  keyUp(key: string) {\r\n    this.dispatchEvent(new KeyboardEvent(\"keyup\", { key }));\r\n  }\r\n\r\n  /**\r\n   * Dispatches a `keydown` and `keyup` event in sequence to simulate pressing a key.\r\n   * @param key Character code (`.key` property) for the key to press.\r\n   * @param delay Length of time to wait (ms) before executing action\r\n   */\r\n  pressKey(key: string, delay = 0) {\r\n    if (delay > 0) {\r\n      this.setJsPsychTimeout(() => {\r\n        this.keyDown(key);\r\n        this.keyUp(key);\r\n      }, delay);\r\n    } else {\r\n      this.keyDown(key);\r\n      this.keyUp(key);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Dispatches `mousedown`, `mouseup`, and `click` events on the target element\r\n   * @param target The element to click\r\n   * @param delay Length of time to wait (ms) before executing action\r\n   */\r\n  clickTarget(target: Element, delay = 0) {\r\n    if (delay > 0) {\r\n      this.setJsPsychTimeout(() => {\r\n        target.dispatchEvent(new MouseEvent(\"mousedown\", { bubbles: true }));\r\n        target.dispatchEvent(new MouseEvent(\"mouseup\", { bubbles: true }));\r\n        target.dispatchEvent(new MouseEvent(\"click\", { bubbles: true }));\r\n      }, delay);\r\n    } else {\r\n      target.dispatchEvent(new MouseEvent(\"mousedown\", { bubbles: true }));\r\n      target.dispatchEvent(new MouseEvent(\"mouseup\", { bubbles: true }));\r\n      target.dispatchEvent(new MouseEvent(\"click\", { bubbles: true }));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the value of a target text input\r\n   * @param target A text input element to fill in\r\n   * @param text Text to input\r\n   * @param delay Length of time to wait (ms) before executing action\r\n   */\r\n  fillTextInput(target: HTMLInputElement, text: string, delay = 0) {\r\n    if (delay > 0) {\r\n      this.setJsPsychTimeout(() => {\r\n        target.value = text;\r\n      }, delay);\r\n    } else {\r\n      target.value = text;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Picks a valid key from `choices`, taking into account jsPsych-specific\r\n   * identifiers like \"NO_KEYS\" and \"ALL_KEYS\".\r\n   * @param choices Which keys are valid.\r\n   * @returns A key selected at random from the valid keys.\r\n   */\r\n  getValidKey(choices: \"NO_KEYS\" | \"ALL_KEYS\" | Array<string> | Array<Array<string>>) {\r\n    const possible_keys = [\r\n      \"a\",\r\n      \"b\",\r\n      \"c\",\r\n      \"d\",\r\n      \"e\",\r\n      \"f\",\r\n      \"g\",\r\n      \"h\",\r\n      \"i\",\r\n      \"j\",\r\n      \"k\",\r\n      \"l\",\r\n      \"m\",\r\n      \"n\",\r\n      \"o\",\r\n      \"p\",\r\n      \"q\",\r\n      \"r\",\r\n      \"s\",\r\n      \"t\",\r\n      \"u\",\r\n      \"v\",\r\n      \"w\",\r\n      \"x\",\r\n      \"y\",\r\n      \"z\",\r\n      \"0\",\r\n      \"1\",\r\n      \"2\",\r\n      \"3\",\r\n      \"4\",\r\n      \"5\",\r\n      \"6\",\r\n      \"7\",\r\n      \"8\",\r\n      \"9\",\r\n      \" \",\r\n    ];\r\n\r\n    let key;\r\n    if (choices == \"NO_KEYS\") {\r\n      key = null;\r\n    } else if (choices == \"ALL_KEYS\") {\r\n      key = possible_keys[Math.floor(Math.random() * possible_keys.length)];\r\n    } else {\r\n      const flat_choices = choices.flat();\r\n      key = flat_choices[Math.floor(Math.random() * flat_choices.length)];\r\n    }\r\n\r\n    return key;\r\n  }\r\n\r\n  mergeSimulationData(default_data, simulation_options) {\r\n    // override any data with data from simulation object\r\n    return {\r\n      ...default_data,\r\n      ...simulation_options?.data,\r\n    };\r\n  }\r\n\r\n  ensureSimulationDataConsistency(trial, data) {\r\n    // All RTs must be rounded\r\n    if (data.rt) {\r\n      data.rt = Math.round(data.rt);\r\n    }\r\n\r\n    // If a trial_duration and rt exist, make sure that the RT is not longer than the trial.\r\n    if (trial.trial_duration && data.rt && data.rt > trial.trial_duration) {\r\n      data.rt = null;\r\n      if (data.response) {\r\n        data.response = null;\r\n      }\r\n      if (data.correct) {\r\n        data.correct = false;\r\n      }\r\n    }\r\n\r\n    // If trial.choices is NO_KEYS make sure that response and RT are null\r\n    if (trial.choices && trial.choices == \"NO_KEYS\") {\r\n      if (data.rt) {\r\n        data.rt = null;\r\n      }\r\n      if (data.response) {\r\n        data.response = null;\r\n      }\r\n    }\r\n\r\n    // If response is not allowed before stimulus display complete, ensure RT\r\n    // is longer than display time.\r\n    if (trial.allow_response_before_complete) {\r\n      if (trial.sequence_reps && trial.frame_time) {\r\n        const min_time = trial.sequence_reps * trial.frame_time * trial.stimuli.length;\r\n        if (data.rt < min_time) {\r\n          data.rt = null;\r\n          data.response = null;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","/**\r\n * A class that provides a wrapper around the global setTimeout and clearTimeout functions.\r\n */\r\nexport class TimeoutAPI {\r\n  private timeout_handlers: number[] = [];\r\n\r\n  /**\r\n   * Calls a function after a specified delay, in milliseconds.\r\n   * @param callback The function to call after the delay.\r\n   * @param delay The number of milliseconds to wait before calling the function.\r\n   * @returns A handle that can be used to clear the timeout with clearTimeout.\r\n   */\r\n  setTimeout(callback: () => void, delay: number): number {\r\n    const handle = window.setTimeout(callback, delay);\r\n    this.timeout_handlers.push(handle);\r\n    return handle;\r\n  }\r\n\r\n  /**\r\n   * Clears all timeouts that have been created with setTimeout.\r\n   */\r\n  clearAllTimeouts(): void {\r\n    for (const handler of this.timeout_handlers) {\r\n      clearTimeout(handler);\r\n    }\r\n    this.timeout_handlers = [];\r\n  }\r\n}\r\n","import autoBind from \"auto-bind\";\r\n\r\nimport { JsPsych } from \"../../JsPsych\";\r\nimport { KeyboardListenerAPI } from \"./KeyboardListenerAPI\";\r\nimport { MediaAPI } from \"./MediaAPI\";\r\nimport { SimulationAPI } from \"./SimulationAPI\";\r\nimport { TimeoutAPI } from \"./TimeoutAPI\";\r\n\r\nexport function createJointPluginAPIObject(jsPsych: JsPsych) {\r\n  const settings = jsPsych.getInitSettings();\r\n  const keyboardListenerAPI = new KeyboardListenerAPI(\r\n    jsPsych.getDisplayContainerElement,\r\n    settings.case_sensitive_responses,\r\n    settings.minimum_valid_rt\r\n  );\r\n  const timeoutAPI = new TimeoutAPI();\r\n  const mediaAPI = new MediaAPI(settings.use_webaudio);\r\n  const simulationAPI = new SimulationAPI(\r\n    jsPsych.getDisplayContainerElement,\r\n    timeoutAPI.setTimeout.bind(timeoutAPI)\r\n  );\r\n  return Object.assign(\r\n    {},\r\n    ...[keyboardListenerAPI, timeoutAPI, mediaAPI, simulationAPI].map((object) => autoBind(object))\r\n  ) as KeyboardListenerAPI & TimeoutAPI & MediaAPI & SimulationAPI;\r\n}\r\n\r\nexport type PluginAPI = ReturnType<typeof createJointPluginAPIObject>;\r\n","import rw from \"random-words\";\r\nimport seedrandom from \"seedrandom/lib/alea.js\";\r\n\r\n/**\r\n * Uses the `seedrandom` package to replace Math.random() with a seedable PRNG.\r\n *\r\n * @param seed An optional seed. If none is given, a random seed will be generated.\r\n * @returns The seed value.\r\n */\r\nexport function setSeed(seed: string = Math.random().toString()) {\r\n  Math.random = seedrandom(seed);\r\n  return seed;\r\n}\r\n\r\nexport function repeat(array: any, repetitions: any, unpack = false) {\r\n  const arr_isArray = Array.isArray(array);\r\n  const rep_isArray = Array.isArray(repetitions);\r\n\r\n  // if array is not an array, then we just repeat the item\r\n  if (!arr_isArray) {\r\n    if (!rep_isArray) {\r\n      array = [array];\r\n      repetitions = [repetitions];\r\n    } else {\r\n      repetitions = [repetitions[0]];\r\n      console.log(\r\n        \"Unclear parameters given to randomization.repeat. Multiple set sizes specified, but only one item exists to sample. Proceeding using the first set size.\"\r\n      );\r\n    }\r\n  } else {\r\n    // if repetitions is not an array, but array is, then we\r\n    // repeat repetitions for each entry in array\r\n    if (!rep_isArray) {\r\n      let reps = [];\r\n      for (let i = 0; i < array.length; i++) {\r\n        reps.push(repetitions);\r\n      }\r\n      repetitions = reps;\r\n    } else {\r\n      if (array.length != repetitions.length) {\r\n        console.warn(\r\n          \"Unclear parameters given to randomization.repeat. Items and repetitions are unequal lengths. Behavior may not be as expected.\"\r\n        );\r\n        // throw warning if repetitions is too short, use first rep ONLY.\r\n        if (repetitions.length < array.length) {\r\n          let reps = [];\r\n          for (let i = 0; i < array.length; i++) {\r\n            reps.push(repetitions);\r\n          }\r\n          repetitions = reps;\r\n        } else {\r\n          // throw warning if too long, and then use the first N\r\n          repetitions = repetitions.slice(0, array.length);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // should be clear at this point to assume that array and repetitions are arrays with == length\r\n  let allsamples = [];\r\n  for (let i = 0; i < array.length; i++) {\r\n    for (let j = 0; j < repetitions[i]; j++) {\r\n      if (array[i] == null || typeof array[i] != \"object\") {\r\n        allsamples.push(array[i]);\r\n      } else {\r\n        allsamples.push(Object.assign({}, array[i]));\r\n      }\r\n    }\r\n  }\r\n\r\n  let out: any = shuffle(allsamples);\r\n\r\n  if (unpack) {\r\n    out = unpackArray(out);\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\nexport function shuffle<T>(array: Array<T>) {\r\n  if (!Array.isArray(array)) {\r\n    console.error(\"Argument to shuffle() must be an array.\");\r\n  }\r\n\r\n  const copy_array = array.slice(0);\r\n  let m = copy_array.length,\r\n    t,\r\n    i;\r\n\r\n  // While there remain elements to shuffle\r\n  while (m) {\r\n    // Pick a remaining element\r\n    i = Math.floor(Math.random() * m--);\r\n\r\n    // And swap it with the current element.\r\n    t = copy_array[m];\r\n    copy_array[m] = copy_array[i];\r\n    copy_array[i] = t;\r\n  }\r\n\r\n  return copy_array;\r\n}\r\n\r\nexport function shuffleNoRepeats<T>(arr: Array<T>, equalityTest: (a: T, b: T) => boolean) {\r\n  if (!Array.isArray(arr)) {\r\n    console.error(\"First argument to shuffleNoRepeats() must be an array.\");\r\n  }\r\n  if (typeof equalityTest !== \"undefined\" && typeof equalityTest !== \"function\") {\r\n    console.error(\"Second argument to shuffleNoRepeats() must be a function.\");\r\n  }\r\n  // define a default equalityTest\r\n  if (typeof equalityTest == \"undefined\") {\r\n    equalityTest = function (a, b) {\r\n      if (a === b) {\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    };\r\n  }\r\n\r\n  const random_shuffle = shuffle(arr);\r\n\r\n  for (let i = 0; i < random_shuffle.length - 1; i++) {\r\n    if (equalityTest(random_shuffle[i], random_shuffle[i + 1])) {\r\n      // neighbors are equal, pick a new random neighbor to swap (not the first or last element, to avoid edge cases)\r\n      let random_pick = Math.floor(Math.random() * (random_shuffle.length - 2)) + 1;\r\n      // test to make sure the new neighbor isn't equal to the old one\r\n      while (\r\n        equalityTest(random_shuffle[i + 1], random_shuffle[random_pick]) ||\r\n        equalityTest(random_shuffle[i + 1], random_shuffle[random_pick + 1]) ||\r\n        equalityTest(random_shuffle[i + 1], random_shuffle[random_pick - 1]) ||\r\n        equalityTest(random_shuffle[i], random_shuffle[random_pick])\r\n      ) {\r\n        random_pick = Math.floor(Math.random() * (random_shuffle.length - 2)) + 1;\r\n      }\r\n      const new_neighbor = random_shuffle[random_pick];\r\n      random_shuffle[random_pick] = random_shuffle[i + 1];\r\n      random_shuffle[i + 1] = new_neighbor;\r\n    }\r\n  }\r\n\r\n  return random_shuffle;\r\n}\r\n\r\nexport function shuffleAlternateGroups<T extends any[]>(\r\n  arr_groups: Array<T>,\r\n  random_group_order = false\r\n) {\r\n  const n_groups = arr_groups.length;\r\n  if (n_groups == 1) {\r\n    console.warn(\r\n      \"shuffleAlternateGroups() was called with only one group. Defaulting to simple shuffle.\"\r\n    );\r\n    return shuffle(arr_groups[0]);\r\n  }\r\n\r\n  let group_order = [];\r\n  for (let i = 0; i < n_groups; i++) {\r\n    group_order.push(i);\r\n  }\r\n  if (random_group_order) {\r\n    group_order = shuffle(group_order);\r\n  }\r\n\r\n  const randomized_groups = [];\r\n  let min_length = null;\r\n  for (let i = 0; i < n_groups; i++) {\r\n    min_length =\r\n      min_length === null ? arr_groups[i].length : Math.min(min_length, arr_groups[i].length);\r\n    randomized_groups.push(shuffle(arr_groups[i]));\r\n  }\r\n\r\n  const out = [];\r\n  for (let i = 0; i < min_length; i++) {\r\n    for (let j = 0; j < group_order.length; j++) {\r\n      out.push(randomized_groups[group_order[j]][i]);\r\n    }\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\nexport function sampleWithoutReplacement<T>(arr: Array<T>, size: number) {\r\n  if (!Array.isArray(arr)) {\r\n    console.error(\"First argument to sampleWithoutReplacement() must be an array\");\r\n  }\r\n\r\n  if (size > arr.length) {\r\n    console.error(\"Cannot take a sample larger than the size of the set of items to sample.\");\r\n  }\r\n  return shuffle(arr).slice(0, size);\r\n}\r\n\r\nexport function sampleWithReplacement<T>(arr: Array<T>, size: number, weights?: number[]) {\r\n  if (!Array.isArray(arr)) {\r\n    console.error(\"First argument to sampleWithReplacement() must be an array\");\r\n  }\r\n\r\n  const normalized_weights = [];\r\n  if (typeof weights !== \"undefined\") {\r\n    if (weights.length !== arr.length) {\r\n      console.error(\r\n        \"The length of the weights array must equal the length of the array \" +\r\n          \"to be sampled from.\"\r\n      );\r\n    }\r\n    let weight_sum = 0;\r\n    for (const weight of weights) {\r\n      weight_sum += weight;\r\n    }\r\n    for (const weight of weights) {\r\n      normalized_weights.push(weight / weight_sum);\r\n    }\r\n  } else {\r\n    for (let i = 0; i < arr.length; i++) {\r\n      normalized_weights.push(1 / arr.length);\r\n    }\r\n  }\r\n\r\n  const cumulative_weights = [normalized_weights[0]];\r\n  for (let i = 1; i < normalized_weights.length; i++) {\r\n    cumulative_weights.push(normalized_weights[i] + cumulative_weights[i - 1]);\r\n  }\r\n\r\n  const samp = [];\r\n  for (let i = 0; i < size; i++) {\r\n    const rnd = Math.random();\r\n    let index = 0;\r\n    while (rnd > cumulative_weights[index]) {\r\n      index++;\r\n    }\r\n    samp.push(arr[index]);\r\n  }\r\n  return samp;\r\n}\r\n\r\nexport function factorial(factors: Record<string, any>, repetitions = 1, unpack = false) {\r\n  let design = [{}];\r\n  for (const [factorName, factor] of Object.entries(factors)) {\r\n    const new_design = [];\r\n    for (const level of factor) {\r\n      for (const cell of design) {\r\n        new_design.push({ ...cell, [factorName]: level });\r\n      }\r\n    }\r\n    design = new_design;\r\n  }\r\n\r\n  return repeat(design, repetitions, unpack);\r\n}\r\n\r\nexport function randomID(length = 32) {\r\n  let result = \"\";\r\n  const chars = \"0123456789abcdefghjklmnopqrstuvwxyz\";\r\n  for (let i = 0; i < length; i++) {\r\n    result += chars[Math.floor(Math.random() * chars.length)];\r\n  }\r\n  return result;\r\n}\r\n\r\n/**\r\n * Generate a random integer from `lower` to `upper`, inclusive of both end points.\r\n * @param lower The lowest value it is possible to generate\r\n * @param upper The highest value it is possible to generate\r\n * @returns A random integer\r\n */\r\nexport function randomInt(lower: number, upper: number) {\r\n  if (upper < lower) {\r\n    throw new Error(\"Upper boundary must be greater than or equal to lower boundary\");\r\n  }\r\n  return lower + Math.floor(Math.random() * (upper - lower + 1));\r\n}\r\n\r\n/**\r\n * Generates a random sample from a Bernoulli distribution.\r\n * @param p The probability of sampling 1.\r\n * @returns 0, with probability 1-p, or 1, with probability p.\r\n */\r\nexport function sampleBernoulli(p: number) {\r\n  return Math.random() <= p ? 1 : 0;\r\n}\r\n\r\nexport function sampleNormal(mean: number, standard_deviation: number) {\r\n  return randn_bm() * standard_deviation + mean;\r\n}\r\n\r\nexport function sampleExponential(rate: number) {\r\n  return -Math.log(Math.random()) / rate;\r\n}\r\n\r\nexport function sampleExGaussian(\r\n  mean: number,\r\n  standard_deviation: number,\r\n  rate: number,\r\n  positive = false\r\n) {\r\n  let s = sampleNormal(mean, standard_deviation) + sampleExponential(rate);\r\n  if (positive) {\r\n    while (s <= 0) {\r\n      s = sampleNormal(mean, standard_deviation) + sampleExponential(rate);\r\n    }\r\n  }\r\n  return s;\r\n}\r\n\r\ntype RandomWordsOptions = {\r\n  min?: number;\r\n  max?: number;\r\n  exactly?: number;\r\n  maxLength?: number;\r\n  wordsPerString?: number;\r\n  seperator?: string;\r\n  formatter?: (word: string, index: number) => string;\r\n  join?: string;\r\n};\r\n\r\ntype RandomWordsResult<T extends RandomWordsOptions> = T extends { join: string }\r\n  ? string\r\n  : string[];\r\n\r\n/**\r\n * Generate one or more random words.\r\n *\r\n * This is a wrapper function for the {@link https://www.npmjs.com/package/random-words `random-words` npm package}.\r\n *\r\n * @param opts An object with optional properties `min`, `max`, `exactly`,\r\n * `join`, `maxLength`, `wordsPerString`, `separator`, and `formatter`.\r\n *\r\n * @returns An array of words or a single string, depending on parameter choices.\r\n */\r\nexport function randomWords<T extends RandomWordsOptions>(opts: T) {\r\n  // there is a type incompatibility here because `random-words` uses overloads rather than generics\r\n  return rw(opts) as RandomWordsResult<T>;\r\n}\r\n\r\n// Box-Muller transformation for a random sample from normal distribution with mean = 0, std = 1\r\n// https://stackoverflow.com/a/36481059/3726673\r\nfunction randn_bm() {\r\n  var u = 0,\r\n    v = 0;\r\n  while (u === 0) u = Math.random(); //Converting [0,1) to (0,1)\r\n  while (v === 0) v = Math.random();\r\n  return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);\r\n}\r\n\r\nfunction unpackArray(array: object[]) {\r\n  const out: Record<string, any> = {};\r\n\r\n  for (const x of array) {\r\n    for (const key of Object.keys(x)) {\r\n      if (typeof out[key] === \"undefined\") {\r\n        out[key] = [];\r\n      }\r\n      out[key].push(x[key]);\r\n    }\r\n  }\r\n\r\n  return out;\r\n}\r\n","interface turkInformation {\r\n  /**\r\n   * Is the experiment being loaded in preview mode on Mechanical Turk?\r\n   */\r\n  previewMode: boolean;\r\n  /**\r\n   * Is the experiment being loaded outside of the Mechanical Turk environment?\r\n   */\r\n  outsideTurk: boolean;\r\n  /**\r\n   * The HIT ID.\r\n   */\r\n  hitId: string;\r\n  /**\r\n   * The Assignment ID.\r\n   */\r\n  assignmentId: string;\r\n  /**\r\n   * The worker ID.\r\n   */\r\n  workerId: string;\r\n  /**\r\n   * URL for submission of the HIT.\r\n   */\r\n  turkSubmitTo: string;\r\n}\r\n\r\n/**\r\n * Gets information about the Mechanical Turk Environment, HIT, Assignment, and Worker\r\n * by parsing the URL variables that Mechanical Turk generates.\r\n * @returns An object containing information about the Mechanical Turk Environment, HIT, Assignment, and Worker.\r\n */\r\nexport function turkInfo(): turkInformation {\r\n  const turk: turkInformation = {\r\n    previewMode: false,\r\n    outsideTurk: false,\r\n    hitId: \"INVALID_URL_PARAMETER\",\r\n    assignmentId: \"INVALID_URL_PARAMETER\",\r\n    workerId: \"INVALID_URL_PARAMETER\",\r\n    turkSubmitTo: \"INVALID_URL_PARAMETER\",\r\n  };\r\n\r\n  const param = function (url, name) {\r\n    name = name.replace(/[\\[]/, \"\\\\[\").replace(/[\\]]/, \"\\\\]\");\r\n    const regexS = \"[\\\\?&]\" + name + \"=([^&#]*)\";\r\n    const regex = new RegExp(regexS);\r\n    const results = regex.exec(url);\r\n    return results == null ? \"\" : results[1];\r\n  };\r\n\r\n  const src = param(window.location.href, \"assignmentId\")\r\n    ? window.location.href\r\n    : document.referrer;\r\n\r\n  const keys = [\"assignmentId\", \"hitId\", \"workerId\", \"turkSubmitTo\"];\r\n  keys.map(function (key) {\r\n    turk[key] = unescape(param(src, key));\r\n  });\r\n\r\n  turk.previewMode = turk.assignmentId == \"ASSIGNMENT_ID_NOT_AVAILABLE\";\r\n\r\n  turk.outsideTurk =\r\n    !turk.previewMode && turk.hitId === \"\" && turk.assignmentId == \"\" && turk.workerId == \"\";\r\n\r\n  return turk;\r\n}\r\n\r\n/**\r\n * Send data to Mechnical Turk for storage.\r\n * @param data An object containing `key:value` pairs to send to Mechanical Turk. Values\r\n * cannot contain nested objects, arrays, or functions.\r\n * @returns Nothing\r\n */\r\nexport function submitToTurk(data) {\r\n  const turk = turkInfo();\r\n  const assignmentId = turk.assignmentId;\r\n  const turkSubmitTo = turk.turkSubmitTo;\r\n\r\n  if (!assignmentId || !turkSubmitTo) return;\r\n\r\n  const form = document.createElement(\"form\");\r\n  form.method = \"POST\";\r\n  form.action = turkSubmitTo + \"/mturk/externalSubmit?assignmentId=\" + assignmentId;\r\n\r\n  for (const key in data) {\r\n    if (data.hasOwnProperty(key)) {\r\n      const hiddenField = document.createElement(\"input\");\r\n      hiddenField.type = \"hidden\";\r\n      hiddenField.name = key;\r\n      hiddenField.id = key;\r\n      hiddenField.value = data[key];\r\n\r\n      form.appendChild(hiddenField);\r\n    }\r\n  }\r\n\r\n  document.body.appendChild(form);\r\n  form.submit();\r\n}\r\n","/**\r\n * Maintains a visual progress bar using HTML and CSS\r\n */\r\nexport class ProgressBar {\r\n  constructor(\r\n    private readonly containerElement: HTMLDivElement,\r\n    private readonly message: string | ((progress: number) => string)\r\n  ) {\r\n    this.setupElements();\r\n  }\r\n\r\n  private _progress = 0;\r\n\r\n  private innerDiv: HTMLDivElement;\r\n  private messageSpan: HTMLSpanElement;\r\n\r\n  /** Adds the progress bar HTML code into `this.containerElement` */\r\n  private setupElements() {\r\n    this.messageSpan = document.createElement(\"span\");\r\n\r\n    this.innerDiv = document.createElement(\"div\");\r\n    this.innerDiv.id = \"jspsych-progressbar-inner\";\r\n    this.update();\r\n\r\n    const outerDiv = document.createElement(\"div\");\r\n    outerDiv.id = \"jspsych-progressbar-outer\";\r\n    outerDiv.appendChild(this.innerDiv);\r\n\r\n    this.containerElement.appendChild(this.messageSpan);\r\n    this.containerElement.appendChild(outerDiv);\r\n  }\r\n\r\n  /** Updates the progress bar according to `this.progress` */\r\n  private update() {\r\n    this.innerDiv.style.width = this._progress * 100 + \"%\";\r\n\r\n    if (typeof this.message === \"function\") {\r\n      this.messageSpan.innerHTML = this.message(this._progress);\r\n    } else {\r\n      this.messageSpan.innerHTML = this.message;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The bar's current position as a number in the closed interval [0, 1]. Set this to update the\r\n   * progress bar accordingly.\r\n   */\r\n  set progress(progress: number) {\r\n    if (typeof progress !== \"number\" || progress < 0 || progress > 1) {\r\n      throw new Error(\"jsPsych.progressBar.progress must be a number between 0 and 1\");\r\n    }\r\n\r\n    this._progress = progress;\r\n    this.update();\r\n  }\r\n\r\n  get progress() {\r\n    return this._progress;\r\n  }\r\n}\r\n","import { Class } from \"type-fest\";\r\n\r\nimport { JsPsychExtension } from \"../modules/extensions\";\r\nimport { JsPsychPlugin, PluginInfo } from \"../modules/plugins\";\r\nimport { Trial } from \"./Trial\";\r\nimport { PromiseWrapper } from \"./util\";\r\n\r\nexport class TimelineVariable {\r\n  constructor(public readonly name: string) {}\r\n}\r\n\r\nexport type Parameter<T> = T | (() => T) | TimelineVariable;\r\n\r\nexport type TrialExtensionsConfiguration = Array<{\r\n  type: Class<JsPsychExtension>;\r\n  params?: Record<string, any>;\r\n}>;\r\n\r\nexport type SimulationMode = \"visual\" | \"data-only\";\r\n\r\nexport type SimulationOptions = {\r\n  data?: Record<string, any>;\r\n  mode?: SimulationMode;\r\n  simulate?: boolean;\r\n};\r\n\r\nexport type SimulationOptionsParameter = Parameter<{\r\n  data?: Parameter<Record<string, Parameter<any>>>;\r\n  mode?: Parameter<SimulationMode>;\r\n  simulate?: Parameter<boolean>;\r\n}>;\r\n\r\nexport interface TrialDescription extends Record<string, any> {\r\n  type: Parameter<Class<JsPsychPlugin<any>>>;\r\n\r\n  /** https://www.jspsych.org/latest/overview/plugins/#the-post_trial_gap-iti-parameter */\r\n  post_trial_gap?: Parameter<number>;\r\n\r\n  /** https://www.jspsych.org/latest/overview/plugins/#the-save_trial_parameters-parameter */\r\n  save_trial_parameters?: Parameter<Record<string, boolean>>;\r\n\r\n  /**\r\n   * Whether to include the values of timeline variables under a `timeline_variables` key. Can be\r\n   * `true` to save the values of all timeline variables, or an array of timeline variable names to\r\n   * only save specific timeline variables. Defaults to `false`.\r\n   */\r\n  save_timeline_variables?: Parameter<boolean | string[]>;\r\n\r\n  /** https://www.jspsych.org/latest/overview/style/#using-the-css_classes-trial-parameter */\r\n  css_classes?: Parameter<string | string[]>;\r\n\r\n  /** https://www.jspsych.org/latest/overview/simulation/#controlling-simulation-mode-with-simulation_options */\r\n  simulation_options?: SimulationOptionsParameter | string;\r\n\r\n  /** https://www.jspsych.org/latest/overview/extensions/ */\r\n  extensions?: Parameter<TrialExtensionsConfiguration>;\r\n\r\n  /**\r\n   * Whether to record the data of this trial. Defaults to `true`.\r\n   */\r\n  record_data?: Parameter<boolean>;\r\n\r\n  // Events\r\n\r\n  /** https://www.jspsych.org/latest/overview/events/#on_start-trial */\r\n  on_start?: (trial: any) => void;\r\n\r\n  /** https://www.jspsych.org/latest/overview/events/#on_load */\r\n  on_load?: () => void;\r\n\r\n  /** https://www.jspsych.org/latest/overview/events/#on_finish-trial */\r\n  on_finish?: (data: any) => void;\r\n}\r\n\r\n/** https://www.jspsych.org/latest/overview/timeline/#sampling-methods */\r\nexport type SampleOptions =\r\n  | { type: \"with-replacement\"; size: number; weights?: number[] }\r\n  | { type: \"without-replacement\"; size: number }\r\n  | { type: \"fixed-repetitions\"; size: number }\r\n  | { type: \"alternate-groups\"; groups: number[][]; randomize_group_order?: boolean }\r\n  | { type: \"custom\"; fn: (ids: number[]) => number[] };\r\n\r\nexport type TimelineArray = Array<TimelineDescription | TrialDescription | TimelineArray>;\r\n\r\nexport interface TimelineDescription extends Record<string, any> {\r\n  timeline: TimelineArray;\r\n  timeline_variables?: Record<string, any>[];\r\n\r\n  name?: string;\r\n\r\n  // Control flow\r\n\r\n  /** https://www.jspsych.org/latest/overview/timeline/#repeating-a-set-of-trials */\r\n  repetitions?: number;\r\n\r\n  /** https://www.jspsych.org/latest/overview/timeline/#looping-timelines */\r\n  loop_function?: (data: any) => boolean;\r\n\r\n  /** https://www.jspsych.org/latest/overview/timeline/#conditional-timelines */\r\n  conditional_function?: () => boolean;\r\n\r\n  // Randomization\r\n\r\n  /** https://www.jspsych.org/latest/overview/timeline/#random-orders-of-trials */\r\n  randomize_order?: boolean;\r\n\r\n  /** https://www.jspsych.org/latest/overview/timeline/#sampling-methods */\r\n  sample?: SampleOptions;\r\n\r\n  // Events\r\n\r\n  /** https://www.jspsych.org/latest/overview/events/#on_timeline_start */\r\n  on_timeline_start?: () => void;\r\n\r\n  /** https://www.jspsych.org/latest/overview/events/#on_timeline_finish */\r\n  on_timeline_finish?: () => void;\r\n}\r\n\r\nexport const timelineDescriptionKeys = [\r\n  \"timeline\",\r\n  \"timeline_variables\",\r\n  \"name\",\r\n  \"repetitions\",\r\n  \"loop_function\",\r\n  \"conditional_function\",\r\n  \"randomize_order\",\r\n  \"sample\",\r\n  \"on_timeline_start\",\r\n  \"on_timeline_finish\",\r\n];\r\n\r\nexport function isTrialDescription(\r\n  description: TrialDescription | TimelineDescription\r\n): description is TrialDescription {\r\n  return !isTimelineDescription(description);\r\n}\r\n\r\nexport function isTimelineDescription(\r\n  description: TrialDescription | TimelineDescription | TimelineArray\r\n): description is TimelineDescription | TimelineArray {\r\n  return Boolean((description as TimelineDescription).timeline) || Array.isArray(description);\r\n}\r\n\r\nexport enum TimelineNodeStatus {\r\n  PENDING,\r\n  RUNNING,\r\n  PAUSED,\r\n  COMPLETED,\r\n  ABORTED,\r\n}\r\n\r\n/**\r\n * Functions and options needed by `TimelineNode`s, provided by the `JsPsych` instance. This\r\n * approach allows to keep the public `JsPsych` API slim and decouples the `JsPsych` and timeline\r\n * node classes, simplifying unit testing.\r\n */\r\nexport interface TimelineNodeDependencies {\r\n  /**\r\n   * Called at the start of a trial, prior to invoking the plugin's trial method.\r\n   */\r\n  onTrialStart: (trial: Trial) => void;\r\n\r\n  /**\r\n   * Called when a trial's result data is available, before invoking `onTrialFinished()`.\r\n   */\r\n  onTrialResultAvailable: (trial: Trial) => void;\r\n\r\n  /**\r\n   * Called after a trial has finished.\r\n   */\r\n  onTrialFinished: (trial: Trial) => void;\r\n\r\n  /**\r\n   * Invoke `on_start` extension callbacks according to `extensionsConfiguration`\r\n   */\r\n  runOnStartExtensionCallbacks(extensionsConfiguration: TrialExtensionsConfiguration): void;\r\n\r\n  /**\r\n   * Invoke `on_load` extension callbacks according to `extensionsConfiguration`\r\n   */\r\n  runOnLoadExtensionCallbacks(extensionsConfiguration: TrialExtensionsConfiguration): void;\r\n\r\n  /**\r\n   * Invoke `on_finish` extension callbacks according to `extensionsConfiguration` and return a\r\n   * joint extensions result object\r\n   */\r\n  runOnFinishExtensionCallbacks(\r\n    extensionsConfiguration: TrialExtensionsConfiguration\r\n  ): Promise<Record<string, any>>;\r\n\r\n  /**\r\n   * Returns the simulation mode or `undefined`, if the experiment is not running in simulation\r\n   * mode.\r\n   */\r\n  getSimulationMode(): SimulationMode | undefined;\r\n\r\n  /**\r\n   * Returns the global simulation options as passed to `jsPsych.simulate()`\r\n   */\r\n  getGlobalSimulationOptions(): Record<string, SimulationOptionsParameter>;\r\n\r\n  /**\r\n   * Given a plugin class, create a new instance of it and return it.\r\n   */\r\n  instantiatePlugin: <Info extends PluginInfo>(\r\n    pluginClass: Class<JsPsychPlugin<Info>>\r\n  ) => JsPsychPlugin<Info>;\r\n\r\n  /**\r\n   * Return JsPsych's display element so it can be provided to plugins\r\n   */\r\n  getDisplayElement: () => HTMLElement;\r\n\r\n  /**\r\n   * Return the default inter-trial interval as provided to `initJsPsych()`\r\n   */\r\n  getDefaultIti: () => number;\r\n\r\n  /**\r\n   * A `PromiseWrapper` whose promise is resolved with result data whenever `jsPsych.finishTrial()`\r\n   * is called.\r\n   */\r\n  finishTrialPromise: PromiseWrapper<TrialResult | void>;\r\n\r\n  /**\r\n   * Clear all of the timeouts\r\n   */\r\n  clearAllTimeouts: () => void;\r\n}\r\n\r\nexport type TrialResult = Record<string, any>;\r\nexport type TrialResults = Array<Record<string, any>>;\r\n","/**\r\n * Maintains a promise and offers a function to resolve it. Whenever the promise is resolved, it is\r\n * replaced with a new one.\r\n */\r\nexport class PromiseWrapper<ResolveType = void> {\r\n  constructor() {\r\n    this.reset();\r\n  }\r\n\r\n  private promise: Promise<ResolveType>;\r\n  private resolvePromise: (resolveValue: ResolveType) => void;\r\n\r\n  reset() {\r\n    this.promise = new Promise((resolve) => {\r\n      this.resolvePromise = resolve;\r\n    });\r\n  }\r\n  get() {\r\n    return this.promise;\r\n  }\r\n  resolve(value: ResolveType) {\r\n    this.resolvePromise(value);\r\n    this.reset();\r\n  }\r\n}\r\n\r\nexport function isPromise(value: any): value is Promise<any> {\r\n  return value && typeof value[\"then\"] === \"function\";\r\n}\r\n\r\nexport function delay(ms: number) {\r\n  return new Promise((resolve) => setTimeout(resolve, ms));\r\n}\r\n\r\n/**\r\n * Returns the string representation of a `path` array like accepted by lodash's `get` and `set`\r\n * functions.\r\n */\r\nexport function parameterPathArrayToString([firstPathElement, ...remainingPathElements]: string[]) {\r\n  let pathString = firstPathElement ?? \"\";\r\n\r\n  for (const pathElement of remainingPathElements) {\r\n    pathString += Number.isNaN(Number.parseInt(pathElement))\r\n      ? `.${pathElement}`\r\n      : `[${pathElement}]`;\r\n  }\r\n\r\n  return pathString;\r\n}\r\n\r\nfunction isObjectOrArray(value: any): value is Record<string, any> | any[] {\r\n  return typeof value === \"object\" && value !== null;\r\n}\r\n\r\ntype LookupResult = { doesPathExist: boolean; value?: any };\r\n\r\n/**\r\n * Initialized with an object, provides a `lookup` method to look up nested object and array paths\r\n * and a `set` method to override the element that `lookup` uses at a given path. The original\r\n * object remains unmodified. All looked up values are cached, including those at intermediate\r\n * paths. This means, `set`ting the element at a path only affects nested path lookups if the paths\r\n * have not been looked up and cached before.\r\n */\r\nexport class ParameterObjectPathCache {\r\n  private static lookupChild(\r\n    objectOrArray: Record<string, any> | any[],\r\n    childName: string\r\n  ): LookupResult {\r\n    let doesPathExist: boolean = false;\r\n    let childValue: any;\r\n\r\n    if (Number.isNaN(Number.parseInt(childName))) {\r\n      // `childName` refers to an object property\r\n      if (Object.hasOwn(objectOrArray, childName)) {\r\n        doesPathExist = true;\r\n        childValue = objectOrArray[childName];\r\n      }\r\n    } else {\r\n      // `childName` refers to an array index\r\n      if (Number.parseInt(childName) < objectOrArray.length) {\r\n        doesPathExist = true;\r\n        childValue = objectOrArray[childName];\r\n      }\r\n    }\r\n\r\n    return { doesPathExist, value: childValue };\r\n  }\r\n\r\n  private cache = new Map<string, any>();\r\n  private rootObject: any;\r\n\r\n  private get(path: string[]) {\r\n    return this.cache.get(path.join(\".\"));\r\n  }\r\n\r\n  private has(path: string[]) {\r\n    return this.cache.has(path.join(\".\"));\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  public initialize(rootObject: any) {\r\n    this.rootObject = rootObject;\r\n    this.cache.set(\"\", rootObject);\r\n  }\r\n\r\n  public reset() {\r\n    this.cache.clear();\r\n    this.cache.set(\"\", this.rootObject);\r\n  }\r\n\r\n  public set(path: string[], value: any) {\r\n    this.cache.set(path.join(\".\"), value);\r\n  }\r\n\r\n  public lookup(path: string[]): LookupResult {\r\n    if (this.has(path)) {\r\n      return { doesPathExist: true, value: this.get(path) };\r\n    }\r\n\r\n    // Recursively find the closest ancestor path that has already been cached and start looking up\r\n    // the path from there, caching intermediate elements along the way\r\n    const lookupPath = (path: string[]): LookupResult => {\r\n      const parentPath = path.slice(0, -1);\r\n      const childName = path[path.length - 1];\r\n      if (!this.has(parentPath) && parentPath.length > 0) {\r\n        if (!lookupPath(parentPath).doesPathExist) {\r\n          return { doesPathExist: false };\r\n        }\r\n      }\r\n\r\n      const parentValue = this.get(parentPath);\r\n      if (!isObjectOrArray(parentValue)) {\r\n        return { doesPathExist: false };\r\n      }\r\n\r\n      const lookupResult = ParameterObjectPathCache.lookupChild(parentValue, childName);\r\n      if (lookupResult.doesPathExist) {\r\n        this.set(path, lookupResult.value);\r\n      }\r\n      return lookupResult;\r\n    };\r\n\r\n    return lookupPath(path);\r\n  }\r\n}\r\n","import type { Timeline } from \"./Timeline\";\r\nimport { ParameterObjectPathCache } from \"./util\";\r\nimport {\r\n  TimelineArray,\r\n  TimelineDescription,\r\n  TimelineNodeDependencies,\r\n  TimelineNodeStatus,\r\n  TimelineVariable,\r\n  TrialDescription,\r\n  TrialResult,\r\n} from \".\";\r\n\r\nexport type GetParameterValueOptions = {\r\n  /**\r\n   * If true, and the retrieved parameter value is a function, invoke the function and return its\r\n   * return value (defaults to `true`)\r\n   */\r\n  evaluateFunctions?: boolean;\r\n\r\n  /**\r\n   * Whether to fall back to parent timeline node parameters (defaults to `true`)\r\n   */\r\n  recursive?: boolean;\r\n\r\n  /**\r\n   * Whether the timeline node should cache the parameter lookup result for successive lookups,\r\n   * including those of nested properties or array elements (defaults to `true`)\r\n   */\r\n  cacheResult?: boolean;\r\n\r\n  /**\r\n   * A function that will be invoked with the original result of the parameter value lookup.\r\n   * Whatever it returns will subsequently be used instead of the original result. This allows to\r\n   * modify results before they are cached.\r\n   */\r\n  replaceResult?: (originalResult: any) => any;\r\n};\r\n\r\nexport abstract class TimelineNode {\r\n  public abstract readonly description: TimelineDescription | TrialDescription | TimelineArray;\r\n\r\n  /**\r\n   * The globally unique trial index of this node. It is set when the node is run. Timeline nodes\r\n   * have the same trial index as their first trial.\r\n   */\r\n  public index?: number;\r\n\r\n  public abstract readonly parent?: Timeline;\r\n\r\n  abstract run(): Promise<void>;\r\n\r\n  /**\r\n   * Returns a flat array of all currently available results of this node\r\n   */\r\n  abstract getResults(): TrialResult[];\r\n\r\n  /**\r\n   * Recursively evaluates the given timeline variable, starting at the current timeline node.\r\n   * Returns the result, or `undefined` if the variable is neither specified in the timeline\r\n   * description of this node, nor in the description of any parent node.\r\n   */\r\n  abstract evaluateTimelineVariable(variable: TimelineVariable): any;\r\n\r\n  /**\r\n   * Returns the most recent (child) TimelineNode. For trial nodes, this is always the trial node\r\n   * itself since trial nodes do not have child nodes. For timeline nodes, the return value is a\r\n   * Trial object most of the time, but it may also be a Timeline object when a timeline hasn't yet\r\n   * instantiated its children (e.g. during initial timeline callback functions).\r\n   */\r\n  abstract getLatestNode(): TimelineNode;\r\n\r\n  /**\r\n   * Returns an active child timeline (or itself) that matches the given name, or `undefined` if no such child exists.\r\n   */\r\n  abstract getActiveTimelineByName(name: string): Timeline | undefined;\r\n\r\n  protected status = TimelineNodeStatus.PENDING;\r\n\r\n  constructor(protected readonly dependencies: TimelineNodeDependencies) {}\r\n\r\n  getStatus() {\r\n    return this.status;\r\n  }\r\n\r\n  private parameterValueCache = new ParameterObjectPathCache();\r\n\r\n  /**\r\n   * Initializes the parameter value cache with `this.description`. To be called by subclass\r\n   * constructors after setting `this.description`.\r\n   */\r\n  protected initializeParameterValueCache() {\r\n    this.parameterValueCache.initialize(this.description);\r\n  }\r\n\r\n  /**\r\n   * Resets all cached parameter values in this timeline node and all of its parents. This is\r\n   * necessary to re-evaluate function parameters and timeline variables at each new trial.\r\n   */\r\n  protected resetParameterValueCache() {\r\n    this.parameterValueCache.reset();\r\n    this.parent?.resetParameterValueCache();\r\n  }\r\n\r\n  /**\r\n   * Retrieves a parameter value from the description of this timeline node, recursively falling\r\n   * back to the description of each parent timeline node unless `recursive` is set to `false`. If\r\n   * the parameter...\r\n   *\r\n   * * is a timeline variable, evaluates the variable and returns the result.\r\n   * * is not specified, returns `undefined`.\r\n   * * is a function and `evaluateFunctions` is not set to `false`, invokes the function and returns\r\n   *   its return value\r\n   * * has previously been looked up, return the cached result of the previous lookup\r\n   *\r\n   * @param parameterPath The path of the respective parameter in the timeline node description. If\r\n   * the path is an array, nested object properties or array items will be looked up.\r\n   * @param options See {@link GetParameterValueOptions}\r\n   */\r\n  public getParameterValue(\r\n    parameterPath: string | string[],\r\n    options: GetParameterValueOptions = {}\r\n  ): any {\r\n    const {\r\n      evaluateFunctions = true,\r\n      recursive = true,\r\n      cacheResult = true,\r\n      replaceResult,\r\n    } = options;\r\n\r\n    if (typeof parameterPath === \"string\") {\r\n      parameterPath = [parameterPath];\r\n    }\r\n\r\n    let { doesPathExist, value: result } = this.parameterValueCache.lookup(parameterPath);\r\n    if (!doesPathExist && recursive && this.parent) {\r\n      result = this.parent.getParameterValue(parameterPath, options);\r\n    }\r\n\r\n    if (typeof result === \"function\" && evaluateFunctions) {\r\n      result = result();\r\n    }\r\n    if (result instanceof TimelineVariable) {\r\n      result = this.evaluateTimelineVariable(result);\r\n    }\r\n\r\n    if (typeof replaceResult === \"function\") {\r\n      result = replaceResult(result);\r\n    }\r\n\r\n    if (cacheResult) {\r\n      this.parameterValueCache.set(parameterPath, result);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Retrieves and evaluates the `data` parameter. It is different from other parameters in that\r\n   * it's properties may be functions that have to be evaluated, and parent nodes' data parameter\r\n   * properties are merged into the result.\r\n   */\r\n  public getDataParameter(): Record<string, any> | undefined {\r\n    const data = this.getParameterValue(\"data\", { recursive: false });\r\n\r\n    return {\r\n      ...Object.fromEntries(\r\n        typeof data === \"object\"\r\n          ? Object.keys(data).map((key) => [key, this.getParameterValue([\"data\", key])])\r\n          : []\r\n      ),\r\n      ...this.parent?.getDataParameter(),\r\n    };\r\n  }\r\n}\r\n","import { Class } from \"type-fest\";\r\n\r\nimport { ParameterInfos } from \"../modules/plugins\";\r\nimport { JsPsychPlugin, ParameterType, PluginInfo } from \"../modules/plugins\";\r\nimport { deepCopy, deepMerge } from \"../modules/utils\";\r\nimport { Timeline } from \"./Timeline\";\r\nimport { GetParameterValueOptions, TimelineNode } from \"./TimelineNode\";\r\nimport { delay, isPromise, parameterPathArrayToString } from \"./util\";\r\nimport {\r\n  SimulationOptions,\r\n  TimelineNodeDependencies,\r\n  TimelineNodeStatus,\r\n  TimelineVariable,\r\n  TrialDescription,\r\n  TrialResult,\r\n  timelineDescriptionKeys,\r\n} from \".\";\r\n\r\nexport class Trial extends TimelineNode {\r\n  public readonly pluginClass: Class<JsPsychPlugin<any>>;\r\n  public pluginInstance: JsPsychPlugin<any>;\r\n  public trialObject?: TrialDescription;\r\n  public index?: number;\r\n\r\n  private result: TrialResult;\r\n  private readonly pluginInfo: PluginInfo;\r\n\r\n  constructor(\r\n    dependencies: TimelineNodeDependencies,\r\n    public readonly description: TrialDescription,\r\n    public readonly parent: Timeline\r\n  ) {\r\n    super(dependencies);\r\n    this.initializeParameterValueCache();\r\n\r\n    this.trialObject = deepCopy(description);\r\n    this.pluginClass = this.getParameterValue(\"type\", { evaluateFunctions: false });\r\n    this.pluginInfo = this.pluginClass?.[\"info\"];\r\n    if (!this.pluginInfo) {\r\n      throw new Error(\r\n        \"Plugin not recognized. Please provide a valid plugin using the 'type' parameter.\"\r\n      );\r\n    }\r\n\r\n    if (!(\"version\" in this.pluginInfo) && !(\"data\" in this.pluginInfo)) {\r\n      console.warn(\r\n        this.pluginInfo[\"name\"],\r\n        \"is missing the 'version' and 'data' fields. Please update plugin as 'version' and 'data' will be required in v9. See https://www.jspsych.org/latest/developers/plugin-development/ for more details.\"\r\n      );\r\n    } else if (!(\"version\" in this.pluginInfo)) {\r\n      console.warn(\r\n        this.pluginInfo[\"name\"],\r\n        \"is missing the 'version' field. Please update plugin as 'version' will be required in v9. See https://www.jspsych.org/latest/developers/plugin-development/ for more details.\"\r\n      );\r\n    } else if (!(\"data\" in this.pluginInfo)) {\r\n      console.warn(\r\n        this.pluginInfo[\"name\"],\r\n        \"is missing the 'data' field. Please update plugin as 'data' will be required in v9. See https://www.jspsych.org/latest/developers/plugin-development/ for more details.\"\r\n      );\r\n    }\r\n  }\r\n\r\n  public async run() {\r\n    this.status = TimelineNodeStatus.RUNNING;\r\n    this.processParameters();\r\n\r\n    this.onStart();\r\n    this.addCssClasses();\r\n\r\n    this.pluginInstance = this.dependencies.instantiatePlugin(this.pluginClass);\r\n\r\n    this.result = this.processResult(await this.executeTrial());\r\n\r\n    this.dependencies.onTrialResultAvailable(this);\r\n\r\n    this.status = TimelineNodeStatus.COMPLETED;\r\n\r\n    await this.onFinish();\r\n    this.removeCssClasses();\r\n\r\n    const gap = this.getParameterValue(\"post_trial_gap\") ?? this.dependencies.getDefaultIti();\r\n    if (gap !== 0 && this.dependencies.getSimulationMode() !== \"data-only\") {\r\n      await delay(gap);\r\n    }\r\n\r\n    this.resetParameterValueCache();\r\n  }\r\n\r\n  private async executeTrial() {\r\n    const trialPromise = this.dependencies.finishTrialPromise.get();\r\n\r\n    /** Used as a way to figure out if `finishTrial()` has ben called without awaiting `trialPromise` */\r\n    let hasTrialPromiseBeenResolved = false;\r\n    trialPromise.then(() => {\r\n      hasTrialPromiseBeenResolved = true;\r\n    });\r\n\r\n    const { trialReturnValue, hasTrialBeenSimulated } = this.invokeTrialMethod();\r\n\r\n    // Wait until the trial has completed and grab result data\r\n    let result: TrialResult | void;\r\n    if (isPromise(trialReturnValue)) {\r\n      result = await Promise.race([trialReturnValue, trialPromise]);\r\n\r\n      // If `finishTrial()` was called, use the result provided to it. This may happen although\r\n      // `trialReturnValue` won the race (\"run-to-completion\").\r\n      if (hasTrialPromiseBeenResolved) {\r\n        result = await trialPromise;\r\n      }\r\n    } else {\r\n      // The `simulate` method always invokes `onLoad()`, so we don't call `onLoad()` when the trial\r\n      // has been simulated\r\n      if (!hasTrialBeenSimulated) {\r\n        this.onLoad();\r\n      }\r\n\r\n      result = await trialPromise;\r\n    }\r\n\r\n    // The trial has finished, time to clean up.\r\n    this.cleanupTrial();\r\n\r\n    return result;\r\n  }\r\n\r\n  private invokeTrialMethod(): {\r\n    trialReturnValue: void | Promise<void | TrialResult>;\r\n    hasTrialBeenSimulated: boolean;\r\n  } {\r\n    const globalSimulationMode = this.dependencies.getSimulationMode();\r\n\r\n    if (globalSimulationMode && typeof this.pluginInstance.simulate === \"function\") {\r\n      const simulationOptions = this.getSimulationOptions();\r\n\r\n      if (simulationOptions.simulate !== false) {\r\n        return {\r\n          hasTrialBeenSimulated: true,\r\n          trialReturnValue: this.pluginInstance.simulate(\r\n            this.trialObject,\r\n            simulationOptions.mode ?? globalSimulationMode,\r\n            simulationOptions,\r\n            this.onLoad\r\n          ),\r\n        };\r\n      }\r\n    }\r\n\r\n    return {\r\n      hasTrialBeenSimulated: false,\r\n      trialReturnValue: this.pluginInstance.trial(\r\n        this.dependencies.getDisplayElement(),\r\n        this.trialObject,\r\n        this.onLoad\r\n      ),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Cleanup the trial by removing the display element and removing event listeners\r\n   */\r\n  private cleanupTrial() {\r\n    this.dependencies.clearAllTimeouts();\r\n    this.dependencies.getDisplayElement().innerHTML = \"\";\r\n  }\r\n\r\n  /**\r\n   * Add the CSS classes from the `css_classes` parameter to the display element\r\n   */\r\n  private addCssClasses() {\r\n    const classes: string | string[] = this.getParameterValue(\"css_classes\");\r\n    const classList = this.dependencies.getDisplayElement().classList;\r\n    if (typeof classes === \"string\") {\r\n      classList.add(classes);\r\n    } else if (Array.isArray(classes)) {\r\n      classList.add(...classes);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes the provided css classes from the display element\r\n   */\r\n  private removeCssClasses() {\r\n    const classes = this.getParameterValue(\"css_classes\");\r\n    if (classes) {\r\n      this.dependencies\r\n        .getDisplayElement()\r\n        .classList.remove(...(typeof classes === \"string\" ? [classes] : classes));\r\n    }\r\n  }\r\n\r\n  private processResult(result: TrialResult | void) {\r\n    if (!result) {\r\n      result = {};\r\n    }\r\n\r\n    for (const [parameterName, shouldParameterBeIncluded] of Object.entries(\r\n      this.getParameterValue(\"save_trial_parameters\") ?? {}\r\n    )) {\r\n      if (this.pluginInfo.parameters[parameterName]) {\r\n        if (shouldParameterBeIncluded && !Object.hasOwn(result, parameterName)) {\r\n          let parameterValue = this.trialObject[parameterName];\r\n          if (typeof parameterValue === \"function\") {\r\n            parameterValue = parameterValue.toString();\r\n          }\r\n          result[parameterName] = parameterValue;\r\n        } else if (!shouldParameterBeIncluded && Object.hasOwn(result, parameterName)) {\r\n          delete result[parameterName];\r\n        }\r\n      } else {\r\n        console.warn(\r\n          `Non-existent parameter \"${parameterName}\" specified in save_trial_parameters.`\r\n        );\r\n      }\r\n    }\r\n\r\n    result = {\r\n      ...this.getDataParameter(),\r\n      ...result,\r\n      trial_type: this.pluginInfo.name,\r\n      trial_index: this.index,\r\n      plugin_version: this.pluginInfo[\"version\"] ? this.pluginInfo[\"version\"] : null,\r\n    };\r\n\r\n    // Add timeline variables to the result according to the `save_timeline_variables` parameter\r\n    const saveTimelineVariables = this.getParameterValue(\"save_timeline_variables\");\r\n    if (saveTimelineVariables === true) {\r\n      result.timeline_variables = { ...this.parent.getAllTimelineVariables() };\r\n    } else if (Array.isArray(saveTimelineVariables)) {\r\n      result.timeline_variables = Object.fromEntries(\r\n        Object.entries(this.parent.getAllTimelineVariables()).filter(([key, _]) =>\r\n          saveTimelineVariables.includes(key)\r\n        )\r\n      );\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Runs a callback function retrieved from a parameter value and returns its result.\r\n   *\r\n   * @param parameterName The name of the parameter to retrieve the callback function from.\r\n   * @param callbackParameters The parameters (if any) to be passed to the callback function\r\n   */\r\n  private runParameterCallback(parameterName: string, ...callbackParameters: unknown[]) {\r\n    const callback = this.getParameterValue(parameterName, { evaluateFunctions: false });\r\n    if (callback) {\r\n      return callback(...callbackParameters);\r\n    }\r\n  }\r\n\r\n  private onStart() {\r\n    this.dependencies.onTrialStart(this);\r\n    this.runParameterCallback(\"on_start\", this.trialObject);\r\n    this.dependencies.runOnStartExtensionCallbacks(this.getParameterValue(\"extensions\"));\r\n  }\r\n\r\n  private onLoad = () => {\r\n    this.runParameterCallback(\"on_load\");\r\n    this.dependencies.runOnLoadExtensionCallbacks(this.getParameterValue(\"extensions\"));\r\n  };\r\n\r\n  private async onFinish() {\r\n    const extensionResults = await this.dependencies.runOnFinishExtensionCallbacks(\r\n      this.getParameterValue(\"extensions\")\r\n    );\r\n    Object.assign(this.result, extensionResults);\r\n\r\n    await Promise.resolve(this.runParameterCallback(\"on_finish\", this.getResult()));\r\n\r\n    this.dependencies.onTrialFinished(this);\r\n  }\r\n\r\n  public evaluateTimelineVariable(variable: TimelineVariable) {\r\n    // Timeline variable values are specified at the timeline level, not at the trial level, hence\r\n    // deferring to the parent timeline here\r\n    return this.parent?.evaluateTimelineVariable(variable);\r\n  }\r\n\r\n  public getParameterValue(\r\n    parameterPath: string | string[],\r\n    options: GetParameterValueOptions = {}\r\n  ) {\r\n    // Disable recursion for timeline description keys\r\n    if (\r\n      timelineDescriptionKeys.includes(\r\n        typeof parameterPath === \"string\" ? parameterPath : parameterPath[0]\r\n      )\r\n    ) {\r\n      options.recursive = false;\r\n    }\r\n    return super.getParameterValue(parameterPath, options);\r\n  }\r\n\r\n  /**\r\n   * Retrieves and evaluates the `simulation_options` parameter, considering nested properties and\r\n   * global simulation options.\r\n   */\r\n  public getSimulationOptions() {\r\n    const simulationOptions: SimulationOptions = this.getParameterValue(\"simulation_options\", {\r\n      replaceResult: (result = {}) => {\r\n        if (typeof result === \"string\") {\r\n          // Look up the global simulation options by their key\r\n          const globalSimulationOptions = this.dependencies.getGlobalSimulationOptions();\r\n          result = globalSimulationOptions[result] ?? globalSimulationOptions[\"default\"] ?? {};\r\n        }\r\n\r\n        return deepMerge(\r\n          deepCopy(this.dependencies.getGlobalSimulationOptions().default),\r\n          deepCopy(result)\r\n        );\r\n      },\r\n    });\r\n\r\n    if (typeof simulationOptions === \"undefined\") {\r\n      return {};\r\n    }\r\n\r\n    simulationOptions.mode = this.getParameterValue([\"simulation_options\", \"mode\"]);\r\n    simulationOptions.simulate = this.getParameterValue([\"simulation_options\", \"simulate\"]);\r\n    simulationOptions.data = this.getParameterValue([\"simulation_options\", \"data\"]);\r\n\r\n    if (typeof simulationOptions.data === \"object\") {\r\n      simulationOptions.data = Object.fromEntries(\r\n        Object.keys(simulationOptions.data).map((key) => [\r\n          key,\r\n          this.getParameterValue([\"simulation_options\", \"data\", key]),\r\n        ])\r\n      );\r\n    }\r\n\r\n    return simulationOptions;\r\n  }\r\n\r\n  /**\r\n   * Returns the result object of this trial or `undefined` if the result is not yet known or the\r\n   * `record_data` trial parameter is `false`.\r\n   */\r\n  public getResult() {\r\n    return this.getParameterValue(\"record_data\") === false ? undefined : this.result;\r\n  }\r\n\r\n  public getResults() {\r\n    const result = this.getResult();\r\n    return result ? [result] : [];\r\n  }\r\n\r\n  /**\r\n   * Checks that the parameters provided in the trial description align with the plugin's info\r\n   * object, resolves missing parameter values from the parent timeline, resolves timeline variable\r\n   * parameters, evaluates parameter functions if the expected parameter type is not `FUNCTION`, and\r\n   * sets default values for optional parameters.\r\n   */\r\n  private processParameters() {\r\n    const assignParameterValues = (\r\n      parameterObject: Record<string, any>,\r\n      parameterInfos: ParameterInfos,\r\n      parentParameterPath: string[] = []\r\n    ) => {\r\n      for (const [parameterName, parameterConfig] of Object.entries(parameterInfos)) {\r\n        const parameterPath = [...parentParameterPath, parameterName];\r\n\r\n        let parameterValue = this.getParameterValue(parameterPath, {\r\n          evaluateFunctions: parameterConfig.type !== ParameterType.FUNCTION,\r\n          replaceResult: (originalResult) => {\r\n            if (typeof originalResult === \"undefined\") {\r\n              if (typeof parameterConfig.default === \"undefined\") {\r\n                throw new Error(\r\n                  `You must specify a value for the \"${parameterPathArrayToString(\r\n                    parameterPath\r\n                  )}\" parameter in the \"${this.pluginInfo.name}\" plugin.`\r\n                );\r\n              } else {\r\n                return parameterConfig.default;\r\n              }\r\n            } else {\r\n              return originalResult;\r\n            }\r\n          },\r\n        });\r\n\r\n        if (parameterConfig.array && !Array.isArray(parameterValue)) {\r\n          const parameterPathString = parameterPathArrayToString(parameterPath);\r\n          throw new Error(\r\n            `A non-array value (\\`${parameterValue}\\`) was provided for the array parameter \"${parameterPathString}\" in the \"${this.pluginInfo.name}\" plugin. Please make sure that \"${parameterPathString}\" is an array.`\r\n          );\r\n        }\r\n\r\n        if (parameterConfig.type === ParameterType.COMPLEX && parameterConfig.nested) {\r\n          // Assign parameter values according to the `nested` schema\r\n          if (parameterConfig.array) {\r\n            // ...for each nested array element\r\n            parameterValue = parameterValue.map((_, arrayIndex) => {\r\n              const arrayElementPath = [...parameterPath, arrayIndex.toString()];\r\n              const arrayElementValue = this.getParameterValue(arrayElementPath);\r\n              assignParameterValues(arrayElementValue, parameterConfig.nested, arrayElementPath);\r\n              return arrayElementValue;\r\n            });\r\n          } else {\r\n            // ...for the nested object\r\n            assignParameterValues(parameterValue, parameterConfig.nested, parameterPath);\r\n          }\r\n        }\r\n\r\n        parameterObject[parameterName] = parameterValue;\r\n      }\r\n    };\r\n\r\n    const trialObject = deepCopy(this.description);\r\n    assignParameterValues(trialObject, this.pluginInfo.parameters);\r\n    this.trialObject = trialObject;\r\n  }\r\n\r\n  public getLatestNode() {\r\n    return this;\r\n  }\r\n\r\n  public getActiveTimelineByName(name: string): Timeline | undefined {\r\n    // This returns undefined because the function is looking\r\n    // for a timeline. If we get to this point, then none\r\n    // of the parent nodes match the name.\r\n    return undefined;\r\n  }\r\n}\r\n","import { DataCollection } from \"../modules/data/DataCollection\";\r\nimport {\r\n  repeat,\r\n  sampleWithReplacement,\r\n  sampleWithoutReplacement,\r\n  shuffle,\r\n  shuffleAlternateGroups,\r\n} from \"../modules/randomization\";\r\nimport { TimelineNode } from \"./TimelineNode\";\r\nimport { Trial } from \"./Trial\";\r\nimport { PromiseWrapper } from \"./util\";\r\nimport {\r\n  TimelineArray,\r\n  TimelineDescription,\r\n  TimelineNodeDependencies,\r\n  TimelineNodeStatus,\r\n  TimelineVariable,\r\n  TrialDescription,\r\n  TrialResult,\r\n  isTimelineDescription,\r\n  isTrialDescription,\r\n} from \".\";\r\n\r\nexport class Timeline extends TimelineNode {\r\n  public readonly children: TimelineNode[] = [];\r\n  public readonly description: TimelineDescription;\r\n\r\n  constructor(\r\n    dependencies: TimelineNodeDependencies,\r\n    description: TimelineDescription | TimelineArray,\r\n    public readonly parent?: Timeline\r\n  ) {\r\n    super(dependencies);\r\n    this.description = Array.isArray(description) ? { timeline: description } : description;\r\n    this.initializeParameterValueCache();\r\n  }\r\n\r\n  private currentChild?: TimelineNode;\r\n  private shouldAbort = false;\r\n\r\n  public async run() {\r\n    if (typeof this.index === \"undefined\") {\r\n      // We're the first timeline node to run. Otherwise, another node would have set our index\r\n      // right before running us.\r\n      this.index = 0;\r\n    }\r\n\r\n    this.status = TimelineNodeStatus.RUNNING;\r\n\r\n    const { conditional_function, loop_function, repetitions = 1 } = this.description;\r\n\r\n    // Generate initial timeline variable order so the first set of timeline variables is already\r\n    // available to the `on_timeline_start` and `conditional_function` callbacks\r\n    let timelineVariableOrder = this.generateTimelineVariableOrder();\r\n    this.setCurrentTimelineVariablesByIndex(timelineVariableOrder[0]);\r\n    let isInitialTimelineVariableOrder = true; // So we don't regenerate the order in the first iteration\r\n\r\n    let currentLoopIterationResults: TrialResult[];\r\n\r\n    if (!conditional_function || conditional_function()) {\r\n      this.onStart();\r\n\r\n      for (let repetition = 0; repetition < repetitions; repetition++) {\r\n        do {\r\n          currentLoopIterationResults = [];\r\n\r\n          // Generate a new timeline variable order in each iteration except for the first one where\r\n          // it has been done before\r\n          if (isInitialTimelineVariableOrder) {\r\n            isInitialTimelineVariableOrder = false;\r\n          } else {\r\n            timelineVariableOrder = this.generateTimelineVariableOrder();\r\n          }\r\n\r\n          for (const timelineVariableIndex of timelineVariableOrder) {\r\n            this.setCurrentTimelineVariablesByIndex(timelineVariableIndex);\r\n\r\n            for (const childNodeDescription of this.description.timeline) {\r\n              const childNode = this.instantiateChildNode(childNodeDescription);\r\n\r\n              const previousChild = this.currentChild;\r\n              this.currentChild = childNode;\r\n              childNode.index = previousChild\r\n                ? previousChild.getLatestNode().index + 1\r\n                : this.index;\r\n\r\n              await childNode.run();\r\n              // @ts-expect-error TS thinks `this.status` must be `RUNNING` now, but it might have\r\n              // changed while `await`ing\r\n              if (this.status === TimelineNodeStatus.PAUSED) {\r\n                await this.resumePromise.get();\r\n              }\r\n              if (this.shouldAbort) {\r\n                this.status = TimelineNodeStatus.ABORTED;\r\n                return;\r\n              }\r\n\r\n              currentLoopIterationResults.push(...this.currentChild.getResults());\r\n            }\r\n          }\r\n        } while (loop_function && loop_function(new DataCollection(currentLoopIterationResults)));\r\n      }\r\n\r\n      this.onFinish();\r\n    }\r\n\r\n    this.status = TimelineNodeStatus.COMPLETED;\r\n  }\r\n\r\n  private onStart() {\r\n    if (this.description.on_timeline_start) {\r\n      this.description.on_timeline_start();\r\n    }\r\n  }\r\n\r\n  private onFinish() {\r\n    if (this.description.on_timeline_finish) {\r\n      this.description.on_timeline_finish();\r\n    }\r\n  }\r\n\r\n  pause() {\r\n    if (this.currentChild instanceof Timeline) {\r\n      this.currentChild.pause();\r\n    }\r\n    this.status = TimelineNodeStatus.PAUSED;\r\n  }\r\n\r\n  private resumePromise = new PromiseWrapper();\r\n  resume() {\r\n    if (this.status == TimelineNodeStatus.PAUSED) {\r\n      if (this.currentChild instanceof Timeline) {\r\n        this.currentChild.resume();\r\n      }\r\n      this.status = TimelineNodeStatus.RUNNING;\r\n      this.resumePromise.resolve();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * If the timeline is running or paused, aborts the timeline after the current trial has completed\r\n   */\r\n  abort() {\r\n    if (this.status === TimelineNodeStatus.RUNNING || this.status === TimelineNodeStatus.PAUSED) {\r\n      if (this.currentChild instanceof Timeline) {\r\n        this.currentChild.abort();\r\n      }\r\n\r\n      this.shouldAbort = true;\r\n      if (this.status === TimelineNodeStatus.PAUSED) {\r\n        this.resume();\r\n      }\r\n    }\r\n  }\r\n\r\n  private instantiateChildNode(\r\n    childDescription: TimelineDescription | TimelineArray | TrialDescription\r\n  ) {\r\n    const newChildNode = isTimelineDescription(childDescription)\r\n      ? new Timeline(this.dependencies, childDescription, this)\r\n      : new Trial(this.dependencies, childDescription, this);\r\n\r\n    this.children.push(newChildNode);\r\n    return newChildNode;\r\n  }\r\n\r\n  private currentTimelineVariables: Record<string, any>;\r\n  private setCurrentTimelineVariablesByIndex(index: number | null) {\r\n    this.currentTimelineVariables = {\r\n      ...this.parent?.getAllTimelineVariables(),\r\n      ...(index === null ? undefined : this.description.timeline_variables[index]),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * If the timeline has timeline variables, returns the order of `timeline_variables` array indices\r\n   * to be used, according to the timeline's `sample` setting. If the timeline has no timeline\r\n   * variables, returns `[null]`.\r\n   */\r\n  private generateTimelineVariableOrder() {\r\n    const timelineVariableLength = this.description.timeline_variables?.length;\r\n    if (!timelineVariableLength) {\r\n      return [null];\r\n    }\r\n\r\n    let order = [...Array(timelineVariableLength).keys()];\r\n\r\n    const sample = this.description.sample;\r\n\r\n    if (sample) {\r\n      switch (sample.type) {\r\n        case \"custom\":\r\n          order = sample.fn(order);\r\n          break;\r\n\r\n        case \"with-replacement\":\r\n          order = sampleWithReplacement(order, sample.size, sample.weights);\r\n          break;\r\n\r\n        case \"without-replacement\":\r\n          order = sampleWithoutReplacement(order, sample.size);\r\n          break;\r\n\r\n        case \"fixed-repetitions\":\r\n          order = repeat(order, sample.size);\r\n          break;\r\n\r\n        case \"alternate-groups\":\r\n          order = shuffleAlternateGroups(sample.groups, sample.randomize_group_order);\r\n          break;\r\n\r\n        default:\r\n          throw new Error(\r\n            `Invalid type \"${\r\n              // @ts-expect-error TS doesn't have a type for `sample` in this case\r\n              sample.type\r\n            }\" in timeline sample parameters. Valid options for type are \"custom\", \"with-replacement\", \"without-replacement\", \"fixed-repetitions\", and \"alternate-groups\"`\r\n          );\r\n      }\r\n    }\r\n\r\n    if (this.description.randomize_order) {\r\n      order = shuffle(order);\r\n    }\r\n\r\n    return order;\r\n  }\r\n\r\n  /**\r\n   * Returns the current values of all timeline variables, including those from parent timelines\r\n   */\r\n  public getAllTimelineVariables() {\r\n    return this.currentTimelineVariables;\r\n  }\r\n\r\n  public evaluateTimelineVariable(variable: TimelineVariable) {\r\n    if (this.currentTimelineVariables?.hasOwnProperty(variable.name)) {\r\n      return this.currentTimelineVariables[variable.name];\r\n    }\r\n    throw new Error(`Timeline variable ${variable.name} not found.`);\r\n  }\r\n\r\n  public getResults() {\r\n    const results: TrialResult[] = [];\r\n    for (const child of this.children) {\r\n      if (child instanceof Trial) {\r\n        const childResult = child.getResult();\r\n        if (childResult) {\r\n          results.push(childResult);\r\n        }\r\n      } else if (child instanceof Timeline) {\r\n        results.push(...child.getResults());\r\n      }\r\n    }\r\n\r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Returns the naive progress of the timeline (as a fraction), without considering conditional or\r\n   * loop functions.\r\n   */\r\n  public getNaiveProgress() {\r\n    if (this.status === TimelineNodeStatus.PENDING) {\r\n      return 0;\r\n    }\r\n\r\n    const activeNode = this.getLatestNode();\r\n    if (!activeNode) {\r\n      return 1;\r\n    }\r\n\r\n    let completedTrials = activeNode.index;\r\n    if (activeNode.getStatus() === TimelineNodeStatus.COMPLETED) {\r\n      completedTrials++;\r\n    }\r\n\r\n    return Math.min(completedTrials / this.getNaiveTrialCount(), 1);\r\n  }\r\n\r\n  /**\r\n   * Recursively computes the naive number of trials in the timeline, without considering\r\n   * conditional or loop functions.\r\n   */\r\n  public getNaiveTrialCount() {\r\n    // Since child timeline nodes are instantiated lazily, we cannot rely on them but instead have\r\n    // to recurse the description programmatically.\r\n\r\n    const getTrialCount = (description: TimelineArray | TimelineDescription | TrialDescription) => {\r\n      const getTimelineArrayTrialCount = (description: TimelineArray) =>\r\n        description\r\n          .map((childDescription) => getTrialCount(childDescription))\r\n          .reduce((a, b) => a + b);\r\n\r\n      if (Array.isArray(description)) {\r\n        return getTimelineArrayTrialCount(description);\r\n      }\r\n\r\n      if (isTrialDescription(description)) {\r\n        return 1;\r\n      }\r\n      if (isTimelineDescription(description)) {\r\n        let conditionCount = description.timeline_variables?.length || 1;\r\n\r\n        switch (description.sample?.type) {\r\n          case \"with-replacement\":\r\n          case \"without-replacement\":\r\n            conditionCount = description.sample.size;\r\n            break;\r\n\r\n          case \"fixed-repetitions\":\r\n            conditionCount *= description.sample.size;\r\n            break;\r\n\r\n          case \"alternate-groups\":\r\n            conditionCount = description.sample.groups\r\n              .map((group) => group.length)\r\n              .reduce((a, b) => a + b, 0);\r\n            break;\r\n        }\r\n\r\n        return (\r\n          getTimelineArrayTrialCount(description.timeline) *\r\n          (description.repetitions ?? 1) *\r\n          conditionCount\r\n        );\r\n      }\r\n      return 0;\r\n    };\r\n\r\n    return getTrialCount(this.description);\r\n  }\r\n\r\n  public getLatestNode() {\r\n    return this.currentChild?.getLatestNode() ?? this;\r\n  }\r\n\r\n  public getActiveTimelineByName(name: string) {\r\n    if (this.description.name === name) {\r\n      return this;\r\n    }\r\n\r\n    return this.currentChild?.getActiveTimelineByName(name);\r\n  }\r\n}\r\n","import autoBind from \"auto-bind\";\r\n// To work with citations\r\nimport { Class } from \"type-fest\";\r\n\r\nimport { version } from \"../package.json\";\r\nimport { ExtensionManager, ExtensionManagerDependencies } from \"./ExtensionManager\";\r\nimport { JsPsychData, JsPsychDataDependencies } from \"./modules/data\";\r\nimport { JsPsychExtension } from \"./modules/extensions\";\r\nimport { PluginAPI, createJointPluginAPIObject } from \"./modules/plugin-api\";\r\nimport { JsPsychPlugin } from \"./modules/plugins\";\r\nimport * as randomization from \"./modules/randomization\";\r\nimport * as turk from \"./modules/turk\";\r\nimport * as utils from \"./modules/utils\";\r\nimport { ProgressBar } from \"./ProgressBar\";\r\nimport {\r\n  SimulationMode,\r\n  SimulationOptionsParameter,\r\n  TimelineArray,\r\n  TimelineDescription,\r\n  TimelineNodeDependencies,\r\n  TimelineVariable,\r\n  TrialResult,\r\n} from \"./timeline\";\r\nimport { Timeline } from \"./timeline/Timeline\";\r\nimport { Trial } from \"./timeline/Trial\";\r\nimport { PromiseWrapper } from \"./timeline/util\";\r\n\r\nexport class JsPsych {\r\n  turk = turk;\r\n  randomization = randomization;\r\n  utils = utils;\r\n  data: JsPsychData;\r\n  pluginAPI: PluginAPI;\r\n\r\n  version() {\r\n    return version;\r\n  }\r\n\r\n  // prettier-ignore\r\n  private citation: any = '__CITATIONS__';\r\n\r\n  /** Options */\r\n  private options: any = {};\r\n\r\n  /** Experiment timeline */\r\n  private timeline?: Timeline;\r\n\r\n  /** Target DOM element */\r\n  private displayContainerElement: HTMLElement;\r\n  private displayElement: HTMLElement;\r\n\r\n  /** Time that the experiment began */\r\n  private experimentStartTime: Date;\r\n\r\n  /**\r\n   * Whether the page is retrieved directly via the `file://` protocol (true) or hosted on a web\r\n   * server (false)\r\n   */\r\n  private isFileProtocolUsed = false;\r\n\r\n  /** The simulation mode (if the experiment is being simulated) */\r\n  private simulationMode?: SimulationMode;\r\n\r\n  /** Simulation options passed in via `simulate()` */\r\n  private simulationOptions: Record<string, SimulationOptionsParameter>;\r\n\r\n  private extensionManager: ExtensionManager;\r\n\r\n  constructor(options?) {\r\n    // override default options if user specifies an option\r\n    options = {\r\n      display_element: undefined,\r\n      on_finish: () => {},\r\n      on_trial_start: () => {},\r\n      on_trial_finish: () => {},\r\n      on_data_update: () => {},\r\n      on_interaction_data_update: () => {},\r\n      on_close: () => {},\r\n      use_webaudio: true,\r\n      show_progress_bar: false,\r\n      message_progress_bar: \"Completion Progress\",\r\n      auto_update_progress_bar: true,\r\n      default_iti: 0,\r\n      minimum_valid_rt: 0,\r\n      experiment_width: null,\r\n      override_safe_mode: false,\r\n      case_sensitive_responses: false,\r\n      extensions: [],\r\n      ...options,\r\n    };\r\n    this.options = options;\r\n\r\n    autoBind(this); // so we can pass JsPsych methods as callbacks and `this` remains the JsPsych instance\r\n\r\n    // detect whether page is running in browser as a local file, and if so, disable web audio and\r\n    // video preloading to prevent CORS issues\r\n    if (\r\n      window.location.protocol == \"file:\" &&\r\n      (options.override_safe_mode === false || typeof options.override_safe_mode === \"undefined\")\r\n    ) {\r\n      options.use_webaudio = false;\r\n      this.isFileProtocolUsed = true;\r\n      console.warn(\r\n        \"jsPsych detected that it is running via the file:// protocol and not on a web server. \" +\r\n          \"To prevent issues with cross-origin requests, Web Audio and video preloading have been disabled. \" +\r\n          \"If you would like to override this setting, you can set 'override_safe_mode' to 'true' in initJsPsych. \" +\r\n          \"For more information, see: https://www.jspsych.org/overview/running-experiments\"\r\n      );\r\n    }\r\n\r\n    // initialize modules\r\n    this.data = new JsPsychData(this.dataDependencies);\r\n    this.pluginAPI = createJointPluginAPIObject(this);\r\n\r\n    this.extensionManager = new ExtensionManager(\r\n      this.extensionManagerDependencies,\r\n      options.extensions\r\n    );\r\n  }\r\n\r\n  private endMessage?: string;\r\n\r\n  /**\r\n   * Starts an experiment using the provided timeline and returns a promise that is resolved when\r\n   * the experiment is finished.\r\n   *\r\n   * @param timeline The timeline to be run\r\n   */\r\n  async run(timeline: TimelineDescription | TimelineArray) {\r\n    if (typeof timeline === \"undefined\") {\r\n      console.error(\"No timeline declared in jsPsych.run(). Cannot start experiment.\");\r\n    }\r\n\r\n    if (timeline.length === 0) {\r\n      console.error(\r\n        \"No trials have been added to the timeline (the timeline is an empty array). Cannot start experiment.\"\r\n      );\r\n    }\r\n\r\n    // create experiment timeline\r\n    this.timeline = new Timeline(this.timelineDependencies, timeline);\r\n\r\n    await this.prepareDom();\r\n    await this.extensionManager.initializeExtensions();\r\n\r\n    document.documentElement.setAttribute(\"jspsych\", \"present\");\r\n\r\n    this.experimentStartTime = new Date();\r\n\r\n    await this.timeline.run();\r\n    await Promise.resolve(this.options.on_finish(this.data.get()));\r\n\r\n    if (this.endMessage) {\r\n      this.getDisplayElement().innerHTML = this.endMessage;\r\n    }\r\n\r\n    this.data.removeInteractionListeners();\r\n  }\r\n\r\n  async simulate(\r\n    timeline: any[],\r\n    simulation_mode: \"data-only\" | \"visual\" = \"data-only\",\r\n    simulation_options = {}\r\n  ) {\r\n    this.simulationMode = simulation_mode;\r\n    this.simulationOptions = simulation_options;\r\n    await this.run(timeline);\r\n  }\r\n\r\n  public progressBar?: ProgressBar;\r\n\r\n  getProgress() {\r\n    return {\r\n      total_trials: this.timeline?.getNaiveTrialCount(),\r\n      current_trial_global: this.timeline?.getLatestNode().index ?? 0,\r\n      percent_complete: this.timeline?.getNaiveProgress() * 100,\r\n    };\r\n  }\r\n\r\n  getStartTime() {\r\n    return this.experimentStartTime; // TODO This seems inconsistent, given that `getTotalTime()` returns a number, not a `Date`\r\n  }\r\n\r\n  getTotalTime() {\r\n    if (!this.experimentStartTime) {\r\n      return 0;\r\n    }\r\n    return new Date().getTime() - this.experimentStartTime.getTime();\r\n  }\r\n\r\n  getDisplayElement() {\r\n    return this.displayElement;\r\n  }\r\n\r\n  getDisplayContainerElement() {\r\n    return this.displayContainerElement;\r\n  }\r\n\r\n  abortExperiment(endMessage?: string, data = {}) {\r\n    this.endMessage = endMessage;\r\n    this.timeline.abort();\r\n    this.pluginAPI.cancelAllKeyboardResponses();\r\n    this.pluginAPI.clearAllTimeouts();\r\n    this.finishTrial(data);\r\n  }\r\n\r\n  abortCurrentTimeline() {\r\n    let currentTimeline = this.timeline?.getLatestNode();\r\n    if (currentTimeline instanceof Trial) {\r\n      currentTimeline = currentTimeline.parent;\r\n    }\r\n    if (currentTimeline instanceof Timeline) {\r\n      currentTimeline.abort();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Aborts a named timeline. The timeline must be currently running in order to abort it.\r\n   *\r\n   * @param name The name of the timeline to abort. Timelines can be given names by setting the `name` parameter in the description of the timeline.\r\n   */\r\n  abortTimelineByName(name: string): void {\r\n    const timeline = this.timeline?.getActiveTimelineByName(name);\r\n    if (timeline) {\r\n      timeline.abort();\r\n    }\r\n  }\r\n\r\n  getCurrentTrial() {\r\n    const activeNode = this.timeline?.getLatestNode();\r\n    if (activeNode instanceof Trial) {\r\n      return activeNode.description;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  getInitSettings() {\r\n    return this.options;\r\n  }\r\n\r\n  timelineVariable(variableName: string) {\r\n    return new TimelineVariable(variableName);\r\n  }\r\n\r\n  evaluateTimelineVariable(variableName: string) {\r\n    return this.timeline\r\n      ?.getLatestNode()\r\n      ?.evaluateTimelineVariable(new TimelineVariable(variableName));\r\n  }\r\n\r\n  pauseExperiment() {\r\n    this.timeline?.pause();\r\n  }\r\n\r\n  resumeExperiment() {\r\n    this.timeline?.resume();\r\n  }\r\n\r\n  getSafeModeStatus() {\r\n    return this.isFileProtocolUsed;\r\n  }\r\n\r\n  getTimeline() {\r\n    return this.timeline?.description.timeline;\r\n  }\r\n\r\n  /**\r\n   * Prints out a string containing citations for the jsPsych library and all input plugins/extensions in the specified format.\r\n   * If called without input, prints citation for jsPsych library.\r\n   *\r\n   * @param plugins The plugins/extensions to generate citations for. Always prints the citation for the jsPsych library at the top.\r\n   * @param format The desired output citation format. Currently supports \"apa\" and \"bibtex\".\r\n   * @returns String containing citations separated with newline character.\r\n   */\r\n  getCitations(\r\n    plugins: Array<Class<JsPsychPlugin<any>> | Class<JsPsychExtension>> = [],\r\n    format: \"apa\" | \"bibtex\" = \"apa\"\r\n  ) {\r\n    const formatOptions = [\"apa\", \"bibtex\"];\r\n    format = format.toLowerCase() as \"apa\" | \"bibtex\";\r\n    // Check if plugins is an array\r\n    if (!Array.isArray(plugins)) {\r\n      throw new Error(\"Expected array of plugins/extensions\");\r\n    }\r\n    // Check if format is supported\r\n    else if (!formatOptions.includes(format)) {\r\n      throw new Error(\"Unsupported citation format\");\r\n    }\r\n    // Print citations\r\n    else {\r\n      const jsPsychCitation = this.citation[format];\r\n      const citationSet = new Set([jsPsychCitation]);\r\n\r\n      for (const plugin of plugins) {\r\n        try {\r\n          const pluginCitation = plugin[\"info\"].citations[format];\r\n          citationSet.add(pluginCitation);\r\n        } catch {\r\n          console.error(`${plugin} does not have citation in ${format} format.`);\r\n        }\r\n      }\r\n      const citationList = Array.from(citationSet).join(\"\\n\");\r\n      return citationList;\r\n    }\r\n  }\r\n\r\n  get extensions() {\r\n    return this.extensionManager?.extensions ?? {};\r\n  }\r\n\r\n  private async prepareDom() {\r\n    // Wait until the document is ready\r\n    if (document.readyState !== \"complete\") {\r\n      await new Promise((resolve) => {\r\n        window.addEventListener(\"load\", resolve);\r\n      });\r\n    }\r\n\r\n    const options = this.options;\r\n\r\n    // set DOM element where jsPsych will render content\r\n    // if undefined, then jsPsych will use the <body> tag and the entire page\r\n    if (typeof options.display_element === \"undefined\") {\r\n      // check if there is a body element on the page\r\n      let body = document.body;\r\n      if (!body) {\r\n        body = document.createElement(\"body\");\r\n        document.documentElement.appendChild(body);\r\n      }\r\n      // using the full page, so we need the HTML element to have 100% height, and body to be full\r\n      // width and height with no margin\r\n      document.querySelector(\"html\").style.height = \"100%\";\r\n\r\n      body.style.margin = \"0px\";\r\n      body.style.height = \"100%\";\r\n      body.style.width = \"100%\";\r\n      options.display_element = body;\r\n    } else {\r\n      // make sure that the display element exists on the page\r\n      const display =\r\n        options.display_element instanceof Element\r\n          ? options.display_element\r\n          : document.querySelector(\"#\" + options.display_element);\r\n      if (display === null) {\r\n        console.error(\"The display_element specified in initJsPsych() does not exist in the DOM.\");\r\n      } else {\r\n        options.display_element = display;\r\n      }\r\n    }\r\n\r\n    const contentElement = document.createElement(\"div\");\r\n    contentElement.id = \"jspsych-content\";\r\n\r\n    const contentWrapperElement = document.createElement(\"div\");\r\n    contentWrapperElement.className = \"jspsych-content-wrapper\";\r\n    contentWrapperElement.appendChild(contentElement);\r\n\r\n    this.displayContainerElement = options.display_element;\r\n    this.displayContainerElement.appendChild(contentWrapperElement);\r\n    this.displayElement = contentElement;\r\n\r\n    // set experiment_width if not null\r\n    if (options.experiment_width !== null) {\r\n      this.displayElement.style.width = options.experiment_width + \"px\";\r\n    }\r\n\r\n    // add tabIndex attribute to scope event listeners\r\n    options.display_element.tabIndex = 0;\r\n\r\n    // Add CSS classes to container and display elements\r\n    this.displayContainerElement.classList.add(\"jspsych-display-element\");\r\n    this.displayElement.classList.add(\"jspsych-content\");\r\n\r\n    // create listeners for user browser interaction\r\n    this.data.createInteractionListeners();\r\n\r\n    // add event for closing window\r\n    window.addEventListener(\"beforeunload\", options.on_close);\r\n\r\n    if (this.options.show_progress_bar) {\r\n      const progressBarContainer = document.createElement(\"div\");\r\n      progressBarContainer.id = \"jspsych-progressbar-container\";\r\n\r\n      this.progressBar = new ProgressBar(progressBarContainer, this.options.message_progress_bar);\r\n\r\n      this.getDisplayContainerElement().insertAdjacentElement(\"afterbegin\", progressBarContainer);\r\n    }\r\n  }\r\n\r\n  private finishTrialPromise = new PromiseWrapper<TrialResult | void>();\r\n  finishTrial(data?: TrialResult) {\r\n    this.finishTrialPromise.resolve(data);\r\n  }\r\n\r\n  private timelineDependencies: TimelineNodeDependencies = {\r\n    onTrialStart: (trial: Trial) => {\r\n      this.options.on_trial_start(trial.trialObject);\r\n\r\n      // apply the focus to the element containing the experiment.\r\n      this.getDisplayContainerElement().focus();\r\n      // reset the scroll on the DOM target\r\n      this.getDisplayElement().scrollTop = 0;\r\n    },\r\n\r\n    onTrialResultAvailable: (trial: Trial) => {\r\n      const result = trial.getResult();\r\n      if (result) {\r\n        result.time_elapsed = this.getTotalTime();\r\n        this.data.write(trial);\r\n      }\r\n    },\r\n\r\n    onTrialFinished: (trial: Trial) => {\r\n      const result = trial.getResult();\r\n      this.options.on_trial_finish(result);\r\n\r\n      if (result) {\r\n        this.options.on_data_update(result);\r\n      }\r\n\r\n      if (this.progressBar && this.options.auto_update_progress_bar) {\r\n        this.progressBar.progress = this.timeline.getNaiveProgress();\r\n      }\r\n    },\r\n\r\n    runOnStartExtensionCallbacks: (extensionsConfiguration) =>\r\n      this.extensionManager.onStart(extensionsConfiguration),\r\n\r\n    runOnLoadExtensionCallbacks: (extensionsConfiguration) =>\r\n      this.extensionManager.onLoad(extensionsConfiguration),\r\n\r\n    runOnFinishExtensionCallbacks: (extensionsConfiguration) =>\r\n      this.extensionManager.onFinish(extensionsConfiguration),\r\n\r\n    getSimulationMode: () => this.simulationMode,\r\n\r\n    getGlobalSimulationOptions: () => this.simulationOptions,\r\n\r\n    instantiatePlugin: (pluginClass) => new pluginClass(this),\r\n\r\n    getDisplayElement: () => this.getDisplayElement(),\r\n\r\n    getDefaultIti: () => this.getInitSettings().default_iti,\r\n\r\n    finishTrialPromise: this.finishTrialPromise,\r\n\r\n    clearAllTimeouts: () => this.pluginAPI.clearAllTimeouts(),\r\n  };\r\n\r\n  private extensionManagerDependencies: ExtensionManagerDependencies = {\r\n    instantiateExtension: (extensionClass) => new extensionClass(this),\r\n  };\r\n\r\n  private dataDependencies: JsPsychDataDependencies = {\r\n    getProgress: () => ({\r\n      time: this.getTotalTime(),\r\n      trial: this.timeline?.getLatestNode().index ?? 0,\r\n    }),\r\n\r\n    onInteractionRecordAdded: (record) => {\r\n      this.options.on_interaction_data_update(record);\r\n    },\r\n\r\n    getDisplayElement: () => this.getDisplayElement(),\r\n  };\r\n}\r\n","export class MigrationError extends Error {\r\n  constructor(message = \"The global `jsPsych` variable is no longer available in jsPsych v7.\") {\r\n    super(\r\n      `${message} Please follow the migration guide at https://www.jspsych.org/7.0/support/migration-v7/ to update your experiment.`\r\n    );\r\n    this.name = \"MigrationError\";\r\n  }\r\n}\r\n\r\n// Define a global jsPsych object to handle invocations on it with migration errors\r\n(window as any).jsPsych = {\r\n  get init() {\r\n    throw new MigrationError(\"`jsPsych.init()` was replaced by `initJsPsych()` in jsPsych v7.\");\r\n  },\r\n\r\n  get data() {\r\n    throw new MigrationError();\r\n  },\r\n  get randomization() {\r\n    throw new MigrationError();\r\n  },\r\n  get turk() {\r\n    throw new MigrationError();\r\n  },\r\n  get pluginAPI() {\r\n    throw new MigrationError();\r\n  },\r\n\r\n  get ALL_KEYS() {\r\n    throw new MigrationError(\r\n      'jsPsych.ALL_KEYS was replaced by the \"ALL_KEYS\" string in jsPsych v7.'\r\n    );\r\n  },\r\n  get NO_KEYS() {\r\n    throw new MigrationError('jsPsych.NO_KEYS was replaced by the \"NO_KEYS\" string in jsPsych v7.');\r\n  },\r\n};\r\n","// __rollup-babel-import-regenerator-runtime__\r\n\r\nimport { JsPsych } from \"./JsPsych\";\r\nimport { MigrationError } from \"./migration\";\r\n\r\n// temporary patch for Safari\r\nif (\r\n  typeof window !== \"undefined\" &&\r\n  window.hasOwnProperty(\"webkitAudioContext\") &&\r\n  !window.hasOwnProperty(\"AudioContext\")\r\n) {\r\n  // @ts-expect-error\r\n  window.AudioContext = webkitAudioContext;\r\n}\r\n// end patch\r\n\r\n// The following function provides a uniform interface to initialize jsPsych, no matter whether a\r\n// browser supports ES6 classes or not (and whether the ES6 build or the Babel build is used).\r\n/**\r\n * Creates a new JsPsych instance using the provided options.\r\n *\r\n * @param options The options to pass to the JsPsych constructor\r\n * @returns A new JsPsych instance\r\n */\r\nexport function initJsPsych(options?) {\r\n  const jsPsych = new JsPsych(options);\r\n\r\n  // Handle invocations of non-existent v6 methods with migration errors\r\n  const migrationMessages = {\r\n    init: \"`jsPsych.init()` was replaced by `initJsPsych()` in jsPsych v7.\",\r\n\r\n    ALL_KEYS: 'jsPsych.ALL_KEYS was replaced by the \"ALL_KEYS\" string in jsPsych v7.',\r\n    NO_KEYS: 'jsPsych.NO_KEYS was replaced by the \"NO_KEYS\" string in jsPsych v7.',\r\n\r\n    // Getter functions that were renamed\r\n    currentTimelineNodeID:\r\n      \"`currentTimelineNodeID()` was renamed to `getCurrentTimelineNodeID()` in jsPsych v7.\",\r\n    progress: \"`progress()` was renamed to `getProgress()` in jsPsych v7.\",\r\n    startTime: \"`startTime()` was renamed to `getStartTime()` in jsPsych v7.\",\r\n    totalTime: \"`totalTime()` was renamed to `getTotalTime()` in jsPsych v7.\",\r\n    currentTrial: \"`currentTrial()` was renamed to `getCurrentTrial()` in jsPsych v7.\",\r\n    initSettings: \"`initSettings()` was renamed to `getInitSettings()` in jsPsych v7.\",\r\n    allTimelineVariables:\r\n      \"`allTimelineVariables()` was renamed to `getAllTimelineVariables()` in jsPsych v7.\",\r\n  };\r\n\r\n  Object.defineProperties(\r\n    jsPsych,\r\n    Object.fromEntries(\r\n      Object.entries(migrationMessages).map(([key, message]) => [\r\n        key,\r\n        {\r\n          get() {\r\n            throw new MigrationError(message);\r\n          },\r\n        },\r\n      ])\r\n    )\r\n  );\r\n\r\n  return jsPsych;\r\n}\r\n\r\nexport { JsPsych } from \"./JsPsych\";\r\nexport type { JsPsychPlugin, PluginInfo, TrialType } from \"./modules/plugins\";\r\nexport { ParameterType } from \"./modules/plugins\";\r\nexport type { JsPsychExtension, JsPsychExtensionInfo } from \"./modules/extensions\";\r\nexport { DataCollection } from \"./modules/data/DataCollection\";\r\n"],"names":["ParameterType","TimelineNodeStatus","path","description"],"mappings":"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"}